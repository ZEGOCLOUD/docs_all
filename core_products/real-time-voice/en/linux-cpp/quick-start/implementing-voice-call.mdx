---
articleID: 8228
---
# Implementing Audio Call

---

## Introduction

This document introduces how to quickly implement a simple real-time audio and video call.

Explanation of related concepts:

- ZEGO Express SDK: A real-time audio and video SDK provided by ZEGO, offering developers convenient access, high definition and fluency, multi-platform interoperability, low latency, and high concurrency audio and video services.
- Stream: A set of audio and video data packets encapsulated in a specified encoding format and continuously being sent. A user can publish multiple streams simultaneously (for example, one for camera data and one for screen sharing data) and can also play multiple streams simultaneously. Each stream is identified by a stream ID (streamID).
- Publish stream: The process of pushing packaged audio and video data streams to ZEGO real-time audio and video cloud.
- Play stream: The process of pulling and playing existing audio and video data streams from ZEGO real-time audio and video cloud.
- Room: An audio and video space service provided by ZEGO, used to organize user groups. Users in the same room can send and receive real-time audio, video, and messages to each other.
    1. Users need to log in to a room first before they can publish or play streams.
    2. Users can only receive related messages in the room they are in (user entry/exit, audio and video stream changes, etc.).
    3. Each room is identified by a unique roomID within an AppID. All users who log in to the room using the same roomID belong to the same room.



For more related concepts, please refer to [Glossary](/glossary/term-explanation).

## Prerequisites

Before implementing basic audio call functionality, please ensure:

- The ZEGO Express SDK has been integrated in your project to implement basic real-time audio and video functions. For details, please refer to [Quick Start - Integrate](/real-time-voice-linux/quick-start/integrating-sdk).
- A project has been created in the [ZEGOCLOUD Console](https://console.zegocloud.com), and a valid AppID and AppSign have been obtained. For details, please refer to "Project Information" in [Console - Project Management](/console/project-info).

<Warning title="Note">


The SDK also supports Token authentication. If you have higher security requirements for your project, it is recommended to upgrade the authentication method. For details, please refer to [How to upgrade from AppSign authentication to Token authentication](http://doc-zh.zego.im/faq/token_upgrade?product=ExpressVideo).

</Warning>





## Usage Steps

Taking User A playing User B's stream as an example, the process is as follows:

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Common/ZegoExpressEngine/common_usage_new.png" /></Frame>

The API call sequence of the entire stream publishing and playing process is as follows:


<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/QuickStart/quickstart_uml_audio.png" /></Frame>


<a id="CreateEngine"> </a>

### Create Engine

**1. Import Header File**

Introduce the ZegoExpressEngine header file in the project.

```cpp
#include "ZegoExpressSDK.h"
using namespace ZEGO::EXPRESS;
```

**2. Create Engine**

Call the [createEngine ](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-zego-express-sdk#create-engine) interface, and pass the obtained AppID to the parameter "appID".

Select an appropriate scenario based on your App's actual audio and video business. Please refer to the [Scenario-based Audio and Video Configuration](/real-time-voice-linux/quick-start/scenario-based-audio-video-configuration) document, and pass the selected scenario enumeration to the parameter "scenario".


```cpp
ZegoEngineProfile profile;
// AppID and AppSign are assigned by ZEGO to each App; for security reasons, it is recommended to store the AppSign in the App's business backend and obtain it from the backend when needed
profile.appID = appID; // Please obtain it through official website registration, format is 123456789
profile.appSign = appSign; // Please obtain it through official website registration, format is "0123456789012345678901234567890123", 64 characters
profile.scenario = ZegoScenario::ZEGO_SCENARIO_BROADCAST;
// Create engine instance
auto engine = ZegoExpressSDK::createEngine(profile, nullptr);
```

**3. Disable Camera**

<Warning title="Note">


Express Linux SDK does not provide an audio-only package with the video module removed. Therefore, the Linux "Real-time Voice" SDK is actually the "Real-time Audio and Video" SDK.


</Warning>



To implement an audio-only scenario, please call [enableCamera](@enableCamera) after creating the engine to disable the camera, to avoid starting the engine's video module. After the camera is disabled, camera permissions will no longer be required, and video streams will not be published.

```cpp
engine->enableCamera(false); // Disable camera
```

For more information, please refer to the document [Differences between Real-time Audio and Video SDK and Real-time Voice SDK](/real-time-voice-linux/introduction/difference-between-audio-and-video-sdk).

If you have high requirements for the Express Linux SDK package size, you can contact Technical Support for custom package reduction. For SDK package size data, please refer to the [Overview](/real-time-voice-linux/introduction/overview) document.


**4. Set Event Handlers**

You can instantiate a class that implements the [IZegoEventHandler](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-event-handler) interface, and implement the required callback methods to listen for and process the event callbacks you are concerned with. Then pass the instantiated object as the `eventHandler` parameter to the [createEngine ](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-zego-express-sdk#create-engine) method or pass it to the [setEventHandler](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-express-engine#set-event-handler) method to register callbacks.

<Warning title="Note">


It is recommended to register callbacks immediately after creating the engine or immediately after creating the engine to avoid missing event notifications.

</Warning>





<a id="loginRoom"></a>
### Log In to Room

**1. Log In**

Create a ZegoUser user object by passing in the user ID parameter "userID" and "userName", then call the [loginRoom](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-express-engine#login-room), and pass in the room ID parameter "roomID" and user parameter "user", to log in to the room. If the room does not exist, calling this interface will create and log in to this room.

- Within the same AppID, ensure that the "roomID" information is globally unique.
- Within the same AppID, ensure that the "userID" is globally unique. It is recommended that developers set it to a meaningful value and can associate the "userID" with their own business account system.
- The "userID" cannot be empty, otherwise it will cause room login failure.

```cpp
// Create user object
ZegoUser user("user1", "user1");
// Only by passing in a ZegoRoomConfig with the "isUserStatusNotify" parameter value set to "true" can you receive the onRoomUserUpdate callback.
ZegoRoomConfig roomConfig;
// If you use the appsign method for authentication, the token parameter does not need to be filled; if you need to use a more secure authentication method: token authentication, please refer to [How to upgrade from AppSign authentication to Token authentication](https://doc-zh.zego.im/faq/token_upgrade?product=ExpressVideo&platform=all)
// roomConfig.token = "xxxx";
roomConfig.isUserStatusNotify = true;
// Log in to room
engine->loginRoom(roomID, user, roomConfig, [=](){
    // (Optional callback) Log in to room result, if you only focus on the login result, pay attention to this callback
});
```

**2. Listen for Event Callbacks After Logging In to Room**

According to actual needs, listen for event notifications you care about after logging in to the room, such as room status updates, user status updates, stream status updates, etc.

- [onRoomStateChanged](@onRoomStateChanged): Room status update callback. After logging in to the room, when the room connection status changes (such as room disconnection, authentication failure, etc.), the SDK will notify through this callback.
- [onRoomUserUpdate](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-event-handler#on-room-user-update): User status update callback. After logging in to the room, when users are added to or removed from the room, the SDK will notify through this callback.

    Only when calling the [loginRoom](@loginRoom) interface to log in to the room with the [ZegoRoomConfig](@-ZegoRoomConfig) configuration, and the "isUserStatusNotify" parameter value is "true", can users receive the [onRoomUserUpdate](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-event-handler#on-room-user-update) callback.

- [onRoomStreamUpdate](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-event-handler#on-room-stream-update): Stream status update callback. After logging in to the room, when users in the room newly publish or remove audio and video streams, the SDK will notify through this callback.

<Warning title="Note">


- Only when calling the [loginRoom](@loginRoom) interface to log in to the room with the [ZegoRoomConfig](@-ZegoRoomConfig) configuration, and the "isUserStatusNotify" parameter value is "true", can users receive the [onRoomUserUpdate](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-event-handler#on-room-user-update) callback.

- Normally, if a user wants to play audio published by other users, they can call the [startPlayingStream](@startPlayingStream) interface in the stream status update (addition) callback to pull the remote published audio and video streams.

- Please note, do not call any SDK interfaces in the SDK callback thread, you need to manually switch to another thread, otherwise a deadlock will occur.


</Warning>



```cpp
// Room status update callback
void onRoomStateChanged(const std::string &roomID, ZegoRoomStateChangedReason reason, int errorCode, const std::string &extendedData) {
    if(reason == ZEGO_ROOM_STATE_CHANGED_REASON_LOGINING)
    {
        // Logging in
    }
    else if(reason == ZEGO_ROOM_STATE_CHANGED_REASON_LOGINED)
    {
        // Log in successful
        // Please note, do not call any SDK interfaces in the SDK callback thread, you need to manually switch to another thread, otherwise a deadlock will occur.
        // Only when the room status is login successful or reconnection successful can publishing (startPublishingStream) or playing (startPlayingStream) normally send and receive audio and video
        // Publish the local audio and video stream to the ZEGO audio and video cloud
    }
    else if(reason == ZEGO_ROOM_STATE_CHANGED_REASON_LOGIN_FAILED)
    {
        // Log in failed
    }
    else if(reason == ZEGO_ROOM_STATE_CHANGED_REASON_RECONNECTING)
    {
        // Reconnecting
    }
    else if(reason == ZEGO_ROOM_STATE_CHANGED_REASON_RECONNECTED)
    {
        // Reconnection successful
        // Please note, do not call any SDK interfaces in the SDK callback thread, you need to manually switch to another thread, otherwise a deadlock will occur.
    }
    else if(reason == ZEGO_ROOM_STATE_CHANGED_REASON_RECONNECT_FAILED)
    {
        // Reconnection failed
    }
    else if(reason == ZEGO_ROOM_STATE_CHANGED_REASON_KICK_OUT)
    {
        // Kicked out of the room
    }
    else if(reason == ZEGO_ROOM_STATE_CHANGED_REASON_LOGOUT)
    {
        // Log out successful
    }
    else if(reason == ZEGO_ROOM_STATE_CHANGED_REASON_LOGOUT_FAILED)
    {
        // Log out failed
    }
};

// User status update callback
void onRoomUserUpdate(const std::string& roomID, ZegoUpdateType updateType, const std::vector<ZegoUser>& userList) override {
    // Implement event callback according to needs
};

// Stream status update callback
void onRoomStreamUpdate(const std::string& roomID, ZegoUpdateType updateType, const std::vector<ZegoStream>& streamInfoList, const std::string& extendedData) override {
    // Implement event callback according to needs
};
```

<a id="publishingStream"></a>
### Publish Stream

**1. Start Publishing Stream**

Call the [startPublishingStream](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-express-engine#start-publishing-stream) interface, and pass in the stream ID parameter "streamID", to send the local audio and video stream to remote users.

<Warning title="Note">


Within the same AppID, ensure that the "streamID" is globally unique. If within the same AppID, different users each publish a stream with the same "streamID", it will cause the user who publishes later to fail to publish the stream.
</Warning>

In addition, it is recommended for developers to configure publishing parameters before starting publishing. If not configured, the SDK will use the default configuration. The SDK supports rich publishing parameter configuration, mainly including: video frame rate, bitrate, resolution, audio bitrate, etc.

```cpp
// Start publishing stream
engine->startPublishingStream("stream1");
```

**2. Listen for Event Callbacks After Publishing Stream**

According to actual application needs, listen for event notifications you care about after publishing the stream, such as publishing status updates, publishing quality, etc.

- [onPublisherStateUpdate](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-event-handler#on-publisher-state-update): Publishing status update callback. After the publishing interface is called successfully, when the publishing status changes (such as network interruption causing publishing exceptions, etc.), the SDK will notify through this callback while retrying to publish.
- [onPublisherQualityUpdate](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-event-handler#on-publisher-quality-update): Publishing quality callback. After the publishing interface is called successfully, it periodically calls back with audio and video stream quality data (such as resolution, frame rate, bitrate, etc.).

Event callbacks are all [ZegoExpressEngine](@-ZegoExpressEngine) delegates. Developers can directly assign their implemented callback handling functions to the corresponding delegates of [ZegoExpressEngine](@-ZegoExpressEngine), and then receive callbacks and process them.

```cpp
// Publishing status update callback
void onPublisherStateUpdate(const std::string& streamID, ZegoPublisherState state, int errorCode, const std::string& extendedData) {
    printf("onPublisherStateUpdate: streamID=%s", streamID.c_str());
        // ...
}
```

<Note title="Note">
If you need to understand Express's microphone/audio/speaker related interfaces, please refer to [FAQ - How to implement switching camera/video screen/microphone/audio/speaker?](http://doc-zh.zego.im/faq/How_to_switch_devices).
</Note>

### Play Stream

**1. Start Playing Stream**

Call the [startPlayingStream](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-express-engine#start-playing-stream) interface, based on the passed stream ID parameter "streamID", to pull the remote published audio and video stream.

The "streamID" published by remote users can be obtained from the [onRoomStreamUpdate](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-event-handler#on-room-stream-update) callback of the [ZegoEventHandler](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-event-handler).

```cpp
// Start playing stream
engine->startPlayingStream("123", nullptr);
```

**2. Listen for Event Callbacks After Playing Stream**


According to actual application needs, listen for event notifications you care about after playing the stream, such as playing status updates, playing quality, etc.

- [onPlayerStateUpdate](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-event-handler#on-player-state-update): Playing status update callback. After the playing interface is called successfully, when the playing status changes (such as network interruption causing publishing exceptions, etc.), the SDK will notify through this callback while retrying to play.
- [onPlayerQualityUpdate](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-event-handler#on-player-quality-update): Playing quality callback. After playing is successful, it calls back every 3 seconds with the quality data of the pulled audio and video stream (such as resolution, frame rate, bitrate, RTT, packet loss rate, etc.), allowing real-time monitoring of the health status of the pulled stream.

Event callbacks are all [ZegoExpressEngine](@-ZegoExpressEngine) delegates. Developers can directly assign their implemented callback handling functions to the corresponding delegates of [ZegoExpressEngine](@-ZegoExpressEngine), and then receive callbacks and process them.

```cpp
// Playing status update callback
virtual void onPlayerStateUpdate(const std::string& streamID, ZegoPlayerState state, int errorCode, const std::string& extendedData) {
    printf("onPlayerStateUpdate: streamID=%s", streamID.c_str());
        // ...
}
```

### Experience Real-time Audio and Video Functions

Run the project on a real device. After successful operation, you can see the local video screen.

For convenience, ZEGO provides a [Web Debugging Example ](https://zegodev.github.io/zego-express-webrtc-sample/assistDev/index.html). On this page, enter the same AppID and RoomID, enter different UserIDs, and the corresponding [Token](/console/development-assistance/temporary-token), and you can join the same room to communicate with real devices. When the audio and video call starts successfully, you can hear the remote audio and see the remote video screen.


<a id="stopPublishingStream"></a>
### Stop Publishing and Playing Streams

**1. Stop Publishing Stream**

Call the [stopPublishingStream](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-express-engine#stop-publishing-stream) interface to stop sending the local audio and video stream to remote users.

```cpp
// Stop publishing stream
engine->stopPublishingStream();
```

**2. Stop Playing Stream**

Call the [stopPlayingStream](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-express-engine#stop-playing-stream) interface to stop pulling the remote published audio and video stream.

<Warning title="Note">


If the developer receives a "decrease" notification for audio and video streams through the [onRoomStreamUpdate](@onRoomStreamUpdate) callback, please call the [stopPlayingStream ](@stopPlayingStream) interface in time to stop playing streams, to avoid pulling empty streams and generating additional costs; or, developers can choose the appropriate timing according to their business needs and proactively call the [stopPlayingStream ](@stopPlayingStream) interface to stop playing streams.

</Warning>



```cpp
// Stop playing stream
engine->stopPlayingStream("123");
```

### Log Out of Room

Call the [logoutRoom](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-express-engine#logout-room) interface to log out of the room.

```cpp
// Log out of room
engine->logoutRoom("123666");
```

### Destroy Engine

Call the [destroyEngine](https://doc-zh.zego.im/zh/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-zego-express-sdk#destroy-engine) interface to destroy the engine, used to release the resources used by the SDK.

```cpp
// Destroy engine instance
ZegoExpressSDK::destroyEngine(engine);
```

