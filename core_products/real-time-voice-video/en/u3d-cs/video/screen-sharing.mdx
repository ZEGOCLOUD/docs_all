---
articleID: 17974
date: "2025-01-20"
---

# Screen Sharing

- - -

## Function Overview

Screen sharing refers to sharing screen content as video with other audiences during video calls or interactive live streaming to enhance interactive experience and improve communication efficiency.

Screen sharing is widely used in the following scenarios:

- In video conference scenarios, screen sharing can share local files, data, web pages, PPT, and other visuals of the speaker with other participants;
- In online classroom scenarios, screen sharing can display courseware, notes, lecture content, and other visuals of the teacher to students.

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/screen_share_scene_new.png" /></Frame>

## Download Example Source Code

Please refer to [Download Example Source Code](/real-time-video-u3d-cs/quick-start/run-example-code) to get the source code.

For related source code, please view the "/Assets/ZegoExpressExample/Examples/Others/ScreenCapture.cs" file.

## Prerequisites

Before implementing screen sharing functionality, please ensure:

- Android: Supports Android 5.0 or above, and supports Android devices or emulators with audio and video (real devices are recommended).
- iOS:
  - Supports iOS 12.0 or above, and supports iOS devices or emulators with audio and video (real devices are recommended).
  - This feature has high device performance requirements and is recommended for use on iPhone X and later models.
- Windows:
  - Visual Studio 2013 or above.
  - Windows7, Windows8, Windows10 or above.

- You have created a project in [ZEGOCLOUD Console](https://console.zegocloud.com) and applied for valid AppID and AppSign. For details, please refer to [Console - Project Information](/console/project-info).
- You have integrated ZEGO Express SDK in the project and implemented basic audio and video publishing and playing functionality. For details, please refer to [Quick Start - Integration](/real-time-video-u3d-cs/quick-start/integrating-sdk) and [Quick Start - Implementation Flow](/real-time-video-u3d-cs/quick-start/implementing-video-call).


## Implementation Flow

<Warning title="Warning">

During screen capture, only iOS and Android platforms support simultaneous capture of video and audio; other platforms only support video capture. If audio capture is required, developers need to implement related logic themselves.

</Warning>




### 1 Enable screen sharing

The following describes how to enable screen sharing functionality for each development platform (Android, iOS, macOS, Windows).

<Accordion title="Android" defaultOpen="false">
The following figure shows the data flow for screen sharing on Android platform:

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/screen_capture_android_new.jpeg" /></Frame>

1. If you need to use the screen sharing feature, please make sure to [obtain user screen recording authorization](/real-time-video-android-java/video/screen-sharing#1-mandatory-obtain-user-screen-recording-authorization), otherwise you cannot use this feature.
2. Set the capture source to screen sharing source.

    - The default "video source" for SDK publishing is camera. If you need to publish screen sharing source, you need to switch to screen sharing through [SetVideoSource](@SetVideoSource).

    ```csharp
    engine.SetVideoSource(ZegoVideoSourceType.ScreenCapture, ZegoPublishChannel.Main);
    ```

    - The default "audio source" for SDK publishing is microphone. If you need to publish screen sharing source, you need to switch to screen sharing through [SetAudioSource](@SetAudioSource).

    ```csharp
    engine.SetAudioSource(ZegoAudioSourceType.ScreenCapture, ZegoPublishChannel.Main);
    ```

3. Call the [StartScreenCapture](@StartScreenCapture) interface to share the entire system's screen and capture third-party application audio to start screen sharing.

    ```csharp
    engine.StartScreenCapture();
    ```

    Developers can also use [ZegoScreenCaptureConfig](@-ZegoScreenCaptureConfig) parameters to set whether to capture video, whether to capture audio, set the sample rate and sample channel when capturing audio, etc.

    ```csharp
    ZegoScreenCaptureConfig config = new ZegoScreenCaptureConfig();
    config.captureVideo = true;
    config.captureAudio = true;
    config.audioParam.sampleRate = ZegoAudioSampleRate.ZegoAudioSampleRate16K;
    config.audioParam.channel = ZegoAudioChannel.Stereo;

    engine.StartScreenCapture(config);
    ```

4. Call the [UpdateScreenCaptureConfig](@UpdateScreenCaptureConfig) interface to update the screen sharing configuration.

    ```csharp
    ZegoScreenCaptureConfig config = new ZegoScreenCaptureConfig();
    config.captureVideo = true;
    config.captureAudio = false;
    config.audioParam.sampleRate = ZegoAudioSampleRate.ZegoAudioSampleRate32K;
    config.audioParam.channel = ZegoAudioChannel.Stereo;

    engine.UpdateScreenCaptureConfig(config);
    ```

5. Developers need to listen to the [OnMobileScreenCaptureExceptionOccurred](@OnMobileScreenCaptureExceptionOccurred) callback in the [IZegoEventHandler](@-IZegoEventHandler) class to receive exception notifications during screen sharing.

    ```csharp
    void OnMobileScreenCaptureExceptionOccurred(ZegoScreenCaptureExceptionType exceptionType)
    {

    }

    engine.onMobileScreenCaptureExceptionOccurred = OnMobileScreenCaptureExceptionOccurred;
    ```
</Accordion>

<Accordion title="iOS" defaultOpen="false">
iOS platform implements screen recording based on Apple's [Replaykit](https://developer.apple.com/documentation/ReplayKit) framework, which can share the entire system's screen content. However, the current App (main App process) needs to additionally provide an Extension extension component (Extension process) for recording the screen, and then combine with ZEGO Express SDK related APIs to implement screen sharing functionality. For details, please refer to the "Implementation Flow" description in [Screen Sharing (iOS)](/real-time-video-ios-oc/video/screen-sharing#implementation-flow).

1. Set the capture source to screen sharing source in the main App.

    - The default "video source" for SDK publishing is camera. If you need to publish screen sharing source, you need to switch to screen sharing through [SetVideoSource](@SetVideoSource).

    ```csharp
    engine.SetVideoSource(ZegoVideoSourceType.ScreenCapture, ZegoPublishChannel.Main);
    ```

     - The default "audio source" for SDK publishing is microphone. If you need to publish screen sharing source, you need to switch to screen sharing through [SetAudioSource](@SetAudioSource).

    ```csharp
    engine.SetAudioSource(ZegoAudioSourceType.ScreenCapture, ZegoPublishChannel.Main);
    ```

2. In-app screen sharing. If users only share visuals and sound within the app, they can call the [StartScreenCaptureInApp](@StartScreenCaptureInApp) interface to enable screen sharing. You can also call the [broadcastFinished](https://developer.apple.com/documentation/replaykit/rpbroadcastsamplehandler/2143169-broadcastfinished/) interface callback to notify the end of screen sharing. If screen capture fails, the reason for the failure can be received.

    ```csharp
    ZegoScreenCaptureConfig config = new ZegoScreenCaptureConfig();
    config.captureVideo = true;
    config.captureAudio = true;
    engine.StartScreenCaptureInApp(config);
    ```

3. Cross-app screen sharing. If users need to share the entire system's visuals and sound, they can call the [StartScreenCapture](@StartScreenCapture) interface to enable screen sharing.

<Note title="Note">

Cross-app screen sharing is recorded by the iOS system through the Extension extension process, so you need to additionally create the extension process and start it.

</Note>



    ```csharp
    ZegoScreenCaptureConfig config = new ZegoScreenCaptureConfig();
    config.captureVideo = true;
    config.captureAudio = true;

    engine.StartScreenCapture(config);
    ```

    1. Create a new Broadcast Upload Extension. For details, please refer to "Cross-app screen sharing" step 1 in [Screen Sharing (iOS)](/real-time-video-ios-oc/video/screen-sharing#2-start-screen-sharing).
    2. Set up Extension. For details, please refer to "Cross-app screen sharing" step 2 in [Screen Sharing (iOS)](/real-time-video-ios-oc/video/screen-sharing#2-start-screen-sharing).
    3. Start screen sharing. For details, please refer to "Cross-app screen sharing" step 3 in [Screen Sharing (iOS)](/real-time-video-ios-oc/video/screen-sharing#2-start-screen-sharing).
    4. Start the Extension extension process. For details, please refer to "Cross-app screen sharing" step 4 in [Screen Sharing (iOS)](/real-time-video-ios-oc/video/screen-sharing#2-start-screen-sharing).
    5. Get screen data. For details, please refer to "Cross-app screen sharing" step 5 in [Screen Sharing (iOS)](/real-time-video-ios-oc/video/screen-sharing#2-start-screen-sharing).
</Accordion>

<Accordion title="macOS/Windows" defaultOpen="false">
1. To develop the "screen sharing" feature on macOS platform, you need to set the following permissions. **No permissions need to be set on Windows platform.**

    Calling the screen sharing interface on macOS platform will obtain relevant permissions. You need to enable screen recording permissions and accessibility permissions in "Security & Privacy". If it does not take effect, you need to delete the previous permissions and add them again.

    - Screen recording permission

      <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/Adobe_Captivate.png" /></Frame>

    - Accessibility permission

      <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/Auxiliary_functions.png" /></Frame>

2. Get window (including screen) list information. You can get information about all currently shareable windows through the [GetScreenCaptureSources](@GetScreenCaptureSources) interface.

    ```csharp
    List<ZegoScreenCaptureSourceInfo> captureSources = engine.GetScreenCaptureSources(400, 400, 100, 100);
    ```

3. Through the window ID and window type in the above window information, call the [CreateScreenCaptureSource](@CreateScreenCaptureSource) interface to create a screen sharing source object.

    ```csharp
    if (captureSources.Count > 0) {
        var selectSource = captureSources.ElementAt(0);
        ZegoScreenCaptureSource captureSource = engine.CreateScreenCaptureSource(selectSource.sourceID, selectSource.sourceType);
    }
    ```

4. Set the capture source to screen sharing source. The default video source for SDK publishing is camera source. If you need to publish screen sharing source, you need to switch to screen sharing through [SetVideoSource](@SetVideoSource).

    ```csharp
    engine.SetVideoSource(ZegoVideoSourceType.ScreenCapture, (uint)captureSource.GetIndex(), ZegoPublishChannel.Main);
    ```

5. Start screen sharing. Call the [StartCapture](@StartCapture) interface to share window visuals.

    ```csharp
    captureSource.StartCapture();
    ```

6. Call the [UpdateCaptureSource](@UpdateCaptureSource) interface to update the shared window visuals.

    ```csharp
    var selectSource = captureSources.ElementAt(0);
    captureSource.UpdateCaptureSource(selectSource.sourceID, selectSource.sourceType);
    ```

7. Update sharing source region. Users can call the [UpdateCaptureRegion](@UpdateCaptureRegion) interface to dynamically update the shared window region. Setting it to (0, 0, 0, 0) can restore the entire window sharing.

    ```csharp
    ZegoRect rect = new ZegoRect
    {
        x = 10,
        y = 10,
        width = 400,
        height = 400
    };
    captureSource.UpdateCaptureRegion(rect);
    ```

8. Filter specified windows. Call the [SetExcludeWindowList](@SetExcludeWindowList) interface to filter out specified window visuals in the shared screen. This is only applicable when sharing the entire screen.

    ```csharp
    var selectSource = captureSources.ElementAt(0);
    List<long> excludeList = new List<long>();
    excludeList.Add(selectSource.sourceID);

    captureSource.SetExcludeWindowList(excludeList);
    ```

9. Users can call the [EnableWindowActivate](@EnableWindowActivate) interface to activate the currently shared window.

    ```csharp
    captureSource.EnableWindowActivate(true);
    ```

10. Call the [EnableCursorVisible](@EnableCursorVisible) interface to show or hide the mouse.

    ```csharp
    captureSource.EnableCursorVisible(true);
    ```

11. Listen to event callbacks.

    Through the methods [OnAvailableFrame](@OnAvailableFrame), [OnExceptionOccurred](@OnExceptionOccurred), [OnWindowStateChanged](@OnWindowStateChanged), [OnRectChanged](@OnRectChanged) in [IZegoScreenCaptureSourceEventHandler](@-IZegoScreenCaptureSourceEventHandler) to listen to event callbacks.

    ```csharp
    // Capture data callback, can be used for preview video rendering, local recording.
    void OnAvailableFrame(ZegoScreenCaptureSource source, System.IntPtr data,
                                            uint dataLength, ZegoVideoFrameParam param)
    {
    #if (UNITY_STANDALONE_WIN || UNITY_STANDALONE_OSX)
        localVideoSurface.LoadNativeVideoRawData(data, param.width, param.height, param.strides, param.format);
    #endif
    }

    // Capture exception callback, when there is an exception callback, capture will be interrupted.
    void OnExceptionOccurred(ZegoScreenCaptureSource source,
                                                    ZegoScreenCaptureSourceExceptionType exceptionType)
    {

    }

    // Window capture state callback, when the window region position changes, it will be notified through this callback. When the window is not in the current screen region, capture will stop.
    public void OnWindowStateChanged(ZegoScreenCaptureSource source,
                                                    ZegoScreenCaptureWindowState windowState,
                                                    ZegoRect windowRect)
    {

    }

    // Capture region changes, used to update encoding resolution when resolution changes
    public void OnRectChanged(ZegoScreenCaptureSource source, ZegoRect captureRect)
    {

    }

    captureSource.onAvailableFrame = OnAvailableFrame;
    captureSource.onExceptionOccurred = OnExceptionOccurred;
    captureSource.onWindowStateChanged = OnWindowStateChanged;
    captureSource.onRectChanged = OnRectChanged;
    ```
</Accordion>


### 2 Login room and start publishing stream

Call the [LoginRoom](@LoginRoom) interface, pass in the room ID parameter "roomID" and user parameter "user", to login to the room.

Call the [StartPublishingStream ](@StartPublishingStream) interface, pass in the stream ID parameter "streamID", to send the local audio and video stream to remote users.


```csharp
// Create user
ZegoUser user = new ZegoUser("user1");

// Start logging in to the room
engine.LoginRoom("room1", user);
// Start publishing stream
engine.StartPublishingStream("stream1");
```
At this point, we have completed the operation of capturing screen data and sharing it to remote ends through ZEGO Express SDK.


### 3 Watch remote screen sharing

After completing the above steps, other users can use the [StartPlayingStream](@StartPlayingStream) interface to play the screen sharing stream.

```csharp
// Play stream, need to pass in the streamID used when the user initiating screen sharing published the stream
engine.StartPlayingStream(streamID);
```

### 4 Stop screen sharing

Call the [StopScreenCapture](@StopScreenCapture) interface to stop sharing.

```csharp
engine.StopScreenCapture();
```
## FAQ

**When an Android device is fixed in portrait mode (auto-rotation disabled), opening screen capture causes popup orientation abnormalities and interface landscape/portrait switching. How to solve this?**

Due to the conflict between the device's fixed portrait mode and the App's landscape interface, rapid landscape/portrait switching during screen capture causes system data abnormalities and black screen. Solutions:

- Solution 1: Override SDK configuration through `tools:replace`

  The default orientation of the SDK screen sharing auxiliary Activity is "fullUser". You need to modify it in the project's AndroidManifest.xml:
  1. Add the "tools" tool namespace to the root node (manifest tag);
  2. Find the above Activity configuration, change its screen orientation (screenOrientation) to "unspecified", and add `tools:replace` to force override the SDK default configuration.
  After recompiling, the popup will be consistent with the App's landscape, avoiding switching black screens.

- Solution 2: Enable device auto-rotation

  Go to device "Settings > Display > Auto-rotate screen". After enabling, the popup orientation will follow the App's landscape without switching black screen issues.
