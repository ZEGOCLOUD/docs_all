# Quick Integration to HarmonyOS Platform

- - - -
This article will introduce how to quickly integrate the HarmonyOS platform based on Zego Express Unity3D SDK.

## Prepare Environment

Please ensure your development environment meets the following requirements:

- [Unity](https://unity.cn/tuanjie/tuanjieyinqing) 2018.4.21f1 or above (it is recommended to download the latest LTS version through Unity Hub).
- Ensure the running device is connected to the Internet.

<Note title="Note">


The Unity mentioned in this article refers to [Tuanjie Engine](https://unity.cn/tuanjie/tuanjieyinqing). Currently only the Tuanjie Engine of Unity China team supports the HarmonyOS platform.

</Note>





## 2 Import SDK

1. [Download ZEGO Express Unity3D SDK](/real-time-video-u3d-cs/client-sdk/download-sdk) and unzip the ZegoExpressUnity3D.zip file.
2. Copy the files under the unzipped "Assets/Plugins/OpenHarmony" directory to the corresponding directory in your own created Unity project.

<Note title="Note">


     - If there is no OpenHarmony folder under the "Assets/Plugins/" directory in the Unity project, you need to manually create it to keep the same directory.
     - Zego Express SDK supports arm64-v8a, armeabi-v7a, and x86_64 ABIs by default. In mobile scenarios and under Unity, arm64-v8a is used by default, so you can delete the armeabi-v7a and x86_64 ABI files.

</Note>



2. Copy all files under the unzipped "Assets/Scripts/" to the corresponding directory in your own created Unity project.

<Note title="Note">


   If the Unity project has previously integrated other platform SDKs of ZEGO Express, then the corresponding directory under the Unity project should already have these files, so this operation is not required, but it is recommended to update to the latest files.

</Note>





## Modify Code Configuration

1. At the Unity project entry, introduce the OpenHarmony namespace.
   ```
    #if UNITY_OPENHARMONY
    using UnityEngine.OpenHarmony;
    #endif
   ```
2. In Unity Editor, select "File > Build Settings", check "Export Project" to export the OpenHarmony project.

3. Use DevEco Studio to open the exported project, select "File > Project Structure > Signing Configs", and add a signature.

<Note title="Note">


   Since Unity currently does not support simulators, you need to use a real device for debugging. Real device debugging requires additionally checking "Automatically generate signature".

</Note>


4. In the exported project, open the TuanjiePlayerAbility.ets file under the "entry/src/main/ets/ability" directory, and add the following initialization code.
    ```
    import { ZegoOpenHarmony } from '../zegoets/utils/ZegoOpenHarmony'

    onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {

    //...
    ZegoOpenHarmony.initEnv(this.context.getApplicationContext());
    }
    ```
5. In the exported project, find the module.json5 file and ensure it contains the following permission declarations.
    ```json
    {
      "name": "ohos.permission.INTERNET",
      "usedScene": {
        "abilities": [
          "TuanjiePlayerAbility"
        ],
        "when": "always"
      },
      "reason": "$string:default_reason"
    },
    {
      "name": "ohos.permission.ACCELEROMETER",
      "usedScene": {
        "abilities": [
          "TuanjiePlayerAbility"
        ],
        "when": "always"
      },
      "reason": "$string:default_reason"
    },
    {
      "name": "ohos.permission.MICROPHONE",  // Microphone permission
      "reason": "$string:default_reason",
      "usedScene": {
        "abilities": [
          "TuanjiePlayerAbility"
        ],
        "when": "inuse"
      }
    },
    {
      "name": "ohos.permission.CAMERA",  // Camera permission
      "reason": "$string:default_reason",
      "usedScene": {
        "abilities": [
          "TuanjiePlayerAbility"
        ],
        "when": "inuse"
      }
    },
    {
      "name": "ohos.permission.ACCESS_BLUETOOTH",  // Bluetooth permission
      "reason": "$string:default_reason",
      "usedScene": {
        "abilities": [
          "TuanjiePlayerAbility"
    ],
    "when": "always"
      }
    },
    {
      "name": "ohos.permission.GET_NETWORK_INFO",  // Network status permission
      "reason": "$string:default_reason",
      "usedScene": {
        "abilities": [
          "TuanjiePlayerAbility"
        ],
        "when": "always"
      }
    },
    {
      "name": "ohos.permission.KEEP_BACKGROUND_RUNNING",
      "usedScene": {
        "abilities": [
          "TuanjiePlayerAbility"
        ],
        "when": "always"
      }
    }
    ```
6. In UNITY_2018_3_OR_NEWER or above, Unity will not actively obtain camera and microphone permissions. Developers need to call to obtain permissions.
    ```json
    #if UNITY_OPENHARMONY
    using UnityEngine.OpenHarmony;
    #endif

    private ArrayList permissionList = new ArrayList();

    #if (UNITY_2018_3_OR_NEWER)
            permissionList.Add(Permission.Microphone);
            permissionList.Add(Permission.Camera);

            foreach (string permission in permissionList)
            {
                if (Permission.HasUserAuthorizedPermission(permission) == false)
                {
                    Permission.RequestUserPermission(permission);
                }
            }
    #endif
    ```

After completing the above operations, you have integrated the HarmonyOS platform and developed related applications.

## FAQ

#### Can WebCamTexture be used on the HarmonyOS platform?
Not supported yet

#### How to use the media player module on the HarmonyOS platform?

If the HarmonyOS platform needs to use the media player module normally, the following configuration needs to be added
```
ZegoEngineConfig engineConfig = new ZegoEngineConfig();
engineConfig.advancedConfig  = new Dictionary<string, string>();
engineConfig.advancedConfig.Add("mediaplay_cache_type", "2");
ZegoExpressEngine.SetEngineConfig(engineConfig);
```

#### When debugging on a real device, the error "code:9568322 error: signature verification failed due to not trusted app source" appears. How to handle it?

Signature issue. Every time you use a new test machine, you need to [re-confirm the signature configuration](https://developer.huawei.com/consumer/cn/doc/harmonyos-faqs-V5/faqs-app-debugging-9-V5).

#### When debugging on a real device, the error "TypeError: Cannot read property Zego_TsApi_InitNapiFunc of undefined" appears. How to handle it?

Please ensure that the [Import SDK Steps](https://doc-zh.zego.im/article/21309#2) are executed correctly. And ensure that in the exported project, the "entry/libs/" directory contains the "libZegoExpressEngine.so" file; the "entry/src/main/ets/" directory contains "zegoets" and related files.
