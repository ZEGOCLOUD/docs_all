---
articleID: 19539
date: "2024-04-02"
---
# Switching from CDN Stream Playing to Co-hosting Scenario

- - -

## Introduction

In the co-hosting scenario, since both CDN stream playing and CDN stream publishing have high latency, the interactive experience during the co-hosting process will be very poor. Therefore, it is recommended to use RTC stream playing and RTC stream publishing during the co-hosting process, and restore CDN stream playing after getting off the mic to improve the co-hosting experience. This document will introduce how to implement the co-hosting process under the complete CDN address stream playing method.

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Common/ZegoExpressEngine/CDN_To_Call_Scenario.png" /></Frame>

### Comparison of Stream Playing Methods

<table>

<tbody><tr>
<th>Stream Playing Method</th>
<th>Applicable Scenario</th>
<th>Latency Situation</th>
</tr>
<tr>
<td>Play stream from CDN</td>
<td>Audiences do not need to co-host with the host, and interact with the host through bullet comments and other methods, with low requirements for viewing real-time performance.</td>
<td>Latency exceeds 3 seconds</td>
</tr>
<tr>
<td>Play stream from RTC</td>
<td>Audiences need to co-host with the host, and have high requirements for real-time interaction and communication with the host.</td>
<td>Latency between both co-hosting parties is lower than 300 ms</td>
</tr>
</tbody></table>


## Prerequisites

To switch from CDN stream playing to co-hosting scenario, please ensure that the current audio and video stream has implemented [Playing Stream by URL](/real-time-video-windows-cpp/live-streaming/playing-stream-by-url).

## Implementation Steps

### Audience switches stream playing method

When switching from CDN stream playing to co-hosting scenario, the audience needs to call [stopPlayingStream](@stopPlayingStream) to stop the current CDN stream playing, and call [startPlayingStream](@startPlayingStream) to switch to RTC stream playing.

```cpp
//Stop the current CDN stream playing, pass in the corresponding host stream ID
engine->stopPlayingStream(anchorStreamID);
//Switch to RTC stream playing
ZegoCanvas canvas(ZegoUtilHelper::GetView(ui->frame_Play));
ZegoPlayerConfig config;
config.resourceMode = ZEGO_STREAM_RESOURCE_MODE_ONLY_RTC;
engine->startPlayingStream(m_currentPlayStreamId, &canvas, config);
```

### Audience starts preview and publishes stream

Pass in the audience's stream ID, and start preview [startPreview](@startPreview) and publish stream [startPublishingStream](@startPublishingStream), and the co-hosting will be successful.


```cpp
//Start preview
ZegoCanvas canvas(ZegoUtilHelper::GetView(ui->frame_Preview));
engine->startPreview(&canvas);
//Start publishing stream, and pass in the audience's stream ID
engine->startPublishingStream(pulishingStreamID);
```

### Audience stops preview and publishing stream

If the co-hosting ends, the audience can call the [stopPreview](@stopPreview) and [stopPublishingStream](@stopPublishingStream) interfaces to stop preview and publishing stream.

```cpp
//Stop preview
engine->stopPreview();
//Stop publishing stream
engine->stopPublishingStream();
```


### Audience co-hosting ends

When co-hosting ends, pass in the host's stream ID, and call the [stopPlayingStream](@stopPlayingStream) interface on the audience side to stop RTC stream playing, switch back to CDN stream playing, and set CDN parameters through [ZegoViewMode](@-ZegoViewMode). For details, please refer to [Playing Stream by URL](/real-time-video-windows-cpp/live-streaming/playing-stream-by-url).

```cpp
//Stop the current RTC stream playing
engine->stopPlayingStream(anchorStreamID);
//Switch to CDN stream playing
ZegoCanvas canvas(ZegoUtilHelper::GetView(ui_->frame_View3));
ZegoPlayerConfig config;
ZegoCDNConfig cdn_config;
cdn_config.url = "rtmp://xxxxxxxx"; // URL is the CDN stream playing address
cdn_config.authParam = "xxx"; // If authentication is required, set the authentication parameter; if authentication is not required, it can be not set (authentication parameter cannot contain "?" character)
engine_->startPlayingStream(anchorStreamID, &canvas, config);
```

### Host starts and stops stream playing

The host receives the audience stream addition notification through the [onRoomStreamUpdate](@onRoomStreamUpdate) callback in [IZegoEventHandler](@-IZegoEventHandler), and can start RTC stream playing. When receiving the audience stream deletion notification, stop RTC stream playing.

```cpp
void onRoomStreamUpdate(const std::string &roomID, ZegoUpdateType updateType, const std::vector<ZegoStream> &streamList, const std::string& extendData) {
for_each(streamList.begin(), streamList.end(), [&](ZegoStream stream){
    if(updateType == ZEGO_UPDATE_TYPE_ADD){
        // RTC stream playing
        ZegoCanvas canvas(ZegoUtilHelper::GetView(ui->frame_Play));
        ZegoPlayerConfig config;
        config.resourceMode = ZEGO_STREAM_RESOURCE_MODE_ONLY_RTC;
        engine->startPlayingStream(stream.streamID, &canvas, config);
    }
    if(updateType == ZEGO_UPDATE_TYPE_DELETE){
        engine->stopPlayingStream(stream.streamID);
    }
});
}
```
