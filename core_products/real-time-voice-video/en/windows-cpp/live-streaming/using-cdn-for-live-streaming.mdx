---
articleID: 1189
date: "2024-01-02"
---
# Using CDN for Live Streaming

---

## Feature Introduction

ZEGO Express SDK supports publishing streams to CDN (Content Delivery Network), including two functions: relaying to CDN and direct publishing to CDN. Based on this function, developers can connect RTC products and CDN live streaming products, making it convenient for users to directly watch and listen to live streaming content from web pages or third-party players. To ensure security, CDN authentication is enabled by default when publishing streams to CDN.

To prevent attackers from stealing or forging your publishing URL addresses, you can refer to [CDN Stream Publishing Authentication](/real-time-video-windows-cpp/live-streaming/cdn-stream-publishing-authentication) to improve the security of your stream publishing usage.

<Warning title="Attention">

When initiating relay to CDN or direct publishing to CDN, please note that CDN has requirements for audio and video formats. The publishing end audio supports AAC and MP3, and video supports H.264 and H.265 (requires CDN configuration).

</Warning>

### Relaying to CDN

Relaying to CDN refers to the process of pushing audio and video streams from ZEGO real-time audio and video cloud to ZEGO's own CDN or third-party CDN.

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Common/ZegoExpressEngine/relay_cdn.png" /></Frame>

Relaying to CDN includes the following three methods:

<table>

<tbody><tr>
<th>Relay Method</th>
<th>Description</th>
</tr>
<tr>
<td>Default Relay to CDN</td>
<td>All live streams published by users to ZEGO real-time audio and video cloud using ZEGO Express SDK will be relayed to CDN, currently only supports ZEGO's own CDN.</td>
</tr>
<tr>
<td>Bypass Relay to CDN</td>
<td>Developers customize and specify streams on ZEGO real-time audio and video cloud to be relayed to CDN, supporting ZEGO's own CDN and third-party CDN.</td>
</tr>
<tr>
<td>Stream Mixing Relay to CDN</td>
<td>In stream mixing scenarios, output streams can also be relayed to CDN, supporting ZEGO's own CDN and third-party CDN.</td>
</tr>
</tbody></table>

### Direct Publishing to CDN

Direct publishing to CDN refers to the process of pushing audio and video streams directly from the local client to CDN. Users can directly watch from web pages or third-party players by playing stream URL addresses. However, because the direct publishing to CDN function does not pass through ZEGO real-time audio and video cloud during network transmission, developers cannot use ZEGO's real-time audio and video services.

<Frame width="512" height="auto" caption="">
  <img src="https://doc-media.zego.im/sdk-doc/Pics/Android/streamByCdn/direct_to_cdn.png" />
</Frame>

### Feature Comparison

The descriptions and usage scenarios of the two functions are as follows:

<table>

<tbody><tr>
<th>Feature</th>
<th>Description</th>
<th>Usage Scenarios</th>
</tr>
<tr>
<td>Relaying to CDN (Recommended)</td>
<td>Publishing stream first goes through ZEGO real-time audio and video cloud, then is relayed to CDN by ZEGO real-time audio and video cloud. Can use ZEGO's real-time audio and video services, suitable for scenarios requiring co-hosting interaction.</td>
<td>Developers have business cooperation with third-party CDNs and want to use their original third-party CDN streaming media network distribution services while also using ZEGO Express SDK for real-time co-hosting interaction. Suitable for business scenarios with co-hosting interaction requirements, such as talent show live streaming, audio chat rooms, etc.</td>
</tr>
<tr>
<td>Direct Publishing to CDN</td>
<td>Publishing stream does not pass through ZEGO real-time audio and video cloud, directly pushes to CDN. Cannot use ZEGO's real-time audio and video services, suitable for single live streaming scenarios (no interaction).</td>
<td>Suitable for situations where developers do not need to use real-time co-hosting interaction and other services, such as e-commerce live streaming, gaming live streaming, large classes, etc.</td>
</tr>
</tbody></table>

## Prerequisites

Before using CDN live streaming, ensure that:

- You have created a project in the [ZEGOCLOUD Console](https://console.zego.im) and applied for a valid AppID and AppSign. For details, please refer to [Console - Project Information](/console/project-info).
- You have integrated ZEGO Express SDK into your project and implemented basic audio and video stream publishing and playing functionality. For details, please refer to [Quick Start - Integration](/real-time-video-windows-cpp/quick-start/integrating-sdk) and [Quick Start - Implementation](/real-time-video-windows-cpp/quick-start/implementing-video-call).

<Warning title="Attention">

The CDN live streaming function is not enabled by default. Please enable it yourself in the [ZEGOCLOUD Console](https://console.zego.im) before use (for enabling steps, please refer to "CDN" in [Project Management - Service Configuration](/console/service-configuration/activate-cdn-service)), or contact ZEGO Technical Support to enable it.

</Warning>

## Example Source Code Download

Please refer to [Download Example Source Code](/real-time-video-windows-cpp/quick-start/run-example-code) to get the source code.

For relevant source code, please see files in the "/ZegoExpressExample/Examples/AdvancedStreaming/StreamByCDN" directory.

## Relaying to CDN

<Note title="Description">

If you choose to use direct publishing to CDN function, you do not need to perform all steps in this section, please refer to [Direct Publishing to CDN](/real-time-video-windows-cpp/live-streaming/using-cdn-for-live-streaming).

</Note>

### Initialize and Login to Room

Please refer to "Create Engine" and "Login Room" in [Quick Start - Implementation](/real-time-video-windows-cpp/quick-start/implementing-video-call).

### Start Publishing Stream

Please refer to "Publishing Stream" in [Quick Start - Implementation](/real-time-video-windows-cpp/quick-start/implementing-video-call).

### Start Relaying

After publishing stream successfully, call the [addPublishCdnUrl](@addPublishCdnUrl) interface to add dynamically relaying to CDN URLs, which allows you to dynamically relay audio and video streams that have been successfully published to ZEGO real-time cloud to third-party CDNs. The supported relay address format is "rtmp".

<Note title="Description">

- If developers have the need to relay to multiple third-party CDN vendors, they can use the same stream ID to call the [addPublishCdnUrl](@addPublishCdnUrl) interface multiple times (URLs need to be different).
- After developers relay to multiple third-party CDNs, when stopping relaying, they also need to call multiple times to stop all relayed streams.
- After developers relay to multiple third-party CDNs, they can obtain state change notifications for each relayed stream from the list parameter of the CDN callback state notification [onPublisherRelayCDNStateUpdate](@onPublisherRelayCDNStateUpdate).

</Note>

```cpp
// After publishing stream successfully, start relaying to CDN

// Stream ID used when publishing stream
std::string streamID = "STREAM_ID";
// CDN address to be relayed, please fill in according to the actual URL, streamID is the stream name for publishing, can be customized
std::string URL = "rtmp://domain_name/ingest_point/streamID";
engine->addPublishCdnUrl(streamID, URL, [=](int errorCode){
    if(errorCode == 0)
    {
        // Relay successful
    } else
    {
        // Relay failed, possibly due to network reasons causing relay request sending to fail
    }
});
```

### (Optional) Listen to CDN Callback State Notifications

If you need to listen to CDN callback state notifications, please refer to [Monitor CDN Relay Status](/real-time-video-windows-cpp/communication/monitor-stream-quality).

### Stop Relaying

Call [removePublishCdnUrl](@removePublishCdnUrl) to delete the URL dynamically relayed to CDN. **When calling the [removePublishCdnUrl](@removePublishCdnUrl) interface to stop relaying, please ensure that the current stream streamID exists.**

<Warning title="Attention">

This interface will not stop the audio and video streams published to ZEGO real-time audio and video cloud.

</Warning>

```cpp
// Stream ID used when publishing stream
std::string streamID = "STREAM_ID";
// CDN address to stop relaying, please fill in according to the actual URL, streamID is the stream name for publishing
std::string URL = "rtmp://domain_name/ingest_point/streamID";
engine->removePublishCdnUrl(streamID, URL, [=](int errorCode){
    if(errorCode == 0)
    {
        // Stop relaying successful
    } else
    {
        // Stop relaying failed, possibly due to network reasons causing stop relaying request sending to fail
    }
});
```

## Direct Publishing to CDN
<Note title="Description">

If you choose to use relaying to CDN function, you do not need to perform all steps in this section, please refer to [Relaying to CDN](/real-time-video-windows-cpp/live-streaming/using-cdn-for-live-streaming).

</Note>

### Start Direct Publishing to CDN

Before publishing stream, call the [enablePublishDirectToCDN](@enablePublishDirectToCDN) interface to publish audio and video streams directly to CDN.

<Warning title="Attention">

- After calling the [enablePublishDirectToCDN](@enablePublishDirectToCDN) interface, calling [addPublishCdnUrl](@addPublishCdnUrl) and [removePublishCdnUrl](@removePublishCdnUrl) to dynamically relay to CDN will no longer take effect, because these two interfaces relay or stop relaying audio and video streams to CDN from ZEGO real-time audio and video cloud. If audio and video streams are published directly to CDN, they cannot be dynamically relayed to CDN through ZEGO real-time audio and video cloud again.
- If calling the [enablePublishDirectToCDN](@enablePublishDirectToCDN) interface results in error code 1000038, possible problems are: domain configuration error, media network exception, or media network link is empty, please contact ZEGO Technical Support.

</Warning>

```cpp
ZegoCDNConfig config;
// URL needs to be filled in by developers according to actual situation, streamID is the stream name for publishing, can be customized
config.url = "rtmp://domain_name/ingest_point/streamID";
engine->enablePublishDirectToCDN(true, &config);
engine->startPublishingStream("STREAM_ID");
```

### Stop Direct Publishing to CDN

To stop direct publishing to CDN, call the [stopPublishingStream](@stopPublishingStream) interface to stop publishing stream.

After stopping publishing stream, if the next publishing stream does not need direct publishing to CDN, you can call the [enablePublishDirectToCDN](@enablePublishDirectToCDN) interface and pass "false" to disable the direct publishing to CDN function. Calling this interface during publishing stream will not affect the current publishing stream.

```cpp
engine->stopPublishingStream();
ZegoCDNConfig cdnConfig;
engine->enablePublishDirectToCDN(false, &cdnConfig);
```

## Audience Playing Stream

- When the publishing end directly publishes to CDN, the playing end can directly play streams through streamID, please refer to "Playing Stream" in [Quick Start - Implementation](/real-time-video-windows-cpp/quick-start/implementing-video-call).

- After audio and video streams are successfully relayed to CDN, when developers want users to play streams from CDN, they need to use the custom playing method of passing in URL to play streams, and cannot play streams through stream ID. For URL playing operation steps, please refer to "1 Configure Stream Playing Parameters" and "2 Start Playing Stream" in [Playing Stream by URL](/real-time-video-windows-cpp/live-streaming/playing-stream-by-url).
