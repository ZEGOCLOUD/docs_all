---
articleID: 17570
date: "2024-01-02"
---
# Play Transparent Gift Effects

- - -
## Feature Overview

In scenarios such as audio chat rooms and live streaming, gifts are an important part of the interaction between hosts and viewers. Exquisite gift effects can enhance the sense of interaction and improve the viewing experience. With the vigorous development of the industry, gift effects have also evolved from static to dynamic, and from opaque to transparent.

Playing gift videos in MP4 format to achieve dynamic gift effects is a relatively common approach. Since MP4 does not support Alpha channels, when playing gift effects in full screen, it will block the live room content, thereby affecting user experience. Therefore, the ZEGO Express SDK media player provides transparent rendering capability, which can implement the function of playing transparent dynamic gifts.

The ZEGO Express SDK media player provides the capability to play MP4 materials with separated RGB and Alpha channels (MP4 materials after splicing RGB and Alpha), achieving the dynamic effect of playing transparent gifts. That is, when playing gift effects, it will not block the live room content, greatly improving user experience.

<video poster="https://doc-media.zego.im/sdk-doc/Pics/Express/gift_special_effects.png" src="https://doc-media.zego.im/sdk-doc/doc/video/Express_Video_SDK/gift_special_effects.mp4" width="70%" muted="true" loop="true" autoplay="autoplay" preload="auto" nocontrols></video>

### Feature Advantages

- **Low Development Cost**

    Developers do not need to learn complex animation implementation solutions. They only need to use materials processed by designers to implement playing transparent gift effects, improving development efficiency and effectiveness.

- **High Animation Fidelity**

    Help designers achieve WYSIWYG output materials. That is, when designers are designing motion effects, they do not need to worry about whether the technology stack used by developers can restore complex 3D effects, strokes, particle effects, etc.

- **Good Compatibility**

    Avoid the problems of complex implementation, low performance, poor compatibility with some device models, and high maintenance difficulty in the later stage of semi-transparent motion effects such as Lottie and Cocos2d-X.

### Implementation Principle

As shown in the figure below, the upper part of the figure shows some pixel points of a material with Alpha channel separation. The left side uses the RGB channel to store the RGB channel information of the gift material, and the right side uses the RGB channel to store the Alpha channel information of the gift material.

During playback, the client extracts the R channel of the video on the right as the value of the Alpha channel of the corresponding pixel on the left.

During rendering, the Alpha channel value is divided by 255 for normalization to obtain an Alpha value between 0 and 1. Finally, each pixel is rendered on the screen according to the RGBA value to achieve a semi-transparent effect.

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/RGBtoRGBA.jpeg" /></Frame>


## Sample Source Code Download


Please refer to [Download Sample Source Code](/real-time-video-windows-cpp/quick-start/run-example-code) to obtain the source code.

For related source code, please check the files in the "/ZegoExpressExample/Examples/Others/MediaPlayer" directory.



## Prerequisites

Before using the media player to play MP4 dynamic effects, that is, to implement playing transparent gift effects, please ensure:

- A project has been created in the [ZEGO Console](https://console.zego.im), and valid AppID and AppSign have been obtained. For details, please refer to [Console - Project Information](/console/project-info).
- ZEGO Express SDK has been integrated into the project, and basic audio/video publishing and playing functionality has been implemented. For details, please refer to [Quick Start - Integration](/real-time-video-windows-cpp/quick-start/integrating-sdk) and [Quick Start - Implementation](/real-time-video-windows-cpp/quick-start/implementing-video-call).




## Implementation Steps

### 1 Export Materials

Taking exporting materials in AE software as an example.

1. In AE, normally create a video with transparency effects, and export RGB and Alpha channel videos separately.
    - Export the RGB channel video.
        <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/output_RGB.jpeg" /></Frame>
    - Export the Alpha channel video.
        <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/output_Alpha.jpeg" /></Frame>


2. In AE, splice the exported RGB and Alpha channel videos into one video.

    ZEGO media player supports the following four splicing methods. The more square the spliced video is, the better the performance. Developers can choose the appropriate splicing method according to the proportion of the source material:
    - Alpha channel at the bottom.
        <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/RGB_up_Alpha.jpeg" /></Frame>
    - Alpha channel on the left.
        <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/Alpha_RGB.jpeg" /></Frame>
    - Alpha channel on the right.
        <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/RGB_Alpha.jpeg" /></Frame>
    - Alpha channel at the top right, Alpha channel only supports 0.5x scaling rate.
        <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/RGB_Alpharighttop.jpeg" /></Frame>


### 2 Create Media Player

Call [createMediaPlayer](@createMediaPlayer) to create a media player, and call [setPlayerCanvas](@setPlayerCanvas-IZegoMediaPlayer) to set the `alphaBlend` property of the player canvas to `true`.

```cpp
ZegoCanvas canvas(mediaPlayerView);// mediaPlayerView is the media player view
canvas.alphaBlend = true;// Support Alpha channel rendering
mediaPlayer->setPlayerCanvas(&canvas);
```

### 3 Load Materials

After calling [createMediaPlayer](@createMediaPlayer) to create a media player, use the [loadResourceWithConfig](@loadResourceWithConfig-ZegoMediaPlayer) interface to play the spliced effect materials through **file path** or **binary memory data**.

<Warning title="Note">


Although the [loadResourceWithConfig](@loadResourceWithConfig-ZegoMediaPlayer) interface supports loading multimedia resources through copyrighted music resource ID, copyrighted music currently does not support video, so gift effects cannot be loaded through the copyrighted music resource ID loading method.
</Warning>

<CodeGroup>
```cpp title="Load via file path"
  ZegoMediaPlayerResource resource;
  resource.loadType = ZEGO_MULTIMEDIA_LOAD_TYPE_MEMORY;// Select file path loading method
  resource.filePath = "filePath";// File path
  resource.alphaLayout = ZEGO_ALPHA_LAYOUT_TYPE_LEFT;// Select Alpha channel layout according to actual resources
  mediaPlayer->loadResourceWithConfig(resource, [=](int errorCode){
      // Resource loading result
      // Can perform logic such as updating UI
      if (errorCode == 0) {
          // File loaded successfully, can start playing media resources at this time
          mediaPlayer->start();
      }
  });
  ```
```cpp title="Load via binary memory data"
  // Load resource file and return binary data
  unsigned char* ZegoUtilHelper::LoadResourceFile(const QString& filePath, int& dataSize)
  {
      // Load resource file
      QResource resource(filePath);
      if (!resource.isValid()) {
          return nullptr;
      }

      // Read resource data
      QByteArray data;
      if(resource.isCompressed()){
          data = resource.uncompressedData();
      }else{
          int dataSize = resource.size();
          data = {(char *)resource.data(), dataSize};
      }

      // Allocate memory and copy data
      unsigned char* buffer = new unsigned char[data.size()];
      std::memcpy(buffer, data.constData(), data.size());

      // Update data size
      dataSize = data.size();

      return buffer;
  }

  ZegoMediaPlayerResource resource;
  resource.loadType = ZEGO_MULTIMEDIA_LOAD_TYPE_FILE_PATH;// Select binary memory data loading method
  resource.alphaLayout = ZEGO_ALPHA_LAYOUT_TYPE_LEFT;// Select Alpha channel layout according to actual resources

  QString resourcePath = ":/media/Resources/Alpha/alpha_left/source1_complex_rl.mp4";
  int dataSize = 0;
  unsigned char *memPtr = ZegoUtilHelper::LoadResourceFile(resourcePath, dataSize);
  if(memPtr != nullptr && dataSize != 0){
      resource.memory = memPtr;
      resource.memoryLength = dataSize;
  }

  mediaPlayer->loadResourceWithConfig(resource, [=](int errorCode){
      // Resource loading result
      // Can perform logic such as updating UI
      if (errorCode == 0) {
          // File loaded successfully, can start playing media resources at this time
          mediaPlayer->start();
      }
  });

  // Release memory
  if(memPtr != nullptr){
      delete[] memPtr;
  }
  ```
</CodeGroup>

### 4 Play Materials

After successfully loading the file by calling [loadResourceWithConfig](@loadResourceWithConfig-IZegoMediaPlayer), you can call [start](@start-IZegoMediaPlayer), [pause](@pause-IZegoMediaPlayer), [resume](@resume-IZegoMediaPlayer), [stop](@stop-IZegoMediaPlayer) to start and stop playback. Once the player's internal state changes, the [onMediaPlayerStateUpdate](@onMediaPlayerStateUpdate-IZegoMediaPlayerEventHandler) callback of [IZegoMediaPlayer](@-IZegoMediaPlayer) will be triggered.

Developers can also call [getCurrentState](@getCurrentState-IZegoMediaPlayer) at any time to get the current state of the player.

If [enableRepeat](@enableRepeat-IZegoMediaPlayer) is set to `true`, the player will automatically replay after finishing playing the file.

```cpp
// Start playback, need to call the interface to load media file first before playing
mediaPlayer->start();
// Pause
mediaPlayer->pause();
// Resume
mediaPlayer->resume();
// Stop
mediaPlayer->stop();
```
