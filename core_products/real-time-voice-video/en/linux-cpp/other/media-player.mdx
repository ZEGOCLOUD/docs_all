---
articleID: 6842
date: "2024-07-27"
---
# Media Player

- - -

import Content from '/core_products/real-time-voice-video/zh/snippets/media-player-pre.mdx'

<Content />

## Usage Steps

### 1 Create Media Player

Call the [createMediaPlayer](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-express-engine#create-media-player) interface of `ZegoExpressEngine` to create a media player instance. One media player instance can only play one audio/video file. The engine supports creating up to 10 players at the same time to achieve the effect of playing multiple files simultaneously. If more than 10 are created, the creation will fail and the interface will return `nullptr`.

```cpp
IZegoMediaPlayer* mediaPlayer = engine->createMediaPlayer();
if (mediaPlayer == nullptr) {
    printf("Failed to create player");
}
```

### 2 (Optional) Set Event Callback for Player

<Accordion title="Player Event Callback Setting" defaultOpen="false">
Call the media player's [setEventHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#set-event-handler) interface to set the event callback [IZegoMediaPlayerEventHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player-event-handler) for the player to receive notifications such as `player playing state change`, `player network state update`, `player playing progress change`, etc.

```cpp
// Please note, do not call any SDK interfaces in the SDK callback thread, you need to manually switch to another thread, otherwise a deadlock will occur
class MyMediaPlayerEventHandler: public IZegoMediaPlayerEventHandler{
public:
    // Player playing state change and event callback
    void onMediaPlayerStateUpdate(IZegoMediaPlayer* mediaPlayer, ZegoMediaPlayerState state, int errorCode) override{
        printf("currentState: %d", state);
    }

    // Player network state event callback
    void onMediaPlayerNetworkEvent(IZegoMediaPlayer* mediaPlayer, ZegoMediaPlayerNetworkEvent networkEvent) override {
        printf("networkEvent: %d", networkEvent);
    }

    // Player playing progress callback
    void onMediaPlayerPlayingProgress(IZegoMediaPlayer* mediaPlayer, unsigned long long millisecond) override {
        printf("currentProgress:%lld", millisecond);
    }
}

auto eventHandler = std::make_shared<MyMediaPlayerEventHandler>();
mediaPlayer->setEventHandler(eventHandler);
```
</Accordion>

### 3 Load Media Resource

Call the media player's [loadResource](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#load-resource) to specify the media resource to play. It can be the absolute path of a local resource, such as `D:/Zego/your-movie.mp4`, or the URL of a network resource, such as `http://your.domain.com/your-movie.mp4`. Users can get the result of loading the file by passing in callback parameters.

<Warning title="Note">


If the media resource has already been [loadResource](@loadResource-IZegoMediaPlayer) or is playing, please call the [stop](@stop-IZegoMediaPlayer) interface to stop playing first, and then call the [loadResource](@loadResource-IZegoMediaPlayer) interface to load the media resource, otherwise the loading will fail.


```cpp
 // Load resource, can pass absolute path of local resource or URL of network resource
mediaPlayer->loadResource("sourcePath", [=](int errorCode){
    if(errorCode == 0){
        printf("the total duration of the file: %lld", mediaPlayer->getTotalDuration());
    } else {
        printf("load resource failed");
    }
});
```

### 4 Playback Control

#### Playing State Control

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Common/ZegoExpressEngine/mediaplayer_state_iOS.jpg" /></Frame>

After calling [loadResource](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#load-resource) to successfully load the file, you can call [start](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#start), [pause](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#pause),
[resume](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#resume), [stop](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#stop) to start and stop playback. Once the player's internal state changes, the [onMediaPlayerStateUpdate](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player-event-handler#on-media-player-state-update) callback will be triggered.

Users can also call [getCurrentState](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#get-current-state) at any time to get the player's current state.

If [enableRepeat](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#enable-repeat) is set to `true`, the player will automatically replay the file after playing it.

```cpp
// Set whether to repeat playback
mediaPlayer->enableRepeat(true);
// Start playing, need to call the interface to load media file before playing
mediaPlayer->start();
// Pause
mediaPlayer->pause();
// Resume
mediaPlayer->resume();
// Stop
mediaPlayer->stop();
```

#### Playing Progress Control

The progress of playing the file will be called back through the [onMediaPlayerPlayingProgress](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player-event-handler#on-media-player-playing-progress) method. The default interval for triggering the callback is 1000 ms, which can be changed by [setProgressInterval](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#set-progress-interval).

Users can also get the current playing progress through [getCurrentProgress](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#get-current-progress)

Adjust the progress through the [seekTo](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#seek-to) interface.

```cpp
// Set playing progress callback interval to 2000 ms
mediaPlayer->setProgressInterval(2000);
// Get the player's playing progress, in milliseconds
auto progress = mediaPlayer->getCurrentProgress();
// Jump the playing progress to half of the total duration, the unit of progress is milliseconds
mediaPlayer->seekTo(mediaPlayer->getTotalDuration() / 2, nullptr);
```

#### Player Audio Control

Get and control playing volume through [getPlayVolume](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#get-play-volume) and [setPlayVolume](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#set-play-volume).

Get and control publishing volume through [getPublishVolume](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#get-publish-volume) and [setPublishVolume](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#set-publish-volume).

Call [enableAux](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#enable-aux) to mix the file's sound into the stream being published.

Call [muteLocal](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#mute-local) to control local mute playback.

```cpp
// Get the player's current playing volume
auto playVolume = mediaPlayer->getPlayVolume();
// Set player volume to half of the original
mediaPlayer->setPlayVolume(playVolume / 2);
// Get the player's current publishing volume
int publishVolume = mediaPlayer->getPublishVolume();
// Set player publishing volume
mediaPlayer->setPublishVolume(publishVolume);
// Enable mixing the resource's sound into the stream being published
mediaPlayer->enableAux(true);
// Enable local silent playback
mediaPlayer->muteLocal(true);
```

If you want to get the audio data of the file, you can specify the audio frame callback [IZegoMediaPlayerAudioHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player-audio-handler) for the player through the [setAudioHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#set-audio-handler) interface.

```cpp
// Callback for player throwing audio data
// Please note, do not call any SDK interfaces in the SDK callback thread, you need to manually switch to another thread, otherwise a deadlock will occur
class MyAudioHandler: public IZegoMediaPlayerAudioHandler {
public:
    virtual void onAudioFrame(IZegoMediaPlayer* /*mediaPlayer*/, const unsigned char* /*data*/, unsigned int /*dataLength*/, ZegoAudioFrameParam /*param*/) {
    }
};
auto audioHandler = std::make_shared<MyAudioHandler>();
mediaPlayer->setAudioHandler(audioHandler);
```

#### Player Video Control

If you want to get the video data of the file, you can specify the video frame callback [IZegoMediaPlayerVideoHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player-video-handler) for the player through the [setVideoHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#set-video-handler) interface.

```cpp
// Set callback for player video data
// Please note, do not call any SDK interfaces in the SDK callback thread, you need to manually switch to another thread, otherwise a deadlock will occur
class MyVideoHandler: public IZegoMediaPlayerVideoHandler {
public:
    void onVideoFrame(IZegoMediaPlayer* /*mediaPlayer*/, const unsigned char** /*data*/, unsigned int* /*dataLength*/, ZegoVideoFrameParam /*param*/) {
    }
};
auto videoHandler = std::make_shared<MyVideoHandler>();
mediaPlayer->setVideoHandler(videoHandler);
```

<Warning title="Note">


The SDK currently does not support video rendering on the Linux platform. Users can implement custom rendering after obtaining the video data.




#### Publish the Video Played by the Player

1. Before publishing the player's video, you need to first set the video frame callback listener through [setVideoHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#set-video-handler) to get the video frame data thrown by [onVideoFrame](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player-video-handler#on-video-frame).

2. Use custom method to capture video and mix the obtained video data into the published data. For detailed operations, please refer to [Custom Video Capture](/real-time-video-linux-cpp/video/custom-video-capture) .

<Note title="Note">


When custom capturing data, it is recommended that developers define a `flag` marker themselves:

* When the [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-custom-video-capture-handler#on-start) callback is triggered, set the `flag` marker to `True`, indicating that custom captured video data can start being sent to the SDK.
* When the [onStop](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-custom-video-capture-handler#on-stop) callback is triggered, set the `flag` marker to `False`, indicating that captured video data needs to stop being sent to the SDK.

</Note>


3. Developers need to add judgment logic for `flag` in [onVideoFrame](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player-video-handler#on-video-frame). When `flag` is set to `True` (i.e., the [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-custom-video-capture-handler#on-start) callback is triggered), call the [sendCustomVideoCaptureRawData](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-express-engine#send-custom-video-capture-raw-data) method to send the obtained video data to the SDK.

4. Call [startPublishingStream](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-express-engine#start-publishing-stream) to start publishing stream. Please refer to "Publishing Stream" in [Quick Start - Implementation Flow](/real-time-video-linux-cpp/quick-start/implementing-video-call).


#### Voice Changer

When handling scenarios such as adjusting the pitch of accompaniment in KTV, you can call the media player's [enableVoiceChanger](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#enable-voice-changer) interface to implement the voice changer function. Developers can set the voice changer effect through the pitch parameter `pitch` in the [ZegoVoiceChangerParam](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~struct~zego-express-zego-voice-changer-param#zego-voice-changer-param) object. The value range of this parameter is [-12.0, 12.0]. The larger the value, the sharper the sound. Voice changer is disabled by default.

```cpp
ZegoVoiceChangerParam param = ZegoVoiceChangerParam();
param.pitch = 8.0f;     // Male voice to child voice
param.pitch = 4.0f;     // Male voice to female voice
param.pitch = 6.0f;     // Female voice to child voice
param.pitch = -3.0f;    // Female voice to male voice
mediaPlayer->enableVoiceChanger(ZEGO_MEDIA_PLAYER_AUDIO_CHANNEL_ALL, true, param);
```

### 5 Destroy Media Player

After using the player, you need to call the [destroyMediaPlayer](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-express-engine#destroy-media-player) interface in time to release the resources occupied by the player.

```cpp
engine->destroyMediaPlayer(mediaPlayer);
```

## FAQ

#### How to switch playing resources during playback?

First call the player's [stop](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#stop) interface, and then call the [loadResource](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~CPP_linux~class~zego-express-i-zego-media-player#load-resource) interface again to load the new resource.
