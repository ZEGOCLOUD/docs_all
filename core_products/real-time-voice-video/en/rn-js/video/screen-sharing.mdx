---
articleID: 17369
date: "2025-01-20"
---
# Screen Sharing

- - -

## Overview

Screen sharing refers to sharing screen content with other audiences as video during video calls or interactive live streaming to enhance interactive experience and improve communication efficiency.

Screen sharing is widely used in the following scenarios:

- In video conference scenarios, screen sharing can share the speaker's local files, data, web pages, PPT, and other pictures with other participants;
- In online classroom scenarios, screen sharing can display the teacher's courseware, notes, lecture content, and other pictures to students.

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Express/screen_share_scene_new.png" /></Frame>

## Prerequisites

Before implementing screen sharing functionality, please ensure:
- Supports Android 5.0 or above, and Android devices or emulators that support audio and video (real devices are recommended).
- Supports iOS 12.0 or above, and iOS devices or emulators that support audio and video (real devices are recommended).
- This function has high requirements on device performance. It is recommended to use it on iPhone X and later models.
- You have created a project in the [ZEGO Console](https://console.zegocloud.com) and applied for a valid AppID and AppSign. For details, please refer to [Console - Project Information](/console/project-info).
- You have integrated ZEGO Express SDK into the project and implemented basic audio and video streaming functionality. For details, please refer to [Quick Start - Integration](/real-time-video-rn/quick-start/integrating-sdk) and [Quick Start - Implementation](/real-time-video-rn/quick-start/implementing-video-call).




## Usage Steps

### Enable Permissions

(Required) Before recording the screen on Android, a pop-up will prompt the user to allow the application to record the screen. Please authorize.

<Warning title="Warning">

Please be sure to declare the following permissions, otherwise the screen sharing function will not be available.

</Warning>



If the target Android SDK version is 34.0.0 or later, you need to go to the "app/src/main" directory of your project, open the "AndroidManifest.xml" file, and set the `FOREGROUND_SERVICE` and `FOREGROUND_SERVICE_MEDIA_PROJECTION` permission declarations.

```xml
<uses-permission android:name="android.permission.FOREGROUND_SERVICE"/>
<uses-permission android:name="android.permission.FOREGROUND_SERVICE_MEDIA_PROJECTION"/>
```
### Set Capture Source to Screen Sharing Source

#### Video Source

The default video source for SDK publishing stream is the camera source. If you need to publish screen sharing source, you need to switch to screen sharing through [setVideoSource](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/javascript_react_native/classes/_zegoexpressengine_.zegoexpressengine.html#setvideosource).

```javascript
ZegoExpressEngine.instance().setVideoSource(ZegoVideoSourceType.ScreenCapture, ZegoPublishChannel.Aux);
```

#### Audio Source (iOS Only)

The default audio source for SDK publishing stream is the microphone source. If you need to publish screen sharing source, you need to switch to screen sharing through [setAudioSource](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/javascript_react_native/classes/_zegoexpressengine_.zegoexpressengine.html#setaudiosource).

```javascript
ZegoExpressEngine.instance().setAudioSource(ZegoAudioSourceType.ScreenCapture, ZegoPublishChannel.Aux);
```
### Start Screen Sharing

There are two screen sharing methods: in-app screen sharing and cross-app screen sharing.

#### In-App Screen Sharing (iOS Only)

If users only share pictures and sound within the app, they can call the [startScreenCaptureInApp](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/javascript_react_native/classes/_zegoexpressengine_.zegoexpressengine.html#startscreencaptureinapp) interface to start screen sharing. You can also call the [broadcastFinished](https://developer.apple.com/documentation/replaykit/rpbroadcastsamplehandler/2143169-broadcastfinished?language=objc) interface callback to receive screen sharing end notifications. If screen capture fails, the reason for failure can be received.

```javascript
ZegoExpressEngine.instance().startScreenCaptureInApp();
```

#### Cross-App Screen Sharing

Cross-app screen sharing is recorded by the iOS system through the Extension extension process, so you need to additionally create and start the extension process. For details, please refer to the following implementation steps:

##### Create Broadcast Upload Extension (iOS Only)

<Note title="Note">

The memory usage limit of Broadcast Upload Extension is 50 MB. Do not perform additional memory allocation in the screen sharing Extension.

</Note>




1. Use Xcode to open the project engineering file, and click "File > New > Target..." in the menu bar in sequence.
<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/iOS/ZegoExpressEngine/ShareScreen/share_screen_create_extension_ios1.png" /></Frame>
2. In the pop-up window, select "Broadcast Upload Extension" on the iOS page, and then click "Next".
<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/iOS/ZegoExpressEngine/ShareScreen/share_screen_create_extension_ios.png" /></Frame>
3. In the "Product Name" field of the pop-up dialog box, fill in the name of the "Broadcast Upload Extension", such as "ScreenShare". After selecting "Team", "Language" and other information, click "Finish".

<Note title="Note">

No need to check "Include UI Extension".

</Note>




<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/iOS/ZegoExpressEngine/ShareScreen/share_screen_create_extension_ios3.png" /></Frame>

After creation, you will see the folder of this Extension in the project. The structure is similar to the following. This folder is used to store the implementation code of the screen sharing function:
<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/iOS/ZegoExpressEngine/ShareScreen/share_screen_create_extension_project.png" /></Frame>

##### Set Up Extension

1. Ensure that in the "Info.plist" file of the Extension, set "RPBroadcastProcessMode" to "RPBroadcastProcessModeSampleBuffer".
2. Import ZEGO Express SDK in the Extension. In xcode, click the project to enter the project configuration page. Select the Extension created above, find the Frameworks and Libraries item under General, click the + sign, and select ZegoExpressEngine.xcframework to add.
<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/iOS/ZegoExpressEngine/ShareScreen/screencapture_rn.jpg" /></Frame>

##### Start Screen Sharing

If users need to share the entire system, they can call the [startScreenCapture](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/javascript_react_native/classes/_zegoexpressengine_.zegoexpressengine.html#startscreencapture) interface to start screen sharing.

```javascript
ZegoExpressEngine.instance().startScreenCapture();
```

##### Get Screen Data

<Note title="Note">

The implementation of the following system callbacks can be found in the "/ZegoExpressExample-iOS-OC/Topics/ScreenCapture/ZegoExpressExample-iOS-OC-Broadcast/SampleHandler.m" file in [Download Sample Source Code](/real-time-video-rn/quick-start/run-example-code):

- [broadcastStartedWithSetupInfo](https://developer.apple.com/documentation/replaykit/rpbroadcastsamplehandler/2143170-broadcaststartedwithsetupinfo?language=objc)
- [processSampleBuffer](https://developer.apple.com/documentation/replaykit/rpbroadcastsamplehandler/2123045-processsamplebuffer?language=objc)
- [broadcastFinished](https://developer.apple.com/documentation/replaykit/rpbroadcastsamplehandler/2143169-broadcastfinished?language=objc)


</Note>





1. The system notifies the Extension through the [broadcastStartedWithSetupInfo](https://developer.apple.com/documentation/replaykit/rpbroadcastsamplehandler/2143170-broadcaststartedwithsetupinfo?language=objc) callback that screen recording has started. You need to call the following interface in the `ZegoReplayKitExt` class in this callback to create a data transmission channel:
    ```objc
    [ZegoReplayKitExt.sharedInstance setupWithDelegate:self];
    ```


2. In the [processSampleBuffer](https://developer.apple.com/documentation/replaykit/rpbroadcastsamplehandler/2123045-processsamplebuffer?language=objc) system callback, send to ZEGO Express SDK through the `sendSampleBuffer` interface in the `ZegoReplayKitExt` class.

    ```objc
    [ZegoReplayKitExt.sharedInstance sendSampleBuffer:sampleBuffer withType:sampleBufferType];

    ```

3. The system notifies the Extension through the [broadcastFinished](https://developer.apple.com/documentation/replaykit/rpbroadcastsamplehandler/2143169-broadcastfinished?language=objc) callback that screen recording has ended. You can call the following interface in the `ZegoReplayKitExt` class in this callback to stop screen sharing and disconnect the data transmission channel:

    ```objc
    [ZegoReplayKitExt.sharedInstance finished];
    ```

### Login Room and Publish Stream

After completing the above screen sharing source capture process, [startPublishingStream](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/javascript_react_native/classes/_zegoexpressengine_.zegoexpressengine.html#startpublishingstream) pushes the captured data source to the cloud server. (The channel for pushing the data source must be consistent with the channel set for the capture source)

```javaScript
ZegoExpressEngine.instance().startPublishingStream(streamID, ZegoPublishChannel.Aux);
```


### Watch Remote Screen Sharing

After completing the above steps, other users can use the [startPlayingStream](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/javascript_react_native/classes/_zegoexpressengine_.zegoexpressengine.html#startplayingstream) interface to play the screen sharing stream.

```javascript
// Play stream, need to pass in the streamID used when the user who initiated screen sharing published the stream
ZegoExpressEngine.instance().startPlayingStream(streamID, {"reactTag": findNodeHandle(this.refs.zego_play_view), "viewMode": 0, "backgroundColor": 0});
```

### Stop Screen Sharing

Call the [stopScreenCapture](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/javascript_react_native/classes/_zegoexpressengine_.zegoexpressengine.html#stopscreencapture) interface to stop screen sharing.

```javascript
ZegoExpressEngine.instance().stopScreenCapture();
```

## FAQ

1. **Does iOS support sharing a specified area?**

    The iOS system only supports sharing the entire screen and does not support sharing a specified area.

2. **Why does capture stop when iOS uses screen sharing and enters the background?**
    - Enable the background mode for audio recording in the application.
    <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/iOS/ZegoExpressEngine/ShareScreen/share_screen_background_mode.png" /></Frame>
    - If you use the main channel for screen sharing, the SDK will not start audio internal capture and cannot keep alive in the background. When the application goes to the background, screen sharing may stop. It is recommended to add background keep-alive processing logic to the application.

3. **How to handle audio playback abnormalities when iOS uses screen sharing?**

    If you use the screen sharing function to capture and publish audio while using the stream playing function locally, it will cause the iOS system to repeatedly capture the played audio, resulting in audio playback abnormalities. It is recommended to use [muteAllPlayStreamAudio](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/javascript_react_native/classes/_zegoexpressengine_.zegoexpressengine.html#muteallplaystreamaudio) to prohibit playing all audio streams.


4. **When the Android device is fixed in portrait mode (auto-rotation is prohibited), how to solve the problem of abnormal popup orientation and interface switching between portrait and landscape when screen capture is started?**

    Due to the conflict between the device fixed in portrait mode and the app landscape interface, the screen capture causes rapid switching between portrait and landscape, triggering system data abnormality and black screen. Solutions:

    - Solution 1: Override SDK configuration through `tools:replace`

      The default orientation of the SDK screen sharing auxiliary Activity is "fullUser". You need to modify it in the project AndroidManifest.xml:
      1. Add the "tools" tool namespace at the root node (manifest tag);
      2. Find the above Activity configuration, change its screen orientation (screenOrientation) to "unspecified", and add `tools:replace` to force override the SDK default configuration.
      After recompiling, the popup will be consistent with the app landscape, avoiding switching black screen.

    - Solution 2: Enable device auto-rotation

      Go to device "Settings > Display > Auto-rotate screen". After enabling, the popup orientation will follow the app landscape, and there will be no switching black screen problem.
