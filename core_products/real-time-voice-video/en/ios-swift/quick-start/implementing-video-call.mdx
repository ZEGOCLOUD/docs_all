---
articleID: 20947
date: "2025-01-21"
---
# Implement Video Call

---



## Function Introduction

This article will introduce how to quickly implement a simple real-time audio and video call.

Explanation of related concepts:

- ZEGO Express SDK: A real-time audio and video SDK provided by ZEGO that can provide developers with convenient access, high definition and smoothness, multi-platform interoperability, low latency, and high concurrency audio and video services.
- Stream: Refers to a group of audio and video data that is continuously being sent and encapsulated in a specified encoding format. A user can publish multiple streams at the same time (for example, one publishes camera data and one publishes screen sharing data) and can also play multiple streams at the same time. Each stream is identified by a stream ID.
- Publish stream: The process of pushing packaged audio and video data streams to the ZEGO real-time audio and video cloud.
- Play stream: The process of pulling and playing existing audio and video data streams from the ZEGO real-time audio and video cloud.
- Room: An audio and video space service provided by ZEGO, used to organize user groups. Users in the same Room can send and receive real-time audio, video, and messages to each other.
    1. Users need to log in to a Room first before they can perform stream publishing and playing operations.
    2. Users can only receive related messages in the Room they are in (user entry/exit, audio and video stream changes, etc.).
    3. Each Room is identified by a unique roomID within an AppID. All users who log in to the Room using the same roomID belong to the same Room.



For more related concepts, please refer to [Term Explanation](/glossary/term-explanation).

## Prerequisites

Before implementing basic real-time audio and video functions, please ensure:

- ZEGO Express SDK has been integrated into the project to implement basic real-time audio and video functions. For details, please refer to [Quick Start - Integrate SDK](/real-time-video-ios-swift/quick-start/integrating-sdk).
- A project has been created in [ZEGOCLOUD Console](https://console.zegocloud.com), and a valid AppID and AppSign have been applied for. For details, please refer to "Project Information" in [Console - Project Management](/console/project-info).

<Warning title="Note">

The SDK also supports Token authentication. If you have higher requirements for project security, it is recommended to upgrade the authentication method. For details, please refer to [How to upgrade from AppSign authentication to Token authentication](http://doc-zh.zego.im/faq/token_upgrade?product=ExpressVideo).
</Warning>

<a id="process"></a>

## Implementation Process

The basic process for users to conduct video calls through ZEGO Express SDK is as follows:

Users A and B join the Room. User B previews and pushes the audio and video stream to the ZEGO cloud service (publish stream). After User A receives the notification of the audio and video stream pushed by User B, User A plays User B's audio and video stream in the notification (play stream).

<Frame width="512" height="auto" caption="">
  <img src="https://doc-media.zego.im/sdk-doc/Pics/Common/ZegoExpressEngine/common_usage_new.png" />
</Frame>

<a id="initialization"> </a>

### Initialization

**1. Create Interface**

Create a user interface for video calls in your project according to scenario requirements. We recommend that you add the following elements to your project:

- Local video window
- Remote video window
- Call button

<Frame width="512" height="auto" caption="">
  <img src="https://doc-media.zego.im/sdk-doc/Pics/QuickStart/express_quickstart_video_call.png" />
</Frame>

<h1 id="CreateEngine"> </h1>

**2. Create Engine**

Call the create engine interface and pass the applied AppID and AppSign to the parameters "appID" and "appSign".

Select an appropriate scenario based on the actual audio and video business of the App, and pass the selected scenario enumeration to the parameter "scenario".


<Warning title="Note">


The SDK also supports Token authentication. If you have higher requirements for project security, it is recommended to upgrade the authentication method. For details, please refer to [How to upgrade from AppSign authentication to Token authentication](http://doc-zh.zego.im/faq/token_upgrade?product=ExpressVideo).
</Warning>

```swift
let profile = ZegoEngineProfile()
// Please obtain through official website registration, format: 1234567890
profile.appID = <#appID#>
// Please obtain through official website registration, format: @"0123456789012345678901234567890123456789012345678901234567890123" (64 characters in total)
profile.appSign = <#appSign#>
// Specify to use live streaming scenario (please fill in the scenario that suits your business according to the actual situation)
profile.scenario = .broadcast
// Create engine and register self as eventHandler callback. If you don't need to register a callback, the eventHandler parameter can be nil, and you can call the "setEventHandler:" method later to set the callback
ZegoExpressEngine.createEngine(with: profile, eventHandler: self)
```

**3. Set Event Handler**

You can listen to and handle event callbacks you care about by implementing the [ZegoEventHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~protocol~ZegoEventHandler) interface class and implementing the required callback methods. Then pass the instantiated object as the `eventHandler` parameter to `createEngine` or pass it to [setEventHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#set-event-handler) to register the callback.


<Warning title="Note">


It is recommended to register the callback when creating the engine or immediately after creating the engine to avoid missing event notifications due to delayed registration.
</Warning>


<Accordion title="Common Notification Callbacks" defaultOpen="false">
```swift
//After locally calling loginRoom to join a Room, you can monitor your connection status in the Room in real time by listening to the onRoomStateChanged callback.
//For more information, please refer to /real-time-video-ios-oc/room-capability/room-connection-status
func onRoomStateChanged(_ reason: ZegoRoomStateChangedReason, errorCode: Int32, extendedData: [AnyHashable : Any], roomID: String) {
    if reason == .logining {
        // Logging in to the Room. When calling [loginRoom] to log in to the Room or [switchRoom] to switch to the target Room, enter this state, indicating that a request is being made to connect to the server. Usually, the application interface is displayed through this state.
    } else if reason == .logined {
        //Logged in to the Room successfully. After successfully logging in to or switching Rooms, enter this state, indicating that logging in to the Room has been successful, and users can normally receive callback notifications for additions and deletions of other users and all stream information in the Room.
        //Only when the Room status is successfully logged in or successfully reconnected, can publishing streams (startPublishingStream) and playing streams (startPlayingStream) normally send and receive audio and video
    } else if reason == .loginFailed {
        //Failed to log in to the Room. After failing to log in to or switch Rooms, enter this state, indicating that logging in to or switching Rooms has failed, such as incorrect AppID or AppSign.
    } else if reason == .reconnecting {
        //Room connection temporarily interrupted. If the interruption is caused by poor network quality, the SDK will perform internal retries.
    } else if reason == .reconnected {
        //Room reconnection successful. If the interruption is caused by poor network quality, the SDK will perform internal retries. After successful reconnection, enter this state.
    } else if reason == .reconnectFailed {
        //Room reconnection failed. If the interruption is caused by poor network quality, the SDK will perform internal retries. After failed reconnection, enter this state.
    } else if reason == .kickOut {
        //Kicked out of the Room by the server. For example, if a user with the same username logs in to the Room elsewhere, causing the local end to be kicked out of the Room, this state will be entered.
    } else if reason == .logout {
        //Logged out of the Room successfully. Before logging in to the Room, the default is this state. After successfully calling [logoutRoom] to log out of the Room or successfully logging out of the current Room internally during [switchRoom], enter this state.
    } else if reason == .logoutFailed {
        //Failed to log out of the Room. After failing to call [logoutRoom] to log out of the Room or failing to log out of the current Room internally during [switchRoom], enter this state.
    }
}

//When other users in the Room publish/stop publishing streams, we will receive notifications of corresponding stream additions and deletions here
func onRoomStreamUpdate(_ updateType: ZegoUpdateType, streamList: [ZegoStream], extendedData: [AnyHashable: Any]?, roomID: String) {
    if updateType == .add {
        //When updateType is ZegoUpdateTypeAdd, it means that a new audio and video stream has been added. At this time, we can call the startPlayingStream interface to play the audio and video stream
    } else if updateType == .delete {
        //When updateType is ZegoUpdateTypeDelete, it means that an audio and video stream has been deleted. At this time, we can call the stopPlayingStream interface to stop playing the audio and video stream
    }
}

//When other users in the same Room enter or leave the Room, you can receive notifications through this callback. When the parameter ZegoUpdateType in the callback is ZegoUpdateTypeAdd, it means a user has entered the Room; when ZegoUpdateType is ZegoUpdateTypeDelete, it means a user has left the Room.
// Users can receive callbacks of other users in the Room only when the isUserStatusNotify parameter in the ZegoRoomConfig passed when logging in to the Room loginRoom is YES.
// When the number of people in the Room exceeds 500, the onRoomUserUpdate callback is not guaranteed to be valid. If the business scenario has more than 500 people in the Room, please contact ZEGO Technical Support.
func onRoomUserUpdate(_ updateType: ZegoUpdateType, userList: [ZegoUser], roomID: String) {
    if updateType == .add {
        for user in userList {
            NSLog("User%@ entered the Room %@", user.userName, roomID)
        }
    } else if updateType == .delete {
        for user in userList {
            NSLog("User%@ left the Room %@", user.userName, roomID)
        }
    }
}

//Status notification of users publishing audio and video streams
//When the status of users publishing audio and video streams changes, this callback will be received. If the network interruption causes publishing exceptions, the SDK will also notify status changes while retrying publishing.
func onPublisherStateUpdate(_ state: ZegoPublisherState, errorCode: Int32, extendedData: [AnyHashable : Any]?, streamID: String) {
    if errorCode != 0 {
        NSLog("Publishing stream status error errorCode: %d", errorCode)
    } else {
        switch (state) {
        case .publishing:
            NSLog("Publishing stream")
            break
        case .publishRequesting:
            NSLog("Requesting to publish stream")
            break
        case .noPublish:
            NSLog("No publishing")
            break
    }
}

//Status notification of users playing audio and video streams
//When the status of users playing audio and video streams changes, this callback will be received. If the network interruption causes playing exceptions, the SDK will automatically retry.
func onPlayerStateUpdate(_ state: ZegoPlayerState, errorCode: Int32, extendedData: [AnyHashable : Any]?, streamID: String) {
    if (errorCode != 0) {
        NSLog("Playing stream status error streamID: %@, errorCode:%d", streamID, errorCode)
    } else {
        switch (state) {
        case .playing:
            NSLog("Playing stream")
            break
        case .playRequesting:
            NSLog("Requesting to play stream")
            break
        case .noPlay:
            NSLog("Not playing")
            break
        }
    }
}

// You can receive the uplink and downlink network quality of users in the Room (including yourself) by listening to the onNetworkQuality callback. This callback will be received every two seconds. For network quality levels, please refer to ZegoStreamQualityLevel.
func onNetworkQuality(_ userID: String, upstreamQuality: ZegoStreamQualityLevel, downstreamQuality: ZegoStreamQualityLevel) {
    if (userID == nil) {
        // Represents the network quality of the local user (me)
        // NSLog(@"My uplink network quality is %lu", (unsigned long)upstreamQuality)
        // NSLog(@"My downlink network quality is %lu", (unsigned long)downstreamQuality)
    } else {
        // Represents the network quality of other users in the Room
        // NSLog(@"The uplink network quality of user %@ is %lu", userID, (unsigned long)upstreamQuality)
        // NSLog(@"The downlink network quality of user %@ is %lu", userID, (unsigned long)downstreamQuality)
    }

    /*
     ZegoStreamQualityLevelExcellent: Excellent network quality
     ZegoStreamQualityLevelGood: Good network quality
     ZegoStreamQualityLevelMedium: Normal network quality
     ZegoStreamQualityLevelBad: Poor network quality
     ZegoStreamQualityLevelDie: Network abnormal
     ZegoStreamQualityLevelUnknown: Unknown network quality
     */
}
```
</Accordion>

<a id="createroom"></a>

### Login Room

Call the [loginRoom ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#login-room-user) interface to log in to the Room. If the Room does not exist, calling this interface will create and log in to this Room. The parameters roomID and user are generated locally by you, but need to meet the following conditions:

- Within the same AppID, ensure that "roomID" is globally unique.
- Within the same AppID, ensure that "userID" is globally unique. It is recommended that developers associate "userID" with their own business account system.

```swift
// roomID is generated locally by you. Ensure that "roomID" is globally unique. Different users need to log in to the same Room to make calls
let roomID = "room1"

// Create a user object. The constructor userWithUserID of ZegoUser will set "userName" to be the same as the passed parameter "userID". "userID" cannot be "nil", otherwise logging in to the Room will fail.
// userID is generated locally by you. Ensure that "userID" is globally unique.
let user = ZegoUser(userID: "user1")

let config = ZegoRoomConfig()

// Only by passing in a ZegoRoomConfig with the parameter "isUserStatusNotify" set to "true" can you receive the onRoomUserUpdate callback.
config.isUserStatusNotify = true

//If you use the appsign method for authentication, you do not need to fill in the token parameter; if you need to use a more secure authentication method: token authentication, please refer to [How to upgrade from AppSign authentication to Token authentication](https://doc-zh.zego.im/faq/token_upgrade?product=ExpressVideo&platform=all)
// config.token = "<#token#>"

ZegoExpressEngine.shared().loginRoom(roomID, user: user, config: config) { errorCode, extendedData in
    // (Optional callback) Result of logging in to the Room. If you only care about the login result, just pay attention to this callback
    if (errorCode == 0) {
        NSLog("Room login successful")
    } else {
        // Login failed. Please refer to the errorCode description /real-time-video-ios-oc/client-sdk/error-code
        NSLog("Room login failed")
    }
}
```

#### Login Status (Room Connection Status) Callback

After calling the login Room interface, you can monitor your connection status in the Room in real time by listening to the [onRoomStateChanged ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~protocol~ZegoEventHandler#on-room-state-changed-error-code-extended-data-room-id) callback.

<a id="publishingStream"></a>

### Preview Your Own Screen and Push to ZEGO Audio and Video Cloud

**1. (Optional) Preview Your Own Screen**

If you want to see the local screen, you can call the [startPreview ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#start-preview) interface to set the preview view and start local preview.

**2. Push Your Audio and Video Stream to ZEGO Audio and Video Cloud**

After the user calls the [loginRoom](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#login-room-user) interface, you can directly call the [startPublishingStream ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#start-publishing-stream) interface and pass in "streamID" to push your audio and video stream to the ZEGO audio and video cloud. You can know whether the stream publishing is successful by listening to the [onPublisherStateUpdate ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~protocol~ZegoEventHandler#on-publisher-state-update-error-code-extended-data-stream-id) callback.

"streamID" is generated locally by you, but needs to ensure:

Under the same AppID, "streamID" is globally unique. If under the same AppID, different users each publish a stream with the same "streamID", the user who publishes the stream later will fail to publish.

```swift
// Set local preview view and start preview. The view mode uses the SDK's default mode, scaling proportionally to fill the entire View
let previewCanvas = ZegoCanvas(view: localUserViewObject.view.view)
ZegoExpressEngine.shared().startPreview(previewCanvas)

// User calls this interface to publish stream after calling loginRoom
// Under the same AppID, developers need to ensure that "streamID" is globally unique. If different users each publish a stream with the same "streamID", the user who publishes the stream later will fail to publish.
ZegoExpressEngine.shared().startPublishingStream(localStreamID)
```

<Note title="Notes">If you need to know about ZEGO Express SDK's camera/video/microphone/audio/speaker related interfaces, please refer to [FAQ - How to implement turning on/off camera/video screen/microphone/audio/speaker?](http://doc-zh.zego.im/faq/How_to_switch_devices).</Note>

<a id="PlayingStream"></a>

### Play Other Users' Audio and Video

When making video calls, we need to play other users' audio and video.

When other users in the same Room push audio and video streams to the ZEGO audio and video cloud, we will receive notifications of new audio and video streams in the [onRoomStreamUpdate](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~protocol~ZegoEventHandler#on-room-stream-update-stream-list-extended-data-room-id) callback, and can obtain the "streamID" of a certain stream through ZegoStream.

In this callback, we can call [startPlayingStream](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#start-playing-stream-canvas) and pass in "streamID" to play the user's audio and video. You can know whether the audio and video are successfully played by listening to the [onPlayerStateUpdate ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~protocol~ZegoEventHandler#on-player-state-update-error-code-extended-data-stream-id) callback.

```swift
// When other users in the Room publish/stop publishing streams, we will receive notifications of corresponding stream additions and deletions here
func onRoomStreamUpdate(_ updateType: ZegoUpdateType, streamList: [ZegoStream], extendedData: [AnyHashable: Any]?, roomID: String) {
    //When updateType is ZegoUpdateTypeAdd, it means that a new audio and video stream has been added. At this time, we can call the startPlayingStream interface to play the audio and video stream
    if updateType == .add {
        // Start playing stream, set remote playing rendering view. The view mode uses the SDK's default mode, scaling proportionally to fill the entire View
        // In the following, remoteUserView is the View on the UI interface. Here, to make the example code more concise, we only play the first stream in the newly added audio and video stream list. In actual business, it is recommended that developers loop through streamList to play each audio and video stream
        let streamID = streamList[0].streamID
        ZegoExpressEngine.shared().startPlayingStream(streamID, canvas: ZegoCanvas(view: viewObject.view.view))
    }
}
```


### Test Publishing and Playing Functions Online

Run the project on a real device. After successful operation, you can see the local video screen.

For convenience, ZEGO provides a [Web Debugging Example ](https://zegodev.github.io/zego-express-webrtc-sample/assistDev/index.html). On this page, enter the same AppID and RoomID, enter different UserIDs, and the corresponding [Token](/console/development-assistance/temporary-token), you can join the same Room and communicate with the real device. When the audio and video call starts successfully, you can hear the remote audio and see the remote video screen.

### Stop Audio and Video Call

#### Stop Publishing and Playing Audio and Video Streams

**1. Stop Publishing Stream, Stop Preview**

Call the [stopPublishingStream ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#stop-publishing-stream) interface to stop sending the local audio and video stream to remote users.

```swift
// Stop publishing stream
ZegoExpressEngine.shared().stopPublishingStream()
```

If local preview is enabled, call the [stopPreview](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#stop-preview) interface to stop preview.

```swift
// Stop local preview
ZegoExpressEngine.shared().stopPreview()
```

<a id="stopPlaying"></a>

**2. Stop Playing Stream**

Call the [stopPlayingStream ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#stop-playing-stream) interface to stop playing the audio and video stream pushed by the remote end.

<Warning title="Note">


If the developer receives a notification of "deletion" of audio and video streams through the [onRoomStreamUpdate](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~protocol~ZegoEventHandler#on-room-stream-update-stream-list-extended-data-room-id) callback, please call the [stopPlayingStream ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#stop-playing-stream) interface in time to stop playing, to avoid playing empty streams and generating additional costs; or, the developer can choose the appropriate timing according to their own business needs and actively call the [stopPlayingStream ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#stop-playing-stream) interface to stop playing.
</Warning>



```swift
// Stop playing stream
ZegoExpressEngine.shared().stopPlayingStream("stream1")
```

<a id="logoutRoom"></a>

#### Log Out of Room

Call the [logoutRoom ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#logout-room) interface to log out of the Room.

```swift
// Log out of the Room
ZegoExpressEngine.shared().logoutRoom()
```

#### Destroy Engine

If the user completely does not use audio and video functions, the engine can be destroyed to release resources such as microphones, cameras, memory, and CPU.

- If you need to listen to callbacks to ensure that device hardware resources are released, you can pass in "callback" when destroying the engine. This callback is only used for sending notifications, and developers cannot release engine-related resources in the callback.
- If you don't need to listen to callbacks, you can pass in "nil".

```objc
ZegoExpressEngine.destroy(nil)
```

## Video Call API Call Sequence

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/QuickStart/quickstart_uml_createEngineWithProfile.png" /></Frame>

## FAQ

<Accordion title="Can I kill the process directly when calling logoutRoom to log out of the Room?" defaultOpen="false">
Calling [logoutRoom](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#logout-room) and then directly killing the process has a certain probability of causing the [logoutRoom](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#logout-room) signaling to not be sent. Then the ZEGO server can only consider that this user has left the Room after the heartbeat times out. To ensure that the [logoutRoom ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#logout-room) signaling is sent, it is recommended to call [destroyEngine ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~objective-c_ios~class~ZegoExpressEngine#destroy-engine) again and then kill the process after receiving the callback.
</Accordion>

<Accordion title="How to troubleshoot errors in video calls?" defaultOpen="false">
If users encounter related errors during audio and video calls, they can query [Error Codes](/real-time-video-ios-swift/client-sdk/error-code).

</Accordion>

## Related Documentation
- [Common Error Codes](/real-time-video-ios-swift/client-sdk/error-code)
- [How to handle Room and user related issues?](https://doc-zh.zego.im/faq/express_room?product=ExpressVideo&platform=all)
- [How to set and obtain SDK logs and stack information?](https://doc-zh.zego.im/faq/express_sdkLog?product=ExpressVideo&platform=all)
- [Does the SDK support reconnection after disconnection?](https://doc-zh.zego.im/faq/reconnect?product=ExpressVideo&platform=all)
- [In live streaming scenarios, how to listen to events of remote audience role users logging in/out of the Room?](https://doc-zh.zego.im/faq/audience_event?product=ExpressVideo&platform=all)
- [How to adjust the focal length of the camera (zoom function)?](https://doc-zh.zego.im/faq/express_adjust_focal?product=ExpressVideo&platform=all)

- [Why can't I turn on the camera?](https://doc-zh.zego.im/faq/camera?product=ExpressVideo&platform=all)

- [How to ensure smooth audio and video in poor network environments (traffic control function)?](https://doc-zh.zego.im/faq/flowcontrol?product=ExpressVideo&platform=all)
