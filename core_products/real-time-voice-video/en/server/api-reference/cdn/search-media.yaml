openapi: 3.0.0
info:
  title: open-api-desc
  version: 1.0.0
  contact:
    name: Real-time Voice/Video API Support
    email: support@zegocloud.com

tags:
  - name: cdn

servers:
  $ref: '../shared-components.yaml#/servers'

paths:
  /:
    get:
      tags: [cdn]
      summary: SearchMedia
      description: |
        When users perform CDN recording, the recorded media files are stored on CDN servers. Users can call this interface to query information about their media files, such as media file name, creation time, etc.

        <Warning title="Note">
        Before using this interface for the first time, please confirm whether the CDN live service has been activated. If not activated, please go to [ZEGO Console](https://console.zego.im) to activate it yourself. For details, please refer to [Console - Service Configuration - CDN](/console/service-configuration/activate-cdn-service), or contact ZEGO technical support to activate it.
        </Warning>
        <Note title="Call frequency limit">For all rooms under the same AppID: 20 times/second</Note>
      operationId: search-media
      parameters:
        - name: Action
          in: query
          description: |
            > Interface prototype parameters
            >
            > https://rtc-api.zego.im?Action=SearchMedia
          required: true
          schema:
            type: string
            enum: [SearchMedia]
          style: form
          explode: true
        - $ref: '../shared-components.yaml#/components/parameters/AppId'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureNonce'
        - $ref: '../shared-components.yaml#/components/parameters/Timestamp'
        - $ref: '../shared-components.yaml#/components/parameters/Signature'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureVersion'
        - name: Vendor
          in: query
          required: true
          schema:
            type: string
            enum: [Tencent, Ws, Huawei]
          description: |
            <p>Possible values and corresponding CDN providers:</p><ul><li>Tencent: Tencent Cloud.</li><li>Ws: Wangsu.</li><li>Huawei: Huawei Cloud.</li></ul>
        - name: NamePrefix
          in: query
          schema:
            type: string
          required: false
          description: |
            File name prefix, which matches media file names by prefix, supporting up to 20 bytes.

            > **Note:**
            >
            > When using this parameter, URL encoding (UrlEncode) must be performed on its content.
        - name: StartTime
          in: query
          required: false
          schema:
            type: integer
            format: int
          description: |
            Start time for searching files (file creation time), Unix timestamp, accurate to seconds.

            <b>This parameter is only valid when Vendor is set to Tencent.</b>
        - name: EndTime
          in: query
          required: false
          schema:
            type: integer
            format: int
          description: |
            End time for searching files (file creation time), Unix timestamp, accurate to seconds.

            <b>This parameter is only valid when Vendor is set to Tencent.</b>
        - name: PageSize
          in: query
          required: false
          schema:
            type: integer
            format: int
          description: |
            Number of records to return, default value is 10. Value range: PageNumber * PageSize + PageSize must not exceed 5000.

            <b>This parameter is only valid when Vendor is set to Tencent.</b>
        - name: PageNumber
          in: query
          required: false
          schema:
            type: integer
            format: int
          description: |
            Which page to retrieve. Value range: PageNumber * PageSize + PageSize must not exceed 5000.

            <b>This parameter is only valid when Vendor is set to Tencent.</b>
        - name: FileId
          in: query
          required: false
          description: |
            List of file IDs, supporting up to 10 FileIds, with a maximum length of 40 characters for each FileId.

            <b>This parameter is only valid when Vendor is set to Tencent.</b>
          schema:
            type: array
            items:
              type: string
            minItems: 1
            maxItems: 10
          style: form
          explode: true
        - name: StreamId
          in: query
          required: false
          description: |
            List of stream IDs for CDN recording, supporting up to 10 StreamIds, matching any element in the collection.

            <b>This parameter is only valid when Vendor is set to Tencent.</b>
          schema:
            type: array
            items:
              type: string
            minItems: 1
            maxItems: 10
          style: form
          explode: true
        - name: Marker
          in: query
          required: false
          schema:
            type: string
          description: |
            Marker for retrieving information. When this parameter is not filled, the first page of retrieved information is returned by default.

            <ol><li>When calling this interface for the first time, leave the Marker parameter empty.</li>
            <li>When calling this interface again, set the Marker parameter to NextMarker (the marker information in the returned result).</li></ol><p>Each time this interface is called, the response will return NextMarker, and developers need to determine whether the last page has been reached.</p><p><b>This parameter is valid when Vendor is set to Ws or Huawei.</b></p>
        - name: MaxKeys
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 1000
          description: |
            Maximum number of records returned in a single call, value range [1, 1000], default is 1000.

            For information lists exceeding the MaxKeys value, you need to call this interface again based on the NextMarker value from the previous call.

            <b>This parameter is valid when Vendor is set to Ws or Huawei.</b>
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchMediaResponse'
              example:
                {
                  "Code": 0,
                  "Message": "success",
                  "Data": {
                    "Tencent": {
                      "TotalCount": 1,
                      "MediaInfoSet": [
                        {
                          "BasicInfo": {
                            "Name": "1690354361.mp4",
                            "Description": "",
                            "CreateTime": "2023-07-26T06:52:49Z",
                            "UpdateTime": "2023-07-26T10:21:33Z",
                            "ExpireTime": "9999-12-31T23:59:59Z",
                            "ClassId": 0,
                            "ClassName": "其他",
                            "ClassPath": "其他",
                            "CoverUrl": "",
                            "Type": "mp4",
                            "MediaUrl": "http://push.url/6cbbc436vodcq1500020831/03c1ada53270835011057780896/9e505713fb216f0b0232064f.mp4",
                            "SourceInfo": {
                              "SourceType": "VideoProcessing",
                              "SourceContext": ""
                            },
                            "StorageRegion": "ap-chongqing",
                            "Vid": "3270835011057780896",
                            "Category": "Video",
                            "Status": "Normal",
                            "StorageClass": "STANDARD"
                          },
                          "TranscodeInfo": {
                            "TranscodeSet": [
                              {
                                "Url": "http://push.url/6cbbc436vodcq1500020831/03c1ada53270835011057780896/9e505713fb216f0b0232064f.mp4",
                                "Definition": 0,
                                "Bitrate": 576721,
                                "Height": 360,
                                "Width": 640,
                                "Size": 2239086,
                                "Duration": 31.104,
                                "Md5": "",
                                "Container": "mov,mp4,m4a,3gp,3g2,mj2",
                                "VideoStreamSet": [
                                  {
                                    "Bitrate": 530177,
                                    "Height": 360,
                                    "Width": 640,
                                    "Codec": "h264",
                                    "Fps": 14,
                                    "CodecTag": "",
                                    "DynamicRangeInfo": {
                                      "Type": "SDR",
                                      "HDRType": ""
                                    }
                                  }
                                ],
                                "AudioStreamSet": [
                                  {
                                    "Bitrate": 46544,
                                    "SamplingRate": 16000,
                                    "Codec": "aac"
                                  }
                                ],
                                "DigitalWatermarkType": "None",
                                "CopyRightWatermarkText": ""
                              },
                              {
                                "Url": "http://push.url/43a5b1devodtranscq1500020831/03c1ada53270835011057780896/v.f100020.mp4",
                                "Definition": 100020,
                                "Bitrate": 427974,
                                "Height": 540,
                                "Width": 960,
                                "Size": 1677353,
                                "Duration": 31.151,
                                "Md5": "4f51593ed8e28b5d35553f4977d39547",
                                "Container": "mov,mp4,m4a,3gp,3g2,mj2",
                                "VideoStreamSet": [
                                  {
                                    "Bitrate": 363857,
                                    "Height": 540,
                                    "Width": 960,
                                    "Codec": "h264",
                                    "Fps": 25,
                                    "CodecTag": "avc1",
                                    "DynamicRangeInfo": {
                                      "Type": "SDR",
                                      "HDRType": ""
                                    }
                                  }
                                ],
                                "AudioStreamSet": [
                                  {
                                    "Bitrate": 64117,
                                    "SamplingRate": 44100,
                                    "Codec": "aac"
                                  }
                                ],
                                "DigitalWatermarkType": "None",
                                "CopyRightWatermarkText": ""
                              }
                            ]
                          },
                          "FileId": "3270835011057780896"
                        }
                      ],
                      "RequestId": "c827629f-08b4-406c-b063-b660126e922f"
                    },
                    "Huawei": {
                      "Keys": [
                        {
                          "ETag": "\"ef4e0314095b8aae02d7a5adaa60c94f\"",
                          "Key": "record/app/command_record/alinxu_test/2023-07-28-09-30-06.mp4",
                          "LastModified": "2023-07-28T09:31:29.176Z",
                          "Size": 2172786,
                          "MediaUrl": "http://push.url/record/app/command_record/alinxu_test/2023-07-28-09-30-06.mp4"
                        }
                      ],
                      "NextMarker": ""
                    },
                    "Ws": {
                      "Keys": [
                        {
                          "ETag": "lv1tsU6T8r9hDZietipfSphc806Y",
                          "Key": "app-alinxu_test--20230728181527.mp4",
                          "LastModified": "2023-07-28T10:16:44Z",
                          "Size": 6441553,
                          "MediaUrl": "http://push.url/app-alinxu_test--20230728181527.mp4"
                        }
                      ],
                      "NextMarker": ""
                    }
                  },
                  "RequestId": "6877226848471811505"
                }



components:
  schemas:
    SearchMediaResponse:
      type: object
      properties:
        Code:
          type: number
          description: |
            The following only lists some return codes related to the interface business logic. For complete return codes, please refer to [Global Return Codes](/real-time-video-server/api-reference/return-codes).

            <table>
              <thead>
                <tr>
                  <th>Return Code</th>
                  <th>Description</th>
                  <th>Suggested Action</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>0</td>
                  <td>Request successful.</td>
                  <td>-</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>Output parameter error.</td>
                  <td>-</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>Relevant permissions not activated.</td>
                  <td>Please contact ZEGO technical support.</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>CDN type mismatch.</td>
                  <td>Please check parameters.</td>
                </tr>
                <tr>
                  <td>5</td>
                  <td>Configuration error.</td>
                  <td>Please contact ZEGO technical support.</td>
                </tr>
                <tr>
                  <td>6</td>
                  <td>Request too frequent.</td>
                  <td>Please try again later.</td>
                </tr>
                <tr>
                  <td>7</td>
                  <td>Authentication failed.</td>
                  <td>Please check if authentication parameters are correct.</td>
                </tr>
                <tr>
                  <td>8</td>
                  <td>Failed to get authentication configuration.</td>
                  <td>Please contact ZEGO technical support to confirm if this service is activated.</td>
                </tr>
                <tr>
                  <td>1000</td>
                  <td>Request failed.</td>
                  <td>Please contact ZEGO technical support.</td>
                </tr>
              </tbody>
            </table>
          example: 0
        Message:
          type: string
          description: Description of operation result.
          example: "success"
        RequestId:
          type: string
          description: Request ID, returned by ZEGO server.
          example: "6877226848471811505"
        Data:
          type: object
          description: Response data.
          properties:
            Tencent:
              type: object
              description: <code>Tencent Cloud</code> return content (returned when Vendor is Tencent).
              properties:
                RequestId:
                  type: string
                  description: Unique request ID, returned by the CDN provider corresponding to the Vendor parameter value (i.e., Tencent). This RequestId needs to be provided when troubleshooting problems.
                  example: "c827629f-08b4-406c-b063-b660126e922f"
                TotalCount:
                  type: number
                  description: Total number of records matching the search criteria. Maximum value is 5000. When the number of matching records exceeds 5000, this parameter will return 5000 instead of the actual total.
                  example: 1
                MediaInfoSet:
                  type: array
                  description: List of media file information.
                  items:
                    type: object
                    properties:
                      FileId:
                        type: string
                        description: Unique file identifier, which is the FileID in the <a href="/real-time-video-server/callback/cdn/cdn-record-completed" target="blank">Recording File Generation Callback</a>.
                        example: "3270835011057780896"
                      BasicInfo:
                        type: object
                        description: Basic information, including video name, category, playback URL, cover image, etc.
                        properties:
                          Name:
                            type: string
                            description: Media name.
                            example: "1690354361.mp4"
                          Description:
                            type: string
                            description: Media file description.
                            example: ""
                          CreateTime:
                            type: string
                            description: Creation time of the media file, using "ISO date format".
                            example: "2023-07-26T06:52:49Z"
                          UpdateTime:
                            type: string
                            description: Last update time of the media file (operations such as modifying video properties or initiating video processing will trigger updates to media file information), using "ISO date format".
                            example: "2023-07-26T10:21:33Z"
                          ExpireTime:
                            type: string
                            description: |
                              Expiration time of the media file, using "ISO date format". After expiration, the media file and its related resources (transcoding results, sprites, etc.) will be permanently deleted. "9999-12-31T23:59:59Z" means never expires.
                            example: "9999-12-31T23:59:59Z"
                          ClassId:
                            type: number
                            description: Category ID of the media file.
                            example: 0
                          ClassName:
                            type: string
                            description: Category name of the media file.
                            example: "Other"
                          ClassPath:
                            type: string
                            description: Category path of the media file, separated by "-", such as "New Level 1 Category - New Level 2 Category".
                            example: "Other"
                          CoverUrl:
                            type: string
                            description: Cover image URL of the media file.
                            example: ""
                          Type:
                            type: string
                            description: Container format of the media file, such as mp4, flv, etc.
                            example: "mp4"
                          MediaUrl:
                            type: string
                            description: URL address of the original media file.
                            example: "http://push.url/6cbbc436vodcq1500020831/03c1ada53270835011057780896/9e505713fb216f0b0232064f.mp4"
                          SourceInfo:
                            type: object
                            description: Source information of the media file.
                            properties:
                              SourceType:
                                type: string
                                description: Source type.
                                example: "VideoProcessing"
                              SourceContext:
                                type: string
                                description: Source stream.
                                example: ""
                          StorageRegion:
                            type: string
                            description: Storage region of the media file, such as ap-guangzhou.
                            example: "ap-chongqing"
                          Vid:
                            type: string
                            description: Unique identifier of the live recording file.
                            example: "3270835011057780896"
                          Category:
                            type: string
                            description: |
                              <p>File type.</p><ul><li>Video: Video file.</li><li>Audio: Audio file.</li><li>Image: Image file.</li></ul>
                            example: "Video"
                          Status:
                            type: string
                            description: |
                              <p>File status.</p><ul><li>Normal: Normal.</li><li>Forbidden: Banned.</li></ul>
                            example: "Normal"
                          StorageClass:
                            type: string
                            description: |
                              <p>Storage class of the file.</p><ul><li>STANDARD: Standard storage.</li><li>STANDARD_IA: Infrequent access storage.</li><li>ARCHIVE: Archive storage.</li><li>DEEP_ARCHIVE: Deep archive storage.</li></ul>
                            example: "STANDARD"
                      TranscodeInfo:
                        type: object
                        description: Information related to media file transcoding results, including file address, specification, bitrate, resolution, etc. after transcoding.
                        properties:
                          TranscodeSet:
                            type: array
                            description: Collection of media file transcoding information, each element represents 1 transcoding result.
                            items:
                              type: object
                              properties:
                                Url:
                                  type: string
                                  description: Address of the transcoded video file.
                                  example: "http://push.url/6cbbc436vodcq1500020831/03c1ada53270835011057780896/9e505713fb216f0b0232064f.mp4"
                                Definition:
                                  type: integer
                                  description: Transcoding specification ID, value 0 indicates the original file.
                                  example: 0
                                Bitrate:
                                  type: integer
                                  description: |
                                    Sum of the average value of "video stream bitrate" and the average value of "audio stream bitrate", unit: bps.
                                  example: 576721
                                Height:
                                  type: integer
                                  description: |
                                    Maximum value of video stream height, unit: px.
                                  example: 360
                                Width:
                                  type: integer
                                  description: |
                                    Maximum value of video stream width, unit: px
                                  example: 640
                                Size:
                                  type: integer
                                  description: |
                                    Total size of the media file, unit: bytes. When the media file is HLS, the size is the sum of m3u8 and ts file sizes.
                                  example: 2239086
                                Duration:
                                  type: number
                                  format: float
                                  description: |
                                    Video duration, unit: seconds.
                                  example: 31.104
                                Md5:
                                  type: string
                                  description: MD5 value of the video.
                                  example: ""
                                Container:
                                  type: string
                                  description: Container type, such as m4a, mp4, etc.
                                  example: "mov,mp4,m4a,3gp,3g2,mj2"
                                VideoStreamSet:
                                  type: array
                                  description: Video stream information.
                                  items:
                                    type: object
                                    properties:
                                      Bitrate:
                                        type: integer
                                        description: |
                                          Bitrate of the video stream, unit: bps.
                                        example: 530177
                                      Height:
                                        type: integer
                                        description: |
                                          Height of the video stream, unit: px.
                                        example: 360
                                      Width:
                                        type: integer
                                        description: |
                                          Width of the video stream, unit: px.
                                        example: 640
                                      Codec:
                                        type: string
                                        description: Encoding format of the video stream, such as h264.
                                        example: "h264"
                                      Fps:
                                        type: integer
                                        description: |
                                          Frame rate, unit: hz.
                                        example: 14
                                      CodecTag:
                                        type: string
                                        description: Encoding tag, only valid when Codec is hevc.
                                        example: ""
                                      DynamicRangeInfo:
                                        type: object
                                        description: Dynamic range information of the picture.
                                        properties:
                                          Type:
                                            type: string
                                            description: |
                                              <p>Dynamic range information of the picture.</p><ul><li>SDR: Standard Dynamic Range.</li><li>HDR: High Dynamic Range.</li></ul>
                                            example: "SDR"
                                          HDRType:
                                            type: string
                                            description: <p>High dynamic range type standard, valid when Type is HDR.</p><ul><li>hdr10</li><li>hlg</li></ul>
                                            example: ""
                                AudioStreamSet:
                                  type: array
                                  description: Audio stream information.
                                  items:
                                    type: object
                                    properties:
                                      Bitrate:
                                        type: integer
                                        description: |
                                          Bitrate of the audio stream, unit: bps.
                                        example: 46544
                                      SamplingRate:
                                        type: integer
                                        description: |
                                          Sampling rate of the audio stream, unit: hz.
                                        example: 16000
                                      Codec:
                                        type: string
                                        description: Encoding format of the audio stream, such as aac.
                                        example: "aac"
                                DigitalWatermarkType:
                                  type: string
                                  description: |
                                    <p>Digital watermark type.</p><ul><li>Trace: Indicates traceability watermark processing.</li><li>CopyRight: Indicates copyright watermark processing.</li><li>None: Indicates no watermark processing.</li></ul>
                                  example: "None"
                                CopyRightWatermarkText:
                                  type: string
                                  description: Copyright information.
                                  example: ""
            Huawei:
              type: object
              description: <code>Huawei Cloud</code> return content (returned when Vendor is Huawei).
              properties:
                NextMarker:
                  type: string
                  description: Index for the next retrieval. Pass this to the Marker parameter in the next call to this interface.
                  example: ""
                Keys:
                  type: array
                  description: List of media file information.
                  items:
                    type: object
                    properties:
                      ETag:
                        type: string
                        description: MD5 value of the media file.
                        example: "\"ef4e0314095b8aae02d7a5adaa60c94f\""
                      Key:
                        type: string
                        description: Unique identifier of the media file, which is the ObsObject in the <a href="/real-time-video-server/callback/cdn/cdn-record-completed" target="blank">Recording File Generation Callback</a>.
                        example: "record/app/command_record/alinxu_test/2023-07-28-09-30-06.mp4"
                      LastModified:
                        type: string
                        description: Last modification time of the media file.
                        example: "2023-07-28T09:31:29.176Z"
                      Size:
                        type: number
                        description: Size of the media file.
                        example: 2172786
                      MediaUrl:
                        type: string
                        description: Address of the media file.
                        example: "http://push.url/record/app/command_record/alinxu_test/2023-07-28-09-30-06.mp4"
            Ws:
              type: object
              description: <code>Wangsu Cloud</code> return content (returned when Vendor is Ws).
              properties:
                NextMarker:
                  type: string
                  description: Index for the next retrieval. Pass this to the Marker parameter in the next call to this interface.
                  example: ""
                Keys:
                  type: array
                  description: List of media file information.
                  items:
                    type: object
                    properties:
                      ETag:
                        type: string
                        description: MD5 value of the media file.
                        example: "lv1tsU6T8r9hDZietipfSphc806Y"
                      Key:
                        type: string
                        description: Unique identifier of the media file, which is the PersistentId in the <a href="/real-time-video-server/callback/cdn/cdn-record-completed" target="blank">Recording File Generation Callback</a>.
                        example: "app-alinxu_test--20230728181527.mp4"
                      LastModified:
                        type: string
                        description: Last modification time of the media file.
                        example: "2023-07-28T10:16:44Z"
                      Size:
                        type: number
                        description: Size of the media file.
                        example: 6441553
                      MediaUrl:
                        type: string
                        description: Address of the media file.
                        example: "http://push.url/app-alinxu_test--20230728181527.mp4"
