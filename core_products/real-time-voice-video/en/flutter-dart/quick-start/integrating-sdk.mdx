---
articleID: 1241
date: "2024-05-06"
---
# Integrate the SDK

---

## Prepare environment
Before integrating the ZEGO Express SDK, ensure that your development environment meets the following requirements:
- [Flutter](https://flutter.dev/docs/get-started/install) 2.0 or above.
- iOS 12.0 or above, with an iOS device or simulator that supports audio and video (using a real device is recommended).
- Android 4.4 or above, with an Android device or simulator that supports audio and video (using a real device is recommended). If using a real device, enable the "Allow Debugging" option.
- Windows 8 or above.
- macOS 10.14 or above.
- Web: Chrome 58 or above, Firefox 56 or above, Safari 11 or above, Opera 45 or above, QQ Browser: Windows 10.1 or above/macOS 4.4 or above, 360 Secure Browser Speed Mode.
- Linux: Debian 10 or above, Ubuntu 20.04 LTS, 22.04 LTS, 24.04 LTS.
- The device is connected to the Internet.

Please configure the development environment as follows:
- Android Studio: "Preferences > Plugins", search for the "Flutter" plugin to download, and configure the downloaded Flutter SDK path in the plugin.
- VS Code: Search for the "Flutter" extension in the app store and download it.

After configuring the Flutter environment in any of the above development environments, run `flutter doctor` in the terminal, and complete the relevant undownloaded dependencies according to the prompts.

<Note title="Description">


<p>Flutter SDK supports developing iOS, Android, Windows, macOS, and Web programs, but the number of interfaces and integration methods for Web are somewhat different from other platforms. For details, please refer to the README.md file in the <a href="https://github.com/zegoim/zego-express-flutter-sdk/">SDK package</a>.</p>

</Note>



## Integrate the SDK

### Create a new project (optional)

<Accordion title="This step takes creating a new project as an example. If integrating into an existing project, you can ignore this step." defaultOpen="false">
Please refer to [Flutter Documentation - Get Started](https://flutter.dev/docs/get-started/test-drive#create-app) to create a Flutter project.
</Accordion>

### Import the SDK

1. Open the "pubspec.yaml" file and add the "zego_express_engine" dependency. There are two ways:

    - **Method 1**: Depend on "pub" form (recommended):

    ```yaml
    dependencies:
      flutter:
      sdk: flutter

      zego_express_engine: ^3.10.3
    ```

<Note title="Description">


    The version number in the above code is only an example and not the latest version. For the latest version number, please refer to [Download](/real-time-video-flutter/client-sdk/download-sdk).

    </Note>



    - **Method 2**: Depend on "git" form:

    ```yaml
    dependencies:
      flutter:
      sdk: flutter

      zego_express_engine:
        git:
          url: git@github.com:zegoim/zego-express-flutter-sdk.git
          ref: main
    ```

2. After adding and saving the file, run `flutter pub get` in the terminal.

## Set up permissions
Set the permissions required by the application according to actual needs.

### Add permissions for Android

Go to the "app/src/main" directory, open the "AndroidManifest.xml" file, and add permissions.

<Note title="Description">


If obfuscation is enabled during the release APK build (flutter build apk) (enabled by default), you need to configure ZEGOCLOUD-related classes to prevent obfuscation. Please refer to [FAQ](/real-time-video-flutter/quick-start/integrating-sdk).

</Note>



```xml
<!-- Permissions required by the SDK -->
<uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
<uses-permission android:name="android.permission.RECORD_AUDIO" />
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.BLUETOOTH" />
<uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" />

<!-- Permissions required by the Demo App -->
<uses-permission android:name="android.permission.READ_PHONE_STATE" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.WAKE_LOCK" />

<feature android:glEsVersion="0x00020000" android:required="true" />
<feature android:name="android.hardware.camera" />
<feature android:name="android.hardware.camera.autofocus" />
```


Since Android 6.0 requires dynamic permissions for some important permissions, you cannot only apply for static permissions through the "AndroidMainfest.xml" file. Please find a third-party flutter plugin on [pub](http://pub.dev/) to implement it, or refer to the following code in the Android native layer, where "requestPermissions" is a method of "Activity".


```java
String[] permissionNeeded = {
    "android.permission.CAMERA",
    "android.permission.RECORD_AUDIO"};

if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
    if (ContextCompat.checkSelfPermission(this, "android.permission.CAMERA") != PackageManager.PERMISSION_GRANTED ||
        ContextCompat.checkSelfPermission(this, "android.permission.RECORD_AUDIO") != PackageManager.PERMISSION_GRANTED) {
        requestPermissions(permissionNeeded, 101);
    }
}
```

The specific permission descriptions are as follows:

<table>

<tbody><tr>
<th>Necessity</th>
<th>Permission</th>
<th>Permission Description</th>
<th>Reason for Application</th>
</tr>
<tr>
<td rowspan="7">Required permissions</td>
<td>INTERNET</td>
<td>Access network permission.</td>
<td>SDK basic functions need to be used when connected to the network.</td>
</tr>
<tr>
<td>ACCESS_WIFI_STATE</td>
<td>Get current WiFi status permission.</td>
<td rowspan="2">The SDK will perform different operations based on changes in network status. For example, when the network is reconnected, the SDK will restore all states when the network was disconnected internally, and users do not need to perform additional operations.</td>
</tr>
<tr>
<td>ACCESS_NETWORK_STATE</td>
<td>Get current network status permission.</td>
</tr>
<tr>
<td>CAMERA</td>
<td>Access camera permission.</td>
<td>When previewing and sending video, this permission is required.</td>
</tr>
<tr>
<td>RECORD_AUDIO</td>
<td>Record audio permission.</td>
<td>When sending audio, this permission is required.</td>
</tr>
<tr>
<td>BLUETOOTH</td>
<td>Connect Bluetooth device permission.</td>
<td>When connecting to a Bluetooth device, this permission is required.</td>
</tr>
<tr>
<td>MODIFY_AUDIO_SETTINGS</td>
<td>Modify audio configuration permission.</td>
<td>When modifying audio device configuration, this permission is required.</td>
</tr>
<tr>
<td rowspan="2">Optional permissions</td>
<td>READ_PHONE_STATE</td>
<td>Allow read-only access to phone status, including current call status.</td>
<td>The SDK will start and stop audio devices based on the current call status. If a call status is detected, the SDK will automatically stop using audio devices until the call ends.</td>
</tr>
<tr>
<td>WRITE_EXTERNAL_STORAGE</td>
<td>Built-in SDK write permission.</td>
<td>If you need to use the media player or sound effect player to load media resource files in Android external storage, you need to apply for this permission, otherwise the SDK cannot load resources.</td>
</tr>
</tbody></table>

<Note title="Description">

The optional permission "android.permission.READ_PHONE_STATE" is only used to implement the SDK's interrupt event handling, so it only needs to be declared in the AndroidMainfest.xml file and does not need to be applied dynamically (if the business side has requirements, handle it separately).

</Note>





### Add permissions for iOS

1. Open the project, select "TARGETS > Info > Custom iOS Target Properties".

    <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/iOS/ZegoExpressEngine/Common/privacy-description.png" /></Frame>

2. Click the "+" button to add camera and microphone permissions.

 - `Privacy - Camera Usage Description`

 - `Privacy - Microphone Usage Description`

3. After adding permissions, as shown in the figure:

    <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/iOS/ZegoExpressEngine/Common/privacy-description-done.png" /></Frame>

<Note title="Description">


    If you use Platform View and the Flutter version is lower than 1.22, you need to add other descriptions for iOS. Please refer to [FAQ](/real-time-video-flutter/quick-start/integrating-sdk).

    </Note>



### Import JavaScript SDK (for Web)

In index.html, use the \<script> tag to import ZegoExpressWebFlutterWrapper.js from the /assets/packages/zego_express_engine directory in the ZEGO Express SDK for Flutter package.

Example code:

```html
<!-- <your-project>/web/index.html -->
<!DOCTYPE html>
<html>
...
<body>
  ...
  <script type="application/javascript" src="assets/packages/zego_express_engine/assets/ZegoExpressWebFlutterWrapper.js"></script>
  ...
</body>
</html>
```

## FAQ

1. **iOS platform error: "fatal error: lipo: -extract armv7 specified but fat file: [...] does not contain that architecture", how to handle?**

    Usually occurs when switching iOS devices, can be solved by deleting the "flutter-project-path/build" and "flutter-project-path/ios/DerivedData" directories. (If there is no "DerivedData" folder, please look for "/Users/your-user-name/Library/Developer/Xcode/DerivedData").

2. **iOS platform compilation error: "CDN: trunk URL couldn't be downloaded" or "CDN: trunk Repo update failed", how to handle?**

    Open Terminal, `cd` into the "ios" folder under the project root directory (where the "Podfile" file is located), and run `pod repo update`.

    This error is usually caused by poor domestic network. It is recommended to enable a proxy. Please refer to [CocoaPods FAQ](https://doc-zh.zego.im/faq/CocoaPods_question?product=HybridHierarchicalDeliverySystem&platform=macos).

3. **"NoClassDefFoundError" occurs on Android release causing Crash, how to handle?**

    Flutter enables obfuscation by default in version 1.10 or above. Please add "-keep" class configuration for the SDK in the "app/proguard-rules.pro" file to prevent obfuscation.

    ```java
    -keep class **.zego.**{*;}
    ```

4. **When frequently creating and destroying TextureRenderer on the Android platform, a crash occurs with the following error, how to handle?**

    ```java
    OpenGLRenderer  E  [SurfaceTexture-0-4944-46] updateTexImage: SurfaceTexture is abandoned!
    flutter  E  [ERROR:flutter/shell/platform/android/platform_view_android_jni.cc(39)] java.lang.RuntimeException: Error during updateTexImage (see logcat for details)
    ```

    This problem is caused by thread insecurity when calling "updateTexImage()" and "release()" of "SurfaceTexture" inside the Flutter Engine. This problem has been fixed in Flutter 1.24-candidate.2. For details, please refer to [Prevent race between SurfaceTexture.release and updateTexImage](https://github.com/flutter/engine/pull/21777).

5. **iOS platform build error: "[!] Unable to install vendored xcframework 'ZegoExpressEngine' for Pod 'zego_express_engine', because it contains both static and dynamic frameworks.", how to handle?**

    1. First, please check the local CocoaPods version. If you are using Xcode 14.0 or higher, you must use CocoaPods 1.12.0 or higher. If the CocoaPods version is too low, please upgrade to the latest version to solve this problem.

    2. If it still cannot be solved, it may be because when the locally dependent SDK package is decompressed, the soft links in the native iOS xcframework used in the SDK package are lost, and the soft links become files. You can check whether the following files in the locally dependent SDK package are soft links. If they are not soft links, this problem will occur. You can try a different decompression method.

       - ios/libs/ZegoExpressEngine.xcframework/ios-arm64_x86_64-maccatalyst/ZegoExpressEngine.framework/Headers
       - ios/libs/ZegoExpressEngine.xcframework/ios-arm64_x86_64-maccatalyst/ZegoExpressEngine.framework/Modules
       - ios/libs/ZegoExpressEngine.xcframework/ios-arm64_x86_64-maccatalyst/ZegoExpressEngine.framework/Resources
       - ios/libs/ZegoExpressEngine.xcframework/ios-arm64_x86_64-maccatalyst/ZegoExpressEngine.framework/ZegoExpressEngine
