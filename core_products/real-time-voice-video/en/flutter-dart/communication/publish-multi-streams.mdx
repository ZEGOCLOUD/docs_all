# Publish Multiple Streams Simultaneously [To Be Modified]

- - -

## Function Overview

The Express SDK provides the capability to publish multiple streams simultaneously. When developers encounter the following situations in their business, it is recommended to use the SDK's multi-stream publishing feature:

- Game streamers publish camera footage on the main stream and screen capture footage on the second stream.
- Outdoor streamers publish front camera footage on the main stream and rear camera footage on the second stream.

<Note title="Note">

Currently, the SDK supports a maximum of 4 publishing channels. Versions before 2.14.0 default to a maximum of 2 publishing channels. If you need to support more publishing channels, please contact ZEGO technical support for special packaging.
</Note>

## Example Source Code Download

Please refer to [Download Example Source Code](/real-time-video-flutter/quick-start/run-example-code) to obtain the source code.

For related source code, please view files in the "/ZegoExpressExample/AdvancedStreaming/src/main/java/im/zego/publishingmultiplestreams" directory of the downloaded example source code.


## Prerequisites

Before implementing multi-stream publishing functionality, ensure that:

- You have created a project in the [ZEGO Console](https://console.zego.im) and applied for a valid AppID and AppSign. For details, please refer to [Console - Project Information](/console/project-info).
- You have integrated the ZEGO Express SDK into your project and implemented basic audio/video stream publishing and playing functionality. For details, please refer to [Quick Start - Integration](/real-time-video-flutter/quick-start/integrating-sdk) and [Quick Start - Implementation](/real-time-video-flutter/quick-start/implementing-video-call).





## Usage Steps

<Warning title="Warning">


- Publishing streams other than the main stream cannot directly access camera data.
- By default, non-main streams can only publish audio data. If you need to publish audio and video data, you need to enable custom video capture functionality.
- This document will introduce the implementation method for publishing auxiliary streams. The implementation for publishing other non-main streams is similar.

</Warning>



### 1 Create ZegoExpressEngine Engine

Please refer to [Quick Start - Implementing Video Call]() section "3.1 Create Engine".

```java
ZegoEngineProfile profile = new ZegoEngineProfile();
profile.appID = appID;
profile.appSign = appSign;
profile.scenario = ZegoScenario.DEFAULT;
profile.application = getApplication();
engine = ZegoExpressEngine.createEngine(profile, null);
```

### 2 (Optional) Set Custom Video Capture Configuration

<Accordion title="Custom Video Capture Configuration Settings" defaultOpen="false">
Call the [ZegoCustomVideoCaptureConfig ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-entity-zego-custom-video-capture-config) interface to create a custom video capture object, set the [bufferType ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-entity-zego-custom-video-capture-config#buffer-type) property to provide the SDK with video frame data type; call the [enableCustomVideoCapture ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#enable-custom-video-capture-1) interface to enable custom video capture functionality. For details, please refer to [Custom Video Capture](/real-time-video-flutter/video/custom-video-capture).

<Note title="Note">



Due to the diversity of Android capture, the SDK supports multiple video frame data types [bufferType ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-entity-zego-custom-video-capture-config#bufferType). Developers need to inform the SDK of the data type being used.

</Note>





```java
ZegoCustomVideoCaptureConfig videoCaptureConfig = new ZegoCustomVideoCaptureConfig();
// Select RAW_DATA type video frame data
videoCaptureConfig.bufferType = ZegoVideoBufferType.RAW_DATA;
engine.enableCustomVideoCapture(true, videoCaptureConfig, ZegoPublishChannel.AUX);
```
</Accordion>


### 3 (Optional) Set Custom Video Capture Callback for Auxiliary Publisher

<Accordion title="Auxiliary Publisher Custom Video Capture Callback Settings" defaultOpen="false">
Call [setCustomVideoCaptureHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#set-custom-video-capture-handler) to set the custom video capture notification callback, and implement the [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-start) and [onStop](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-stop) custom capture callback methods.

```java
// Set itself as the custom video capture callback object
sdk.setCustomVideoCaptureHandler(new IZegoCustomVideoCaptureHandler() {
    @Override
    public void onStart(ZegoPublishChannel channel) {
        // After receiving the callback, the developer needs to execute business logic related to starting video capture, such as enabling the camera, etc.
        ...
    }
    @Override
    public void onStop(ZegoPublishChannel channel) {
        // After receiving the callback, the developer needs to execute business logic related to stopping video capture, such as disabling the camera, etc.
        ...
    }
});
```
</Accordion>


### 4 Call Auxiliary Publisher Methods to Implement Preview and Publish Stream

After logging into the room, call the start preview interface [startPreview ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#start-preview) or start publishing stream interface [startPublishingStream ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#start-publishing-stream), which triggers the [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-start) callback from [3 Set Custom Video Capture Callback for Auxiliary Publisher](#3-optional-set-custom-video-capture-callback-for-auxiliary-publisher). When the [onStart ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-start) callback is triggered, developers can start capturing video frame data.


When stopping publishing stream [stopPublishingStream](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#stop-publishing-stream) and stopping preview [stopPreview ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java~class~im-zego-zegoexpress-zego-express-engine#stop-preview), the [onStop ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-stop) callback from [3 Set Custom Video Capture Callback for Auxiliary Publisher](#3-optional-set-custom-video-capture-callback-for-auxiliary-publisher) will be triggered. At this time, developers should stop capturing video data.

```java
/**
*  Start preview, set local preview view, view mode uses SDK default mode, proportional scaling fills the entire View
*  Below, preview_view is the SurfaceView/TextureView/SurfaceTexture object on the UI interface
*/
engine.startPreview(new ZegoCanvas(preview_view), ZegoPublishChannel.AUX);

/** Start publishing stream */
engine.startPublishingStream("stream1", ZegoPublishChannel.AUX);
```

### 5 (Optional) Send Captured Video Frame Data to SDK


<Accordion title="Send Captured Video Frame Data to SDK" defaultOpen="false">
After the [onStart ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-start) callback is triggered, developers can call [sendCustomVideoCaptureRawData ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#send-custom-video-capture-raw-data) or [sendCustomVideoCaptureTextureData ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#send-custom-video-capture-texture-data) to send the captured video data to the SDK.

- Call [sendCustomVideoCaptureRawData ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#send-custom-video-capture-raw-data)

    ```java
    engine.sendCustomVideoCaptureRawData(buffer, data.length, param, System.currentTimeMillis(), ZegoPublishChannel.AUX);
    ```

- Call [sendCustomVideoCaptureTextureData ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#send-custom-video-capture-texture-data)

    ```java
    engine.sendCustomVideoCaptureTextureData(textureID, width, height, System.currentTimeMillis(), egoPublishChannel.AUX);
    ```
</Accordion>


### 6 Set Event Callbacks for Auxiliary Publisher

Call the auxiliary publisher's [setEventHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#set-event-handler) interface to set event callbacks for the auxiliary publisher to receive notifications such as "publishing state change callback", "publishing quality callback", "publishing first frame callback", etc.

```java
engine.setEventHandler(new IZegoEventHandler(){

    // Other overridden callbacks
    ...

    @Override
    public void onPublisherStateUpdate(String streamID, ZegoPublisherState state, int errorCode, JSONObject extendedData){
        // Handle corresponding publishing action result logic
        ...
    }
    @Override
    public void onPublisherQualityUpdate(String streamID, ZegoPublishStreamQuality quality){
        // Handle corresponding publishing mid-stream quality related display and other business logic
        ...
    }
    @Override
    public void onPublisherCapturedVideoFirstFrame(ZegoPublishChannel channel){
        // Notification that SDK received video data for the first time
        ...
    }
    @Override
    public void onPublisherVideoSizeChanged(int width, int height, ZegoPublishChannel channel){
        // Developers can remove display video UI mask space and other logic in this callback
    }
    @Override
    public void onPublisherRelayCDNStateUpdate(String streamID, ArrayList<ZegoStreamRelayCDNInfo> infoList){
        // Notification that stream is relayed to CDN
    }

    // Other overridden callbacks
    ...

});

```


## FAQ

1. **When will the [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-start) callback be triggered?**

    When custom video capture is enabled, the SDK will trigger it when starting to publish stream [startPublishingStream ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#start-publishing-stream) or starting preview [startPreview ](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#start-preview).

2. **Do you support publishing more than 4 streams simultaneously?**

    To work with real-time signaling functions, the current SDK defaults to a maximum of 4 publishing channels, but versions before 2.14.0 default to a maximum of 2 publishing channels. If you need to support more publishing channels, please contact ZEGO technical support for special packaging.
