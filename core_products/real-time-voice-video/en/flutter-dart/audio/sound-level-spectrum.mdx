---
articleID: 10920
date: "2024-01-31"
---
# Volume Change and Audio Spectrum

- - -

## Feature Overview

<Warning title="Note">


This document is not applicable to the Web platform.

</Warning>



<table>

<tbody><tr>
<th>Concept</th>
<th>Description</th>
<th>Application Scenarios</th>
<th>Scenario Diagram</th>
</tr>
<tr>
<td>Volume Change</td>
<td>Refers to the volume level of a stream, hereafter referred to as "Sound Level".</td>
<td>During stream publishing and playing, determine which user on the microphone is speaking and display it in the UI.</td>
<td>&nbsp; <Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Android/ZegoLiveRoom/SoundLevel.png" /></Frame></td>
</tr>
<tr>
<td>Audio Spectrum</td>
<td>Refers to the energy value of digital audio signals at various frequency points.</td>
<td>In karaoke scenarios, after publishing or playing streams, allow the host or audience to see animations of pitch and volume changes.</td>
<td>&nbsp; &nbsp;<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Android/ZegoLiveRoom/FrequencySpectrum.png" /></Frame></td>
</tr>
</tbody></table>



## Example Source Code Download

Please refer to [Download Example Source Code](/real-time-video-flutter/quick-start/run-example-code) to get the source code.

For related source code, please view files in the "lib/topics/AudioAdvanced/soundlevel_spectrum" directory.


## Prerequisites

Before implementing Sound Level and Audio Spectrum features, ensure that:

- You have integrated ZEGO Express SDK into your project and implemented basic real-time audio/video functionality. For details, please refer to [Quick Start - Integration](/real-time-video-flutter/quick-start/integrating-sdk) and [Quick Start - Implementation](/real-time-video-flutter/quick-start/implementing-video-call).
- You have created a project in the [ZEGO Admin Console](https://console.zego.im) and applied for a valid AppID and AppSign. For details, please refer to [Admin Console - Project Information](/console/project-info).


## Usage Steps for Non-Mixing Scenarios

### 1 Listen for Sound Level and Audio Spectrum Callback Interfaces

- Interface Prototypes

    - Local captured sound level callback interface [onCapturedSoundLevelUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedSoundLevelUpdate.html):

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * Local captured audio sound level callback
         *
         * Callback notification period is 100 ms.
         * @param soundLevel Local captured sound level value, ranging from 0.0 to 100.0
         */
        static void Function(double soundLevel)? onCapturedSoundLevelUpdate;

        ...

        }
        ```

    - Remote audio sound level callback interface [onRemoteSoundLevelUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteSoundLevelUpdate.html):

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * Remote played stream audio sound level callback
         *
         * Callback notification period is 100 ms.
         * @param soundLevels Key-value pairs of remote sound levels, key is stream ID, value is the corresponding stream's sound level value, value ranges from 0.0 to 100.0
         */
        static void Function(Map<String, double> soundLevels)? onRemoteSoundLevelUpdate;

        ...

        }
        ```

    - Local captured audio spectrum callback interface [onCapturedAudioSpectrumUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedAudioSpectrumUpdate.html):

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * Local captured audio spectrum callback
         *
         * Callback notification period is 100 ms.
         * @param audioSpectrum Array of local captured audio spectrum values, spectrum values range from [0-2^30]
         */
        static void Function(List<double> audioSpectrum)? onCapturedAudioSpectrumUpdate;

        ...

        }
        ```

    - Remote played stream audio spectrum callback interface [onRemoteAudioSpectrumUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteAudioSpectrumUpdate.html):

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * Remote played stream audio spectrum callback
         *
         * Callback notification period is 100 ms.
         * @param audioSpectrums Key-value pairs of remote audio spectrums, key is stream ID, value is the corresponding stream's audio spectrum value array, spectrum values range from [0-2^30]
         */
        static void Function(Map<String, List<double>> audioSpectrums)? onRemoteAudioSpectrumUpdate;

        ...

        }
        ```

- Usage Examples

    The callbacks for remote played stream sound levels and remote audio spectrums provide a `Map`, where `key` is the stream ID of other users currently publishing in the room, and `value` is the sound level/audio spectrum data corresponding to that stream.

    You can first use the [onRoomStreamUpdate](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onRoomStreamUpdate.html) callback method to get the list of existing streams in the current room and save it, then use the saved stream list to index the `Map` to obtain the sound level/audio spectrum data for each stream.

    The following example demonstrates how to get sound level/audio spectrum data from callback methods and pass it to the UI. For specific context, please refer to files in the "lib/topics/AudioAdvanced/soundlevel_spectrum" directory in the example source code.

    ```dart
    ZegoExpressEngine.onCapturedSoundLevelUpdate = (double soundLevel) {
            // Developers can render the local sound level data to specific UI controls here
    }
    ZegoExpressEngine.onRemoteSoundLevelUpdate = (Map<String, double> soundLevels) {
            // Developers can render the remote sound level data to specific UI controls here
    }
    ZegoExpressEngine.onCapturedAudioSpectrumUpdate = (List<double> audioSpectrum) {
            // Developers can render the local audio spectrum data to specific UI controls here
    }
    ZegoExpressEngine.onRemoteAudioSpectrumUpdate = (Map<String, List<double>> audioSpectrums) {
            // Developers can render the remote audio spectrum data to specific UI controls here
    }
    ```

### 2 Start Monitoring Sound Level and Audio Spectrum Callbacks

You can separately enable monitoring for sound level and audio spectrum callbacks.

- Call [startSoundLevelMonitor](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineDevice/startSoundLevelMonitor.html) to start sound level monitoring:

    ```dart
    // Start sound level monitoring
    ZegoExpressEngine.instance.startSoundLevelMonitor();
    ```

    When calling the [startSoundLevelMonitor](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineDevice/startSoundLevelMonitor.html) interface, you can set the `millisecond` parameter to adjust the sound level callback interval.
    ```dart
    // millisecond: Sound level monitoring period in milliseconds, range [100, 3000]. Default is 100 ms.
    ZegoExpressEngine.instance.startSoundLevelMonitor({millisecond: 100});
    ```

    After calling the above interface, [onCapturedSoundLevelUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedSoundLevelUpdate.html) will trigger immediately, with a callback value of 0 when not publishing and not previewing; [onRemoteSoundLevelUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteSoundLevelUpdate.html) will only callback after starting to play streams with [startPlayingStream ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEnginePlayer/startPlayingStream.html).

- Call [startAudioSpectrumMonitor ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineDevice/startAudioSpectrumMonitor.html) to start audio spectrum monitoring:

    ```dart
    // Start audio spectrum monitoring
    ZegoExpressEngine.instance.startAudioSpectrumMonitor();
    ```

    After calling the above interface, [onCapturedAudioSpectrumUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedAudioSpectrumUpdate.html) will trigger immediately, with a callback value of 0 when not publishing and not previewing; [onRemoteAudioSpectrumUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteAudioSpectrumUpdate.html) will only callback after starting to play streams with [startPlayingStream ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEnginePlayer/startPlayingStream.html).

### 3 Stop Monitoring Audio Spectrum and Sound Level Callbacks

You can separately disable monitoring for sound level or audio spectrum callbacks.

- Call [stopSoundLevelMonitor ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineDevice/stopSoundLevelMonitor.html) to stop sound level monitoring:

    ```dart
    // Stop sound level monitoring
    ZegoExpressEngine.instance.stopSoundLevelMonitor();
    ```

    After calling the above interface, [onCapturedSoundLevelUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedSoundLevelUpdate.html) and [onRemoteSoundLevelUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteSoundLevelUpdate.html) will no longer callback.

- Call [stopAudioSpectrumMonitor ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineDevice/stopAudioSpectrumMonitor.html) to stop audio spectrum monitoring:

    ```dart
    // Stop audio spectrum monitoring
    ZegoExpressEngine.instance.stopAudioSpectrumMonitor();
    ```

    After calling the above interface, [onCapturedAudioSpectrumUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedAudioSpectrumUpdate.html) and [onRemoteAudioSpectrumUpdate ](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteAudioSpectrumUpdate.html) will no longer callback.

## Usage Steps for Mixing Scenarios

- Mixing refers to the feature of mixing multiple streams into one stream. When customers need to display sound level information of each stream before mixing, they can use the mixing sound level feature. Since the output of mixing is a single stream, using the sound level information of the mixed output stream cannot meet the need to display sound levels of each input stream. At this time, during mixing, the sound level information of input streams needs to be carried in the stream information, and then when playing the mixed output stream, the sound level information of each input stream can be parsed from the stream information.
- When parsing the sound level information of each input stream from the stream information, we get the values corresponding to the sound levels of each input stream, which is a dictionary. The `key` in the dictionary is the stream identifier, and `value` is the sound level value. However, due to the size limit of stream information, `key` cannot use stream ID and can only use a numeric ID (soundLevelID) to identify the stream.
- In manual mixing configuration, developers need to maintain the association between numeric IDs (soundLevelID) and stream IDs. In callbacks, developers will get numeric IDs (soundLevelID) and corresponding sound level information.
- In room auto-mixing, the mixing server and SDK automatically handle the association between numeric IDs and stream IDs. In callbacks, developers get stream IDs corresponding to sound level information.


### 1 Listen for Mixing Sound Level Callback Interfaces

- Interface Prototypes

    - Sound level update callback interface for each single stream in manual mixing [onMixerSoundLevelUpdate](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onMixerSoundLevelUpdate.html):

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * Manual mixing audio spectrum callback
         *
         * Callback notification period is 100 ms.
         * @param soundLevels Key-value pairs of remote audio spectrums, key is soundLevelID, value is the corresponding stream's audio spectrum value array, spectrum values range from [0.0 ~ 100.0]
         */
        static void Function(Map<int, double> soundLevels)? onMixerSoundLevelUpdate;

        ...

        }
        ```

    - Sound level update callback interface for each single stream in automatic mixing [onAutoMixerSoundLevelUpdate](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onAutoMixerSoundLevelUpdate.html):

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * Automatic mixing audio spectrum callback
         *
         * Callback notification period is 100 ms.
         * @param soundLevels Key-value pairs of remote audio spectrums, key is stream ID, value is the corresponding stream's audio spectrum value array, spectrum values range from [0.0 ~ 100.0]
         */
        static void Function(Map<String, double> soundLevels)? onAutoMixerSoundLevelUpdate;

        ...

        }
        ```

### 2 Start Monitoring Sound Level Callbacks

When starting/updating mixing, you can enable sound level callback monitoring.

- Manual Mixing Scenario

  When calling the [startMixerTask](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineMixer/startMixerTask.html) interface to initiate a manual mixing task, set the `enableSoundLevel` parameter to `true` to start sound level monitoring, and specify a unique `soundLevelID` for each input stream:

    ```dart
    ZegoMixerTask task = ZegoMixerTask("task123");

    // Enable mixing sound level
    task.enableSoundLevel = true;

    ZegoMixerInput input = ZegoMixerInput.defaultConfig();
    // Assign a soundLevelID to the input stream
    input.soundLevelID = 123;

    // Other configurations

    ZegoExpressEngine.instance.startMixerTask(task);
    ```

- Automatic Mixing Scenario

  When calling the [startAutoMixerTask](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineMixer/startAutoMixerTask.html) interface to initiate an automatic mixing task, set the `enableSoundLevel` parameter to `true` to start sound level monitoring:

    ```dart
    var task = ZegoAutoMixerTask();
    task.roomID = "room123";
    task.taskID = "autotask123";

    // Enable mixing sound level
    task.enableSoundLevel = true;
    // Other configurations

    ZegoExpressEngine.instance.startAutoMixerTask(task);
    ```


### 3 Stop Monitoring Sound Level Callbacks

When updating a mixing task, you can disable sound level callback monitoring.

- Manual Mixing Scenario

  When calling the [startMixerTask](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineMixer/startMixerTask.html) client interface to update a mixing task, set the `enableSoundLevel` parameter to `false` to stop sound level monitoring:

    ```dart
    ZegoMixerTask task = ZegoMixerTask("task123");

    // Disable mixing sound level
    task.enableSoundLevel = false;

    ZegoMixerInput input = ZegoMixerInput.defaultConfig();
    // Assign a soundLevelID to the input stream
    input.soundLevelID = 123;

    // Other configurations

    ZegoExpressEngine.instance.startMixerTask(task);
    ```

- Automatic Mixing Scenario

  When calling the [startAutoMixerTask](https://doc-zh.zego.im/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineMixer/startAutoMixerTask.html) client interface to update an automatic mixing task, set the `enableSoundLevel` parameter to `false` to stop sound level monitoring:

    ```dart
    var task = ZegoAutoMixerTask();
    task.roomID = "room123";
    task.taskID = "autotask123";

    // Disable mixing sound level
    task.enableSoundLevel = false;
    // Other configurations

    ZegoExpressEngine.instance.startAutoMixerTask(task);
    ```

## Related Documents

- [What is the difference between media volume and call volume?](https://doc-zh.zego.im/faq/system_volume)
- [How to handle no sound issues?](https://doc-zh.zego.im/faq/noaudio)
- [How to handle low volume issues?](https://doc-zh.zego.im/faq/audio_low)
