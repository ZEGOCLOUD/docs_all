---
articleID: 10902
date: "2024-07-27"
---
# Media Player

- - -

import Content from '/core_products/real-time-voice-video/en/snippets/media-player-pre.mdx'

<Content />

## Download Sample Source Code

Please refer to [Download Sample Source Code](/real-time-video-flutter/quick-start/run-example-code) to get the source code.

For related source code, please check files in the "/lib/topics/OtherFunctions/media_player" directory.

## Prerequisites

Before implementing the media player feature, ensure:

- You have created a project in the [ZEGOCLOUD Console](https://console.zegocloud.com) and applied for a valid AppID and AppSign. For details, please refer to [Console - Project Information](/console/project-info).
- You have integrated ZEGO Express SDK in your project and implemented basic audio and video publishing and playing features. For details, please refer to [Quick Start - Integrating SDK](/real-time-video-flutter/quick-start/integrating-sdk) and [Quick Start - Implementing Video Call](/real-time-video-flutter/quick-start/implementing-video-call).



## Usage Steps

### 1 Create Media Player

Call the [createMediaPlayer](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoExpressEngineMediaPlayer/createMediaPlayer.html) method of `ZegoExpressEngine` to create a media player instance. A media player instance can only play one audio or video file. The engine supports creating up to 10 player instances at the same time to achieve the effect of playing multiple media resources simultaneously. If there are already 10 player instances, calling the create player interface again will return `null`.


```dart
ZegoMediaPlayer? mediaPlayer = await ZegoExpressEngine.instance.createMediaPlayer();
if (mediaplayer != null) {
    // createMediaPlayer create sucess
} else {
    // createMediaPlayer create fail
}
```

### 2 (Optional) Set Event Callbacks for Player

<Accordion title="Player Event Callback Setup" defaultOpen="false">
Through the media player's [onMediaPlayerStateUpdate](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoExpressEngine/onMediaPlayerStateUpdate.html), [onMediaPlayerNetworkEvent](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoExpressEngine/onMediaPlayerNetworkEvent.html), and [onMediaPlayerPlayingProgress](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoExpressEngine/onMediaPlayerPlayingProgress.html) callbacks to receive notifications of "player playback state changes", "player network state updates", and "player playback progress changes".


```dart
// Player playback state callback
ZegoExpressEngine.onMediaPlayerStateUpdate = (ZegoMediaPlayer mediaPlayer, ZegoMediaPlayerState state, int errorCode) {
    print("onMediaPlayerStateUpdate: state = $state, errorCode = $errorCode, mediaPlayer index = ${mediaPlayer.getIndex()}");
}

// Player network state callback
ZegoExpressEngine.onMediaPlayerNetworkEvent = (ZegoMediaPlayer mediaPlayer, ZegoMediaPlayerNetworkEvent networkEvent) {
    print("onMediaPlayerNetworkEvent: networkEvent = $networkEvent, mediaPlayer index = ${mediaPlayer.getIndex()}");
}

// Player playback progress callback
ZegoExpressEngine.onMediaPlayerPlayingProgress = (ZegoMediaPlayer mediaPlayer, int millisecond) {
     print("onMediaPlayerPlayingProgress: millisecond = $millisecond, mediaPlayer index = ${mediaPlayer.getIndex()}");
}
```
</Accordion>


### 3 Load Media File

<Warning title="Warning">


If the media resource has already been [loaded](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/loadResource.html) or is currently playing, please call the [stop](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/stop.html) method first to stop playback, then call the [loadResource](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/loadResource.html) method to load the media resource, otherwise loading will fail.

</Warning>



Call the media player's [loadResource](https://www.zegocloud.com/docs/article/dart_flutter/zego_express_engine/ZegoMediaPlayer/loadResource.html) to specify the media resource to play. It can be the absolute path of a local resource or the URL of a network resource, such as `http://your.domain.com/your-movie.mp4`. Users can get the result of loading the file through the return value of the function.


```dart
 // Load resource, can pass absolute path of local resource or URL of network resource
zegoMediaplayer.loadResource("sourcePath").then( (ZegoMediaPlayerLoadResourceResult result) {
    if(errorcode == 0){
        // loadResource success
    } else {
        // loadResource errorcode: errorcode
    }
});
```

If users need to load binary audio data, they can call the media player's [loadResourceFromMediaData](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/loadResourceFromMediaData.html) to specify the binary audio data to play. Users can get the result of loading the data through the return value of the function.

```dart
  // Load resource, pass in the binary audio data to be loaded and the starting position
zegoMediaplayer.loadResourceFromMediaData(data, position).then(ZegoMediaPlayerLoadResourceResult result) {
    if(errorcode == 0){
        // loadResourceFromMediaData success
    } else {
        // loadResourceFromMediaData errorcode: errorcode
    }
});
```

### 4 Playback Control

**Playback State Control**

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Common/ZegoExpressEngine/mediaplayer_state_iOS.jpg" /></Frame>

After successfully loading the file by calling [loadResource](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/loadResource.html), you can call [start](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/start.html), [pause](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/pause.html), [resume](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/resume.html), [stop](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/stop.html) to start and stop playback. Once the player's internal state changes, the [onMediaplayerStateUpdate](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoExpressEngine/onMediaPlayerStateUpdate.html) callback will be triggered.

Users can also call [getCurrentState](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/getCurrentState.html) to get the current state of the player at any time.

If [enableRepeat](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/enableRepeat.html) is set to "true", the player will automatically replay after finishing playing the file.

```dart
// Set whether to repeat playback
mediaplayer.enableRepeat(true);
// Start playback, need to call interface to load media file before playing
mediaplayer.start();
 // Pause
mediaplayer.pause();
// Resume
mediaplayer.resume();
// Stop
mediaplayer.stop();
```

**Playback Progress Control**

The progress of playing the file will be called back through the [onMediaPlayerPlayingProgress](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoExpressEngine/onMediaPlayerPlayingProgress.html) method. The default callback interval is 1000 ms, which can be changed through [setProgressInterval](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/setProgressInterval.html).

<Warning title="Warning">


In Web, the [onMediaPlayerPlayingProgress](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoExpressEngine/onMediaPlayerPlayingProgress.html) interface is not currently supported.


</Warning>



Users can also get the current playback progress through [getCurrentProgress](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/getCurrentProgress.html).

Adjust the progress through the [seekTo](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/seekTo.html) interface.


```dart
 // Set playback progress callback interval to 2000 ms
mediaplayer.setProgressInterval(2000);
// Get the player's playback progress, in milliseconds
int progress = await mediaplayer.getCurrentProgress();
// Get the total duration of the currently playing media file, in milliseconds
int totalDuration = await mediaplayer.getTotalDuration();
 // Jump to half of the total duration, progress unit is milliseconds
mediaplayer.seekTo(totalDuration / 2).then(ZegoMediaPlayerSeekToResult result){
    if(errorcode == 0){
        // seekTo success
    } else {
        // seekTo errorcode: errorcode
    }
});
```

**Playback Speed Control**

After loading the resource, users can set the current playback speed through [setPlaySpeed](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/setPlaySpeed.html).


```dart
// Set the player's playback speed, must be called after loading the resource
// Set 2x speed playback, playback speed range is 0.3 ~ 4.0, default is 1.0
mediaplayer.setPlaySpeed(2.0);
```

**Player Audio Control**

Get and control playback volume through [getPlayVolume](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/getPlayVolume.html) and [setPlayVolume](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/setPlayVolume.html).

Get and control publishing volume through [getPublishVolume](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/getPublishVolume.html) and [setPublishVolume](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/setPublishVolume.html).


Call [muteLocal](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/muteLocal.html) to control local mute playback.

Call [enableAux](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/enableAux.html) to mix the file's sound into the stream being published.

<Note title="Note">


If you want to use the audio mixing feature, you must [set microphone permissions](/real-time-video-flutter/quick-start/integrating-sdk#setting-permissions). If you don't want to record microphone sound, you can mute the microphone through [muteMicrophone](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoExpressEngineDevice/muteMicrophone.html).


</Note>



```dart
// Get the player's current playback volume
int playVolume = await mediaplayer.getPlayVolume();
// Set player volume to half of original
mediaplayer.setPlayVolume(playVolume / 2);

// Get the player's current publishing volume
var publishVolume = await  this.mediaPlayer.getPublishVolume();

// Set player publishing volume
mediaPlayer.setPublishVolume(80.0);

// Enable local mute playback
mediaplayer.muteLocal(true);
// Enable mixing the resource's sound into the stream being published
mediaplayer.enableAux(true);
```

**Player Video Control**

When playing video resources, use [setPlayerCanvas](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/setPlayerCanvas.html) to set the video display view.


```dart
// textureView is the id obtained through createTextureRenderer or createPlatformView method
mediaplayer.setPlayerCanvas(ZegoCanvas(textureView));
```


**Voice Changer**

When handling scenarios such as adjusting the pitch of accompaniment in KTV, you can call the media player's [enableVoiceChanger](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/enableVoiceChanger.html) interface to implement voice changing functionality. Developers can set the voice changing effect through the pitch parameter `pitch` in the [ZegoVoiceChangerParam](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoVoiceChangerParam-class.html) object. The value range of this parameter is [-12.0, 12.0]. The larger the value, the sharper the voice. Voice changing is disabled by default.

<Warning title="Warning">


In Web, the [enableVoiceChanger](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/enableVoiceChanger.html) interface is not currently supported.


</Warning>



```dart
/**
 * 8.0  // Male voice to child voice
 * 4.0  // Male voice to female voice
 * 6.0  // Female voice to child voice
 * -3.0 // Female voice to male voice
 */
ZegoVoiceChangerParam param = ZegoVoiceChangerParam(6.0)
mediaplayer.enableVoiceChanger(ZegoMediaPlayerAudioChannel.All, true, param);
```


### 5 Destroy Media Player

After using the player, you need to call the [destroyMediaplayer](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoExpressEngineMediaPlayer/destroyMediaPlayer.html) interface in time to release occupied resources.

```dart
ZegoExpressEngine.instance.destroyMediaPlayer(mediaplayer);
mEngine.destroyMediaPlayer(mediaplayer);
```


## FAQ

**How to switch playback resources during playback?**

  First call the player's [stop](/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/stop.html) interface, then call the [loadResource](https://www.zegocloud.com/docs/unique-api/express-video-sdk/en/dart_flutter/zego_express_engine/ZegoMediaPlayer/loadResource.html) interface again to load the new resource.
