---
articleID: 1152
date: "2024-07-27"
---
# Media Player

- - -

import Content from '/core_products/real-time-voice-video/en/snippets/media-player-pre.mdx'

<Content />

## Sample Source Code Download

Please refer to [Download Sample Source Code](/real-time-video-ios-oc/quick-start/run-example-code) to get the source code.

For related source code, please check the files in the "/ZegoExpressExample/Examples/Others/MediaPlayer" directory.

## Prerequisites

Before implementing the media player feature, please ensure:

- You have created a project in the [ZEGOCLOUD Console](https://console.zego.im) and applied for a valid AppID and AppSign. For details, please refer to [Console - Project Information](/console/project-info).
- You have integrated ZEGO Express SDK in the project and implemented basic audio and video publishing and playing functions. For details, please refer to [Quick Start - Integration](/real-time-video-ios-oc/quick-start/integrating-sdk) and [Quick Start - Implementation Flow](/real-time-video-ios-oc/quick-start/implementing-video-call).


## Usage Steps

### 1 Create media player

Call the [createMediaPlayer](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-express-engine#create-media-player) interface of "ZegoExpressEngine" to create a media player instance. One media player instance can only play one audio or video file. The engine supports creating up to 10 player instances at the same time to achieve the effect of playing multiple media resources simultaneously. If 10 player instances already exist, calling the create player interface again will return `nil`.

- Call example

    ```objc
    ZegoMediaPlayer *mediaPlayer = [[ZegoExpressEngine sharedEngine] createMediaPlayer];

    if (mediaPlayer) {
        self.mediaPlayer = mediaPlayer;
    } else {
        NSLog(@"Failed to create player");
    }
    ```

### 2 (Optional) Set event callback for player

<Accordion title="Set player event callback" defaultOpen="false">
Call the [setEventHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#set-event-handler) interface of the media player to set event callbacks for the player to receive notifications such as "player playback status change", "player network status update", "player playback progress change", etc.

- Call example

    ```objc
    // Here self implements the `ZegoMediaPlayerEventHandler` protocol
    [self.mediaPlayer setEventHandler:self];
    ```

    ```objc
    // Player playback status callback

    // @param mediaPlayer Player instance callback
    // @param state Player status
    // @param errorCode Error code, for details please refer to the common error codes document
    - (void)mediaPlayer:(ZegoMediaPlayer *)mediaPlayer stateUpdate:(ZegoMediaPlayerState)state errorCode:(int)errorCode {
        switch (state) {
            case ZegoMediaPlayerStateNoPlay:
                // Playback stopped status
                break;
            case ZegoMediaPlayerStatePlaying:
                // Playing status
                break;
            case ZegoMediaPlayerStatePausing:
                // Paused status
                break;
            case ZegoMediaPlayerStatePlayEnded:
                // Current track playback completed, operations such as playing the next track can be performed
                break;
        }
    }

    // Player network status callback

    // @param mediaPlayer Player instance callback
    // @param networkEvent Network status event
    - (void)mediaPlayer:(ZegoMediaPlayer *)mediaPlayer networkEvent:(ZegoMediaPlayerNetworkEvent)networkEvent {
        if (networkEvent == ZegoMediaPlayerNetworkEventBufferBegin) {
            // Show Loading UI
        } else if (networkEvent == ZegoMediaPlayerNetworkEventBufferEnded) {
            // Hide Loading UI
        }
    }

    // Player playback progress callback

    // @param mediaPlayer Player instance callback
    // @param millisecond Progress, unit is milliseconds
    - (void)mediaPlayer:(ZegoMediaPlayer *)mediaPlayer playingProgress:(unsigned long long)millisecond {
        // Update progress bar
    }
    ```
</Accordion>

### 3 Load media resources

Call the media player's [loadResource](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#load-resource-callback) to specify the media resource to be played, which can be an absolute path to a local resource or a URL to a network resource, such as `http://your.domain.com/your-movie.mp4`. Users can obtain the result of loading the file by passing in callback parameters.

- Call example

    ```objc
    // This example gets the absolute path of the sample.mp4 file in the App bundle
    NSString *fileURL = [[NSBundle mainBundle] pathForResource:@"sample" ofType:@"mp4"];

     // Load resource, can pass absolute path of local resource or URL of network resource
    [self.mediaPlayer loadResource:fileURL callback:^(int errorCode) {
        // Can perform logic such as updating UI
        if (errorCode == 0) {
             // File loaded successfully, now you can start playing media resources
             // [self.mediaPlayer start];
        }
    }];
    ```

If users need to load binary audio data, they can call the media player's [loadResourceFromMediaData](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~class~zego-media-player&jumpType=route#load-resource-from-media-data-start-position-callback) to specify the binary audio data to be played. Users can obtain the result of loading the data by passing in callback parameters.

- Call example

    ```objc
     //Load resource, pass in the binary audio data to be loaded and the starting position
    [self.mediaPlayer loadResourceFromMediaData:data startPosition:0L callback:^(int errorCode) {
        // Can perform logic such as updating UI
        if (errorCode == 0) {
             // File loaded successfully, now you can start playing media resources
            // [self.mediaPlayer start];
        }
    }];
    ```

<Warning title="Warning">


If the media resource has already been [loadResource](@loadResource-ZegoMediaPlayer) or is currently playing, please call the [stop](@stop-ZegoMediaPlayer) interface first to stop playback, then call the [loadResource](@loadResource-ZegoMediaPlayer) interface to load new media resources, otherwise the loading will fail.
</Warning>

### 4 Playback control

#### Playback status control

After successfully calling [loadResource](@loadResource) to load the file, you can call [start](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#start), [pause](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#pause), [resume](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#resume), [stop](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#stop) to start and stop playback. Once the player's internal state changes, the [stateUpdate](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~protocol~zego-media-player-event-handler#media-player-state-update-error-code) callback of ZegoMediaPlayer will be triggered.

Users can also call [currentState](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#current-state) at any time to get the current status of the player.

If [enableRepeat](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#enable-repeat) is set to "YES", the player will automatically replay after finishing playing the file.


```objc
// Set whether to repeat playback
[self.mediaPlayer enableRepeat:YES];
// Start playing, need to call interface to load media file before playing
[self.mediaPlayer start];
// Pause
[self.mediaPlayer pause];
// Resume
[self.mediaPlayer resume];
// Stop
[self.mediaPlayer stop];
```

Playback status transition diagram:

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Common/ZegoExpressEngine/mediaplayer_state_iOS.jpg" /></Frame>

#### Playback progress control

The progress of playing the file will be called back through the [mediaPlayer:playingProgress](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~protocol~zego-media-player-event-handler#media-player-playing-progress) method. The default interval for triggering callbacks is 1000 ms, which can be changed by [setProgressInterval](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#set-progress-interval).

Users can also get the current playback progress through [currentProgress](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#current-progress).

Playback progress can be adjusted through the [seekTo](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#seek-to-callback) interface.

- Call example

    ```objc
    // Set playback progress callback interval to 1000ms, that is, every 1000 ms will receive one - (void)mediaPlayer:(ZegoMediaPlayer *)mediaPlayer playingProgress:(unsigned long long)millisecond callback
    [self.mediaPlayer setProgressInterval:1000];

    // Get the total duration of the currently playing media file, unit is milliseconds
    unsigned long long totalDuration = self.mediaPlayer.totalDuration;

    // Get the playback progress of the player, unit is milliseconds
    unsigned long long progress = self.mediaPlayer.currentProgress;

    NSLog(@"process: %llu", progress);

    // Seek to half of the total duration, progress unit is milliseconds
    [self.mediaPlayer seekTo:totalDuration/2 callback:^(int errorCode) {
        NSLog(@"errorCode: %d", errorCode);
    }];
    ```

#### Playback speed control

After loading resources is completed, users can set the current playback speed through [setPlaySpeed](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~class~zego-media-player&jumpType=route#set-play-speed).

- Call example

    ```objc
    // Set the playback speed of the player, must be called after loading resources is completed
    // Set 2x speed playback, playback speed range is 0.3 ~ 4.0, default is 1.0
    [self.mediaPlayer setPlaySpeed:2.0];
    ```

#### Player audio control

Get and control playback volume through [playVolume](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#play-volume) and [setPlayVolume](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#set-play-volume).

Get and control publish stream volume through [publishVolume](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#publish-volume) and [setPublishVolume](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#set-publish-volume).

Call [enableAux](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#enable-aux) to mix the sound of the file into the stream being published.

<Note title="Note">


If you want to use the mixing capability, you must [set microphone permissions](/real-time-video-ios-oc/quick-start/integrating-sdk). If you do not want to record microphone sound, you can mute the microphone through [muteMicrophone](@muteMicrophone).
</Note>


Call [muteLocal](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#mute-local) to make local playback silent but still be able to mix sound into the stream normally.

```objc
// Get the current playback volume of the player
int playVolume = self.mediaPlayer.playVolume;

// Set player volume to half of original
[self.mediaPlayer setPlayVolume:playVolume/2];

// Get the current publish stream volume of the player
int publishVolume = [self.mediaPlayer publishVolume];

// Set player publish stream volume
[self.mediaPlayer setPublishVolume:publishVolume];

// Enable mixing the sound of the resource into the stream being published
[self.mediaPlayer enableAux:YES];

// Enable local silent playback
[self.mediaPlayer muteLocal:YES];
```

If you want to get the audio data of the file, you can set the audio frame callback through [setAudioHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#set-audio-handler).


- Call example

    ```objc
    // Here self implements the `ZegoMediaPlayerAudioHandler` protocol and calls the set interface of the player
    [self.mediaPlayer setAudioHandler:self];
    ```

    ```objc
    // Player audio frame data callback
    // @param mediaPlayer Player instance callback
    // @param data Raw data of audio frame
    // @param dataLength Length of data
    // @param param Audio frame parameters
    - (void)mediaPlayer:(ZegoMediaPlayer *)mediaPlayer audioFrameData:(const unsigned char *)data dataLength:(unsigned int)dataLength param:(ZegoAudioFrameParam *)param {
    // Received media player audio data callback
    }
    ```

#### Player video control

When playing video resources, use [setPlayerCanvas](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#set-player-canvas) to set the display view of the video.

- Call example

    ```objc
    // Set playback view
    [self.mediaPlayer setPlayerCanvas:[ZegoCanvas canvasWithView:self.mediaPlayerView]];
    ```

If you want to get the video data of the file, you can set the video frame callback through [setVideoHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#set-video-handler-format-type).

- Interface prototype

    ```objc
    // Set player video data callback, video frame data format and data type you want to receive
    - (void)setVideoHandler:(nullable id<ZegoMediaPlayerVideoHandler>)handler format:(ZegoVideoFrameFormat)format type:(ZegoVideoBufferType)type;
    ```

    ```objc
    @protocol ZegoMediaPlayerVideoHandler <NSObject>

    @optional

    // Player video frame raw data callback
    // @param mediaPlayer Player instance callback
    // @param data Raw data of video frame (e.g.: RGBA only needs to consider data[0], I420 needs to consider data[0,1,2])
    // @param dataLength Length of data (e.g.: RGBA only needs to consider dataLength[0], I420 needs to consider dataLength[0,1,2])
    // @param param Video frame parameters
    - (void)mediaPlayer:(ZegoMediaPlayer *)mediaPlayer videoFrameRawData:(const unsigned char * _Nonnull * _Nonnull)data dataLength:(unsigned int *)dataLength param:(ZegoVideoFrameParam *)param;

    // Player video frame CVPixerBuffer data callback
    // @param mediaPlayer Player instance callback
    // @param buffer Video frame data encapsulated as CVPixerBuffer
    // @param param Video frame parameters
    - (void)mediaPlayer:(ZegoMediaPlayer *)mediaPlayer videoFramePixelBuffer:(CVPixelBufferRef)buffer param:(ZegoVideoFrameParam *)param;

    @end
    ```

- Call example

    ```objc
    // Set video data format to NV12, data type to CVPixelBuffer
    [self.mediaPlayer setVideoHandler:self format:ZegoVideoFrameFormatNV12 type:ZegoVideoBufferTypeCVPixelBuffer];
    ```

    ```objc
    // Player video frame CVPixerBuffer data callback
    // @param mediaPlayer Player instance callback
    // @param buffer Video frame data encapsulated as CVPixerBuffer
    // @param param Video frame parameters
    - (void)mediaPlayer:(ZegoMediaPlayer *)mediaPlayer videoFramePixelBuffer:(CVPixelBufferRef)buffer param:(ZegoVideoFrameParam *)param {
    // NSLog(@"pixel buffer video frame callback. format:%d, width:%f, height:%f", (int)param.format, param.size.width, param.size.height);
    }
    ```

<Warning title="Warning">


When the data type "type" is set to "ZegoVideoBufferTypeCVPixelBuffer", the data format "format" only supports setting to "ZegoVideoFrameFormatI420", "ZegoVideoFrameFormatNV12", "ZegoVideoFrameFormatBGRA32",
"ZegoVideoFrameFormatARGB32"; setting to other unsupported formats will not callback video frame data in the future.

</Warning>


#### Publish stream the video played by the player

1. Before publishing the player's video stream, you need to first set up video frame callback listening through [setVideoHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#set-video-handler-format-type) to get the video frame data thrown by [videoFrameRawData](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~protocol~zego-media-player-video-handler#media-player-video-frame-raw-data-data-length-param) or [videoFramePixelBuffer](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~protocol~zego-media-player-video-handler#media-player-video-frame-pixel-buffer-param).

2. Use custom method to capture video and mix the obtained video data into the stream publishing data. For detailed operations, please refer to [Custom Video Capture](/real-time-video-ios-oc/video/custom-video-capture).

<Note title="Note">

When capturing custom data, it is recommended that developers define a "flag" marker:

- When the [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~protocol~zego-custom-video-capture-handler#on-start) callback is triggered, set the "flag" marker to "True", indicating that you can start sending custom captured video data to the SDK.
- When the [onStop](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~protocol~zego-custom-video-capture-handler#on-stop) callback is triggered, set the "flag" marker to "False", indicating that you need to stop sending captured video data to the SDK.
</Note>

3. Developers need to add judgment logic for "flag" in [videoFrameRawData](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~protocol~zego-media-player-video-handler#media-player-video-frame-raw-data-data-length-param) or [videoFramePixelBuffer](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~protocol~zego-media-player-video-handler#media-player-video-frame-pixel-buffer-param). When "flag" is set to "True" (that is, when the [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~protocol~zego-custom-video-capture-handler#on-start) callback is triggered), call the [sendCustomVideoCapturePixelBuffer](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-express-engine#send-custom-video-capture-pixel-buffer-timestamp) method to send the obtained video data to the SDK.

4. Call [startPublishingStream](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-express-engine#start-publishing-stream) to start publishing stream. Please refer to "Stream Publishing" in [Quick Start - Implementation Flow](/real-time-video-ios-oc/quick-start/implementing-video-call).


#### Voice Changer

To handle scenarios such as changing the pitch of accompaniment in KTV, you can call the media player's [enableVoiceChanger](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~class~zego-express-engine#enable-voice-changer) interface to implement voice changer functionality. Developers can set the voice changer effect through the pitch parameter "pitch" in the [ZegoVoiceChangerParam](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-voice-changer-param) object. The value range of this parameter is [-12.0, 12.0]. The larger the value, the sharper the sound. Voice changer is disabled by default.

```objc
ZegoVoiceChangerParam *param = [[ZegoVoiceChangerParam alloc] init];
// Male voice to child voice
param.pitch = 8.0f;
//Male voice to female voice
param.pitch = 4.0f;
// Female voice to child voice
param.pitch = 6.0f;
// Female voice to male voice
param.pitch = -3.0f;
[self.mediaPlayer enableVoiceChanger:YES param:param audioChannel:ZegoMediaPlayerAudioChannelAll];
```

### 5 Destroy media player

After using the player, you need to set the player instance variable to nil in time to destroy the media player and release occupied resources. Call example:

```objc
self.mediaPlayer = nil;
```

<Note title="Note">

When the reference count of the media player instance object is 0, the player instance will be destroyed and its occupied resources will be released.
</Note>

## FAQ

1. **How to switch playback resources during playback?**

  First call the player's [stop](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#stop) interface, then call the [loadResource](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~ObjectiveC~class~zego-media-player#load-resource-callback) interface again to load new resources.
