---
articleID: 15814
date: "2024-01-15"
---
# CDN Stream Publishing Authentication

- - -

## Overview of Stream Publishing Authentication

To prevent attackers from stealing your publishing stream URL address to use elsewhere, or forging your server to generate publishing stream URL addresses, resulting in traffic loss, you can configure `Stream Publishing Authentication` through the [ZEGO Console](https://console.zego.im/). After enabling authentication, you need to splice relevant authentication parameters in the publishing stream URL address, otherwise you cannot publish streams.

<Warning title="Warning">


- After you configure `Stream Publishing Authentication` from the [ZEGO Console](https://console.zego.im/), please keep **KEY** properly and do not disclose it easily to prevent attackers from obtaining it and causing losses.
- If you are RTC relaying to CDN or stream mixing relaying to CDN, ZEGO servers will automatically generate and splice URL address parameters for you, and you do not need to generate them yourself; if you are publishing streams through a third-party platform, you need to generate and splice relevant parameters yourself.
</Warning>


When using, please refer to the following documents for configuration based on your AppID's main business region.

- If the AppID's main business region is `Mainland China`, please refer to [Tencent Cloud Authentication Description](#tencent-cloud-authentication-description) or [Huawei Cloud Authentication Description](#huawei-cloud-authentication-description).
- If the AppID's main business region is `Hong Kong, Macao, Taiwan, or Overseas`, please refer to [Wangsu Cloud Authentication Description](#wangsu-cloud-authentication-description).



## Tencent Cloud Authentication Description

After enabling `Stream Publishing Authentication`, the complete publishing stream address is as follows:

<Frame width="512" height="auto" caption="">
  <img src="https://doc-media.zego.im/sdk-doc/Pics/Express/authentication_tencent.png" />
</Frame>

Among them, "domain" and "access point" can be obtained at "Console > Project Details > Service Configuration > CDN Service > CDN Related Addresses".

<Frame width="512" height="auto" caption="">
  <img src="https://doc-media.zego.im/sdk-doc/Pics/Express/authentication_console.png" />
</Frame>

### 1 Generate Authentication Key

Please go to the [ZEGO Console](https://console.zego.im/), find `Authentication Configuration` in your "Project Configuration > Service Configuration", enable it, and configure or automatically generate the publishing stream authentication KEY in the pop-up dialog.

Among them, the primary KEY is required and the backup KEY is optional. **We recommend that you configure both the primary KEY and the backup KEY. If the primary KEY is leaked, you can smoothly switch to the backup KEY without affecting your business use.**

<Frame width="512" height="auto" caption="">
  <img src="https://doc-media.zego.im/sdk-doc/Pics/Express/authentication_tencent_1.png" />
</Frame>

### 2 Generate txTime

txTime refers to the validity period of the publishing stream URL address.

For example, if the current time is 2018-12-29 11:13:45 and you expect the newly generated URL to expire after 3 hours, then:

1. txTime can be set to 2018-12-29 14:13:45.
2. Then convert the time to Unix timestamp format (i.e., 1546064025).
3. Then convert to hexadecimal to further compress the character length, getting txTime = 5c271099 (hexadecimal).

### 3 Generate txSecret

The generation method of txSecret is `txSecret = MD5(KEY + StreamName + txTime)`.

Where:

- KEY: refers to the encryption KEY you configured in [Generate Authentication Key](#1-generate-authentication-key).
- StreamName: stream name, user-defined, used to identify the live stream.
- txTime: refers to the txTime you generated in [Generate txTime](#2-generate-txtime).
- MD5: standard MD5 one-way irreversible hash algorithm.

### 4 Get URL Address

After completing the above steps, the final address is as follows (example address, this address is only for format reference, please do not use directly online):

```url
rtmp://push-tencent1.zego.im/live/123?txSecret=235cec79bf9483439762ddfd491387e2&txTime=5c271099
```


## Wangsu Cloud Authentication Description

After enabling `Stream Publishing Authentication`, the complete publishing stream address is as follows:

<Frame width="512" height="auto" caption="">
  <img src="https://doc-media.zego.im/sdk-doc/Pics/Express/authentication_ws.png" />
</Frame>

Among them, "domain" and "access point" can be obtained at "Console > Project Details > Service Configuration > CDN Service > CDN Related Addresses".

<Frame width="512" height="auto" caption="">
  <img src="https://doc-media.zego.im/sdk-doc/Pics/Express/authentication_console.png" />
</Frame>

### 1 Generate Authentication Key

Please go to the [ZEGO Console](https://console.zego.im/), find `Authentication Configuration` in your "Project Configuration > Service Configuration", enable it, and configure or automatically generate the publishing stream authentication KEY in the pop-up dialog.

Among them, the primary KEY is required and the backup KEY is optional. **We recommend that you configure both the primary KEY and the backup KEY. If the primary KEY is leaked, you can smoothly switch to the backup KEY without affecting your business use.**

<Frame width="512" height="auto" caption="">
  <img src="https://doc-media.zego.im/sdk-doc/Pics/Express/authentication_tencent_1.png" />
</Frame>

### 2 Generate wsABStime

wsABStime refers to the validity period of the publishing stream URL address.

For example, if the current time is 2018-12-29 11:13:45 and you expect the newly generated URL to expire after 3 hours, then:

1. wsABStime can be set to 2018-12-29 14:13:45.
2. Then convert the time to Unix timestamp format (i.e., 1546064025).
3. Then convert to hexadecimal to further compress the character length, getting wsABStime = 5C271099 (hexadecimal).

### 3 Generate wsSecret

The generation method of wsSecret is `wsSecret = MD5(wsABStime + StreamName + KEY)`.

Where:

- wsABStime: refers to the wsABStime you generated in [Generate wsABStime](#2-generate-wsabstime), such as 5C271099.
- StreamName: path, format is "/access point/streamID", such as /live/streamid123.
- KEY: refers to the encryption KEY you configured in [Generate Authentication Key](#1-generate-authentication-key), such as KEY123.
- MD5: standard MD5 one-way irreversible hash algorithm.

That is, wsSecret = MD5(5C271099/live/streamid123KEY123)

### 4 Get URL Address

After completing the above steps, the final address is as follows (example address, this address is only for format reference, please do not use directly online):

```url
rtmp://push-ws1.zego.im/live/123?wsSecret=235cec79bf9483439762ddfd491387e2&wsABStime=5C271099
```


## Huawei Cloud Authentication Description

After enabling `Stream Publishing Authentication`, the complete publishing stream address is as follows:

<Frame width="512" height="auto" caption="">
  <img src="https://doc-media.zego.im/sdk-doc/Pics/Express/authentication_huawei.png" />
</Frame>

Among them, "domain" and "access point" can be obtained at "Console > Project Details > Service Configuration > CDN Service > CDN Related Addresses".

### 1 Obtain Authentication Key

Please contact ZEGOCLOUD Technical Support to configure relevant permissions for Huawei Cloud CDN publishing stream authentication and obtain the authentication key.

### 2 Generate hwTime

hwTime refers to the validity period of the publishing stream URL address.

For example, if the current time is 2018-12-29 11:13:45 and you expect the newly generated URL to expire after 3 hours, then:

1. hwTime can be set to 2018-12-29 14:13:45.
2. Then convert the time to Unix timestamp format (i.e., 1546064025).
3. Then convert to hexadecimal to further compress the character length, getting hwTime = 5c271099 (hexadecimal).

### 3 Generate hwSecret

The generation method of hwSecret is `hwSecret = hmac_sha256（KEY, StreamName + hwTime）`.

Where:

- KEY: refers to the authentication key you obtained in [Obtain Authentication Key](#1-obtain-authentication-key).
- StreamName: stream name, user-defined, used to identify the live stream.
- hwTime: refers to the hwTime you generated in [Generate hwTime](#2-generate-hwtime).
- hmac_sha256: HMAC-SHA256 encryption algorithm.

### 4 Get URL Address

After completing the above steps, the final address is as follows (example address, this address is only for format reference, please do not use directly online):

```url
rtmp://push-huawei1.zego.im/live/123?hwSecret=ce201856a0957413319e883c8ccae13602f01d3d91e21daf5161964cf708a6a8&hwTime=5c271099
```

## Sample Code for Generating Authentication Parameters

The following is the unified authentication parameter generation sample code supporting three providers (Tencent Cloud, Wangsu Cloud, Huawei Cloud):

<CodeGroup>

```go Go
package main

import (
    "crypto/hmac"
    "crypto/md5"
    "crypto/sha256"
    "fmt"
    "time"
)

// AuthResult Authentication result
type AuthResult struct {
    Secret string // Authentication key
    Time   string // Time parameter
    URL    string // Complete publishing stream URL
}

// GenerateCDNAuth Generate CDN authentication parameters
func GenerateCDNAuth(provider, key, streamName string, expireHours int) (*AuthResult, error) {
    // 1. Generate expiration timestamp (hexadecimal)
    expireTime := time.Now().Add(time.Duration(expireHours) * time.Hour).Unix()
    timeHex := fmt.Sprintf("%x", expireTime)

    var secret, timeParam, url string

    switch provider {
    case "tencent":
        // Tencent Cloud: txSecret = MD5(KEY + StreamName + txTime)
        data := key + streamName + timeHex
        hash := md5.Sum([]byte(data))
        secret = fmt.Sprintf("%x", hash)
        timeParam = timeHex
        url = fmt.Sprintf("rtmp://push-tencent1.zego.im/live/%s?txSecret=%s&txTime=%s",
            streamName, secret, timeParam)

    case "wangsu":
        // Wangsu Cloud stream name needs to include access point /live/ prefix
        // Wangsu Cloud: wsSecret = MD5(wsABStime + StreamName + KEY)
        timeParam = strings.ToUpper(timeHex)
        data := timeParam + "/live/" + streamName + key
        hash := md5.Sum([]byte(data))
        secret = fmt.Sprintf("%x", hash)
        url = fmt.Sprintf("rtmp://push-ws1.zego.im/live/%s?wsSecret=%s&wsABStime=%s",
            streamName, secret, timeParam)

    case "huawei":
        // Huawei Cloud: hwSecret = hmac_sha256(KEY, StreamName + hwTime)
        data := streamName + timeHex
        h := hmac.New(sha256.New, []byte(key))
        h.Write([]byte(data))
        secret = fmt.Sprintf("%x", h.Sum(nil))
        timeParam = timeHex
        url = fmt.Sprintf("rtmp://push-huawei1.zego.im/live/%s?hwSecret=%s&hwTime=%s",
            streamName, secret, timeParam)

    default:
        return nil, fmt.Errorf("Unsupported provider: %s", provider)
    }

    return &AuthResult{
        Secret: secret,
        Time:   timeParam,
        URL:    url,
    }, nil
}

func main() {
    // Example parameters
    key := "your_auth_key"           // Authentication key
    streamName := "123"              // Stream name
    expireHours := 3                 // Expire after 3 hours

    // Generate Tencent Cloud authentication
    if result, err := GenerateCDNAuth("tencent", key, streamName, expireHours); err == nil {
        fmt.Printf("Tencent Cloud - Secret: %s, Time: %s\n", result.Secret, result.Time)
        fmt.Printf("Tencent Cloud - URL: %s\n\n", result.URL)
    }

    // Generate Wangsu Cloud authentication
    if result, err := GenerateCDNAuth("wangsu", key, streamName, expireHours); err == nil {
        fmt.Printf("Wangsu Cloud - Secret: %s, Time: %s\n", result.Secret, result.Time)
        fmt.Printf("Wangsu Cloud - URL: %s\n\n", result.URL)
    }

    // Generate Huawei Cloud authentication
    if result, err := GenerateCDNAuth("huawei", key, streamName, expireHours); err == nil {
        fmt.Printf("Huawei Cloud - Secret: %s, Time: %s\n", result.Secret, result.Time)
        fmt.Printf("Huawei Cloud - URL: %s\n", result.URL)
    }
}
```

```java Java
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import java.security.MessageDigest;

public class CDNAuth {

    // Authentication result class
    public static class AuthResult {
        private String secret;  // Authentication key
        private String time;    // Time parameter
        private String url;     // Complete publishing stream URL

        public AuthResult(String secret, String time, String url) {
            this.secret = secret;
            this.time = time;
            this.url = url;
        }

        // Getters
        public String getSecret() { return secret; }
        public String getTime() { return time; }
        public String getUrl() { return url; }
    }

    /**
     * Generate CDN authentication parameters
     * @param provider Provider type ("tencent", "wangsu", "huawei")
     * @param key Authentication key
     * @param streamName Stream name
     * @param expireHours Expiration hours
     * @return Authentication result
     */
    public static AuthResult generateCDNAuth(String provider, String key, String streamName,
                                           int expireHours) throws Exception {
        // 1. Generate expiration timestamp (hexadecimal)
        long expireTime = System.currentTimeMillis() / 1000 + expireHours * 3600;
        String timeHex = Long.toHexString(expireTime);

        String secret, timeParam, url;

        switch (provider) {
            case "tencent":
                // Tencent Cloud: txSecret = MD5(KEY + StreamName + txTime)
                String data1 = key + streamName + timeHex;
                secret = md5Hash(data1);
                timeParam = timeHex;
                url = String.format("rtmp://push-tencent1.zego.im/live/%s?txSecret=%s&txTime=%s",
                    streamName, secret, timeParam);
                break;

            case "wangsu":
                // Wangsu Cloud stream name needs to include /live/ prefix
                // Wangsu Cloud: wsSecret = MD5(wsABStime + StreamName + KEY)
                timeParam = timeHex.toUpperCase();
                String data2 = timeParam + "/live/" + streamName + key;
                secret = md5Hash(data2);
                url = String.format("rtmp://push-ws1.zego.im/live/%s?wsSecret=%s&wsABStime=%s",
                    streamName, secret, timeParam);
                break;

            case "huawei":
                // Huawei Cloud: hwSecret = hmac_sha256(KEY, StreamName + hwTime)
                String data3 = streamName + timeHex;
                secret = hmacSha256(key, data3);
                timeParam = timeHex;
                url = String.format("rtmp://push-huawei1.zego.im/live/%s?hwSecret=%s&hwTime=%s",
                    streamName, secret, timeParam);
                break;

            default:
                throw new IllegalArgumentException("Unsupported provider: " + provider);
        }

        return new AuthResult(secret, timeParam, url);
    }

    // MD5 hash
    private static String md5Hash(String input) throws Exception {
        MessageDigest md = MessageDigest.getInstance("MD5");
        byte[] hash = md.digest(input.getBytes());
        StringBuilder result = new StringBuilder();
        for (byte b : hash) {
            result.append(String.format("%02x", b));
        }
        return result.toString();
    }

    // HMAC-SHA256
    private static String hmacSha256(String key, String data) throws Exception {
        Mac mac = Mac.getInstance("HmacSHA256");
        SecretKeySpec secretKeySpec = new SecretKeySpec(key.getBytes(), "HmacSHA256");
        mac.init(secretKeySpec);
        byte[] hash = mac.doFinal(data.getBytes());
        StringBuilder result = new StringBuilder();
        for (byte b : hash) {
            result.append(String.format("%02x", b));
        }
        return result.toString();
    }

    public static void main(String[] args) {
        try {
            // Example parameters
            String key = "your_auth_key";        // Authentication key
            String streamName = "123";           // Stream name
            int expireHours = 3;                 // Expire after 3 hours

            // Generate Tencent Cloud authentication
            AuthResult tencentResult = generateCDNAuth("tencent", key, streamName, expireHours);
            System.out.println("Tencent Cloud - Secret: " + tencentResult.getSecret() + ", Time: " + tencentResult.getTime());
            System.out.println("Tencent Cloud - URL: " + tencentResult.getUrl() + "\n");

            // Generate Wangsu Cloud authentication
            AuthResult wangsuResult = generateCDNAuth("wangsu", key, streamName, expireHours);
            System.out.println("Wangsu Cloud - Secret: " + wangsuResult.getSecret() + ", Time: " + wangsuResult.getTime());
            System.out.println("Wangsu Cloud - URL: " + wangsuResult.getUrl() + "\n");

            // Generate Huawei Cloud authentication
            AuthResult huaweiResult = generateCDNAuth("huawei", key, streamName, expireHours);
            System.out.println("Huawei Cloud - Secret: " + huaweiResult.getSecret() + ", Time: " + huaweiResult.getTime());
            System.out.println("Huawei Cloud - URL: " + huaweiResult.getUrl());

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

```javascript NodeJS
const crypto = require('crypto');

/**
 * Generate CDN authentication parameters
 * @param {string} provider Provider type ("tencent", "wangsu", "huawei")
 * @param {string} key Authentication key
 * @param {string} streamName Stream name
 * @param {number} expireHours Expiration hours
 * @returns {Object} {secret, time, url}
 */
function generateCDNAuth(provider, key, streamName, expireHours) {
    // 1. Generate expiration timestamp (hexadecimal)
    const expireTime = Math.floor(Date.now() / 1000) + expireHours * 3600;
    const timeHex = expireTime.toString(16);

    let secret, timeParam, url;

    switch (provider) {
        case 'tencent':
            // Tencent Cloud: txSecret = MD5(KEY + StreamName + txTime)
            const data1 = key + streamName + timeHex;
            secret = crypto.createHash('md5').update(data1).digest('hex');
            timeParam = timeHex;
            url = `rtmp://push-tencent1.zego.im/live/${streamName}?txSecret=${secret}&txTime=${timeParam}`;
            break;

        case 'wangsu':
            // Wangsu Cloud stream name needs to include /live/ prefix
            // Wangsu Cloud: wsSecret = MD5(wsABStime + StreamName + KEY)
            timeParam = timeHex.toUpperCase();
            const data2 = timeParam + "/live/" + streamName + key;
            secret = crypto.createHash('md5').update(data2).digest('hex');
            url = `rtmp://push-ws1.zego.im/live/${streamName}?wsSecret=${secret}&wsABStime=${timeParam}`;
            break;

        case 'huawei':
            // Huawei Cloud: hwSecret = hmac_sha256(KEY, StreamName + hwTime)
            const data3 = streamName + timeHex;
            secret = crypto.createHmac('sha256', key).update(data3).digest('hex');
            timeParam = timeHex;
            url = `rtmp://push-huawei1.zego.im/live/${streamName}?hwSecret=${secret}&hwTime=${timeParam}`;
            break;

        default:
            throw new Error(`Unsupported provider: ${provider}`);
    }

    return {
        secret: secret,
        time: timeParam,
        url: url
    };
}

// Example usage
const key = 'your_auth_key';        // Authentication key
const streamName = '123';           // Stream name
const expireHours = 3;              // Expire after 3 hours

try {
    // Generate Tencent Cloud authentication
    const tencentResult = generateCDNAuth('tencent', key, streamName, expireHours);
    console.log(`Tencent Cloud - Secret: ${tencentResult.secret}, Time: ${tencentResult.time}`);
    console.log(`Tencent Cloud - URL: ${tencentResult.url}\n`);

    // Generate Wangsu Cloud authentication
    const wangsuResult = generateCDNAuth('wangsu', key, streamName, expireHours);
    console.log(`Wangsu Cloud - Secret: ${wangsuResult.secret}, Time: ${wangsuResult.time}`);
    console.log(`Wangsu Cloud - URL: ${wangsuResult.url}\n`);

    // Generate Huawei Cloud authentication
    const huaweiResult = generateCDNAuth('huawei', key, streamName, expireHours);
    console.log(`Huawei Cloud - Secret: ${huaweiResult.secret}, Time: ${huaweiResult.time}`);
    console.log(`Huawei Cloud - URL: ${huaweiResult.url}`);

} catch (error) {
    console.error('Failed to generate authentication parameters:', error.message);
}
```

```python Python
import hashlib
import hmac
import time
from typing import Dict, Any

def generate_cdn_auth(provider: str, key: str, stream_name: str,
                     expire_hours: int = 3) -> Dict[str, Any]:
    """
    Generate CDN authentication parameters

    Args:
        provider: Provider type ("tencent", "wangsu", "huawei")
        key: Authentication key
        stream_name: Stream name
        expire_hours: Expiration hours

    Returns:
        dict: {secret, time, url}
    """
    # 1. Generate expiration timestamp (hexadecimal)
    expire_time = int(time.time()) + expire_hours * 3600
    time_hex = hex(expire_time)[2:]  # Remove '0x' prefix

    if provider == "tencent":
        # Tencent Cloud: txSecret = MD5(KEY + StreamName + txTime)
        data = key + stream_name + time_hex
        secret = hashlib.md5(data.encode('utf-8')).hexdigest()
        time_param = time_hex
        url = f"rtmp://push-tencent1.zego.im/live/{stream_name}?txSecret={secret}&txTime={time_param}"

    elif provider == "wangsu":
        # Wangsu Cloud stream name needs to include /live/ prefix
        # Wangsu Cloud: wsSecret = MD5(wsABStime + StreamName + KEY)
        time_param = time_hex.upper()
        data = time_param + "/live/" + stream_name + key
        secret = hashlib.md5(data.encode('utf-8')).hexdigest()
        url = f"rtmp://push-ws1.zego.im/live/{stream_name}?wsSecret={secret}&wsABStime={time_param}"

    elif provider == "huawei":
        # Huawei Cloud: hwSecret = hmac_sha256(KEY, StreamName + hwTime)
        data = stream_name + time_hex
        secret = hmac.new(key.encode('utf-8'), data.encode('utf-8'), hashlib.sha256).hexdigest()
        time_param = time_hex
        url = f"rtmp://push-huawei1.zego.im/live/{stream_name}?hwSecret={secret}&hwTime={time_param}"

    else:
        raise ValueError(f"Unsupported provider: {provider}")

    return {
        "secret": secret,
        "time": time_param,
        "url": url
    }

# Example usage
if __name__ == "__main__":
    # Example parameters
    key = "your_auth_key"           # Authentication key
    stream_name = "123"             # Stream name
    expire_hours = 3                # Expire after 3 hours

    try:
        # Generate Tencent Cloud authentication
        tencent_result = generate_cdn_auth("tencent", key, stream_name, expire_hours)
        print(f"Tencent Cloud - Secret: {tencent_result['secret']}, Time: {tencent_result['time']}")
        print(f"Tencent Cloud - URL: {tencent_result['url']}\n")

        # Generate Wangsu Cloud authentication
        wangsu_result = generate_cdn_auth("wangsu", key, stream_name, expire_hours)
        print(f"Wangsu Cloud - Secret: {wangsu_result['secret']}, Time: {wangsu_result['time']}")
        print(f"Wangsu Cloud - URL: {wangsu_result['url']}\n")

        # Generate Huawei Cloud authentication
        huawei_result = generate_cdn_auth("huawei", key, stream_name, expire_hours)
        print(f"Huawei Cloud - Secret: {huawei_result['secret']}, Time: {huawei_result['time']}")
        print(f"Huawei Cloud - URL: {huawei_result['url']}")

    except Exception as e:
        print(f"Failed to generate authentication parameters: {e}")
```

```php PHP
<?php

/**
 * Generate CDN authentication parameters
 *
 * @param string $provider Provider type ("tencent", "wangsu", "huawei")
 * @param string $key Authentication key
 * @param string $streamName Stream name
 * @param int $expireHours Expiration hours
 * @return array ['secret' => string, 'time' => string, 'url' => string]
 */
function generateCDNAuth($provider, $key, $streamName, $expireHours = 3) {
    // 1. Generate expiration timestamp (hexadecimal)
    $expireTime = time() + $expireHours * 3600;
    $timeHex = dechex($expireTime);

    switch ($provider) {
        case 'tencent':
            // Tencent Cloud: txSecret = MD5(KEY + StreamName + txTime)
            $data = $key . $streamName . $timeHex;
            $secret = md5($data);
            $timeParam = $timeHex;
            $url = "rtmp://push-tencent1.zego.im/live/{$streamName}?txSecret={$secret}&txTime={$timeParam}";
            break;

        case 'wangsu':
            // Wangsu Cloud stream name needs to include /live/ prefix
            // Wangsu Cloud: wsSecret = MD5(wsABStime + StreamName + KEY)
            $timeParam = strtoupper($timeHex);
            $data = $timeParam . "/live/" . $streamName . $key;
            $secret = md5($data);
            $url = "rtmp://push-ws1.zego.im/live/{$streamName}?wsSecret={$secret}&wsABStime={$timeParam}";
            break;

        case 'huawei':
            // Huawei Cloud: hwSecret = hmac_sha256(KEY, StreamName + hwTime)
            $data = $streamName . $timeHex;
            $secret = hash_hmac('sha256', $data, $key);
            $timeParam = $timeHex;
            $url = "rtmp://push-huawei1.zego.im/live/{$streamName}?hwSecret={$secret}&hwTime={$timeParam}";
            break;

        default:
            throw new InvalidArgumentException("Unsupported provider: {$provider}");
    }

    return [
        'secret' => $secret,
        'time' => $timeParam,
        'url' => $url
    ];
}

// Example usage
try {
    // Example parameters
    $key = 'your_auth_key';        // Authentication key
    $streamName = '123';           // Stream name
    $expireHours = 3;              // Expire after 3 hours

    // Generate Tencent Cloud authentication
    $tencentResult = generateCDNAuth('tencent', $key, $streamName, $expireHours);
    echo "Tencent Cloud - Secret: {$tencentResult['secret']}, Time: {$tencentResult['time']}\n";
    echo "Tencent Cloud - URL: {$tencentResult['url']}\n\n";

    // Generate Wangsu Cloud authentication
    $wangsuResult = generateCDNAuth('wangsu', $key, $streamName, $expireHours);
    echo "Wangsu Cloud - Secret: {$wangsuResult['secret']}, Time: {$wangsuResult['time']}\n";
    echo "Wangsu Cloud - URL: {$wangsuResult['url']}\n\n";

    // Generate Huawei Cloud authentication
    $huaweiResult = generateCDNAuth('huawei', $key, $streamName, $expireHours);
    echo "Huawei Cloud - Secret: {$huaweiResult['secret']}, Time: {$huaweiResult['time']}\n";
    echo "Huawei Cloud - URL: {$huaweiResult['url']}\n";

} catch (Exception $e) {
    echo "Failed to generate authentication parameters: " . $e->getMessage() . "\n";
}

?>
```

```cpp C++
#include <iostream>
#include <string>
#include <sstream>
#include <iomanip>
#include <ctime>
#include <stdexcept>
#include <openssl/md5.h>
#include <openssl/hmac.h>
#include <openssl/sha.h>

// Authentication result structure
struct AuthResult {
    std::string secret;  // Authentication key
    std::string time;    // Time parameter
    std::string url;     // Complete publishing stream URL

    AuthResult(const std::string& s, const std::string& t, const std::string& u)
        : secret(s), time(t), url(u) {}
};

class CDNAuth {
public:
    /**
     * Generate CDN authentication parameters
     * @param provider Provider type ("tencent", "wangsu", "huawei")
     * @param key Authentication key
     * @param streamName Stream name
     * @param expireHours Expiration hours
     * @return Authentication result
     */
    static AuthResult generateCDNAuth(const std::string& provider, const std::string& key,
                                    const std::string& streamName, int expireHours = 3) {
        // 1. Generate expiration timestamp (hexadecimal)
        time_t expireTime = time(nullptr) + expireHours * 3600;
        std::stringstream ss;
        ss << std::hex << expireTime;
        std::string timeHex = ss.str();

        std::string secret, timeParam, url;

        if (provider == "tencent") {
            // Tencent Cloud: txSecret = MD5(KEY + StreamName + txTime)
            std::string data = key + streamName + timeHex;
            secret = md5Hash(data);
            timeParam = timeHex;
            url = "rtmp://push-tencent1.zego.im/live/" + streamName +
                  "?txSecret=" + secret + "&txTime=" + timeParam;

        } else if (provider == "wangsu") {
            // Wangsu Cloud stream name needs to include /live/ prefix
            // Wangsu Cloud: wsSecret = MD5(wsABStime + StreamName + KEY)
            timeParam = toUpperCase(timeHex);
            std::string data = timeParam + "/live/" + streamName + key;
            secret = md5Hash(data);
            url = "rtmp://push-ws1.zego.im/live/" + streamName +
                  "?wsSecret=" + secret + "&wsABStime=" + timeParam;

        } else if (provider == "huawei") {
            // Huawei Cloud: hwSecret = hmac_sha256(KEY, StreamName + hwTime)
            std::string data = streamName + timeHex;
            secret = hmacSha256(key, data);
            timeParam = timeHex;
            url = "rtmp://push-huawei1.zego.im/live/" + streamName +
                  "?hwSecret=" + secret + "&hwTime=" + timeParam;

        } else {
            throw std::invalid_argument("Unsupported provider: " + provider);
        }

        return AuthResult(secret, timeParam, url);
    }

private:
    // MD5 hash
    static std::string md5Hash(const std::string& input) {
        unsigned char digest[MD5_DIGEST_LENGTH];
        MD5((unsigned char*)input.c_str(), input.length(), digest);

        std::stringstream ss;
        for (int i = 0; i < MD5_DIGEST_LENGTH; i++) {
            ss << std::hex << std::setw(2) << std::setfill('0') << (int)digest[i];
        }
        return ss.str();
    }

    // HMAC-SHA256
    static std::string hmacSha256(const std::string& key, const std::string& data) {
        unsigned char hash[SHA256_DIGEST_LENGTH];
        unsigned int hashLen;

        HMAC(EVP_sha256(), key.c_str(), key.length(),
             (unsigned char*)data.c_str(), data.length(), hash, &hashLen);

        std::stringstream ss;
        for (unsigned int i = 0; i < hashLen; i++) {
            ss << std::hex << std::setw(2) << std::setfill('0') << (int)hash[i];
        }
        return ss.str();
    }
};

int main() {
    try {
        // Example parameters
        std::string key = "your_auth_key";        // Authentication key
        std::string streamName = "123";           // Stream name
        int expireHours = 3;                      // Expire after 3 hours

        // Generate Tencent Cloud authentication
        auto tencentResult = CDNAuth::generateCDNAuth("tencent", key, streamName, expireHours);
        std::cout << "Tencent Cloud - Secret: " << tencentResult.secret << ", Time: " << tencentResult.time << std::endl;
        std::cout << "Tencent Cloud - URL: " << tencentResult.url << std::endl << std::endl;

        // Generate Wangsu Cloud authentication
        auto wangsuResult = CDNAuth::generateCDNAuth("wangsu", key, streamName, expireHours);
        std::cout << "Wangsu Cloud - Secret: " << wangsuResult.secret << ", Time: " << wangsuResult.time << std::endl;
        std::cout << "Wangsu Cloud - URL: " << wangsuResult.url << std::endl << std::endl;

        // Generate Huawei Cloud authentication
        auto huaweiResult = CDNAuth::generateCDNAuth("huawei", key, streamName, expireHours);
        std::cout << "Huawei Cloud - Secret: " << huaweiResult.secret << ", Time: " << huaweiResult.time << std::endl;
        std::cout << "Huawei Cloud - URL: " << huaweiResult.url << std::endl;

    } catch (const std::exception& e) {
        std::cerr << "Failed to generate authentication parameters: " << e.what() << std::endl;
    }

    return 0;
}
```

```csharp .NET
using System;
using System.Security.Cryptography;
using System.Text;

public class AuthResult
{
    public string Secret { get; set; }  // Authentication key
    public string Time { get; set; }    // Time parameter
    public string Url { get; set; }     // Complete publishing stream URL

    public AuthResult(string secret, string time, string url)
    {
        Secret = secret;
        Time = time;
        Url = url;
    }
}

public class CDNAuth
{
    /// <summary>
    /// Generate CDN authentication parameters
    /// </summary>
    /// <param name="provider">Provider type ("tencent", "wangsu", "huawei")</param>
    /// <param name="key">Authentication key</param>
    /// <param name="streamName">Stream name</param>
    /// <param name="expireHours">Expiration hours</param>
    /// <returns>Authentication result</returns>
    public static AuthResult GenerateCDNAuth(string provider, string key, string streamName,
                                           int expireHours = 3)
    {
        // 1. Generate expiration timestamp (hexadecimal)
        var expireTime = DateTimeOffset.UtcNow.AddHours(expireHours).ToUnixTimeSeconds();
        var timeHex = expireTime.ToString("x");

        string secret, timeParam, url;

        switch (provider)
        {
            case "tencent":
                // Tencent Cloud: txSecret = MD5(KEY + StreamName + txTime)
                var data1 = key + streamName + timeHex;
                secret = ComputeMD5Hash(data1);
                timeParam = timeHex;
                url = $"rtmp://push-tencent1.zego.im/live/{streamName}?txSecret={secret}&txTime={timeParam}";
                break;

            case "wangsu":
                // Wangsu Cloud stream name needs to include /live/ prefix
                // Wangsu Cloud: wsSecret = MD5(wsABStime + StreamName + KEY)
                timeParam = timeHex.ToUpper();
                var data2 = timeParam + "/live/" + streamName + key;
                secret = ComputeMD5Hash(data2);
                url = $"rtmp://push-ws1.zego.im/live/{streamName}?wsSecret={secret}&wsABStime={timeParam}";
                break;

            case "huawei":
                // Huawei Cloud: hwSecret = hmac_sha256(KEY, StreamName + hwTime)
                var data3 = streamName + timeHex;
                secret = ComputeHmacSha256(key, data3);
                timeParam = timeHex;
                url = $"rtmp://push-huawei1.zego.im/live/{streamName}?hwSecret={secret}&hwTime={timeParam}";
                break;

            default:
                throw new ArgumentException($"Unsupported provider: {provider}");
        }

        return new AuthResult(secret, timeParam, url);
    }

    // MD5 hash
    private static string ComputeMD5Hash(string input)
    {
        using var md5 = MD5.Create();
        var inputBytes = Encoding.UTF8.GetBytes(input);
        var hashBytes = md5.ComputeHash(inputBytes);

        var sb = new StringBuilder();
        foreach (var b in hashBytes)
        {
            sb.Append(b.ToString("x2"));
        }
        return sb.ToString();
    }

    // HMAC-SHA256
    private static string ComputeHmacSha256(string key, string data)
    {
        using var hmac = new HMACSHA256(Encoding.UTF8.GetBytes(key));
        var hashBytes = hmac.ComputeHash(Encoding.UTF8.GetBytes(data));

        var sb = new StringBuilder();
        foreach (var b in hashBytes)
        {
            sb.Append(b.ToString("x2"));
        }
        return sb.ToString();
    }

    public static void Main()
    {
        try
        {
            // Example parameters
            var key = "your_auth_key";        // Authentication key
            var streamName = "123";           // Stream name
            var expireHours = 3;              // Expire after 3 hours

            // Generate Tencent Cloud authentication
            var tencentResult = GenerateCDNAuth("tencent", key, streamName, expireHours);
            Console.WriteLine($"Tencent Cloud - Secret: {tencentResult.Secret}, Time: {tencentResult.Time}");
            Console.WriteLine($"Tencent Cloud - URL: {tencentResult.Url}\n");

            // Generate Wangsu Cloud authentication
            var wangsuResult = GenerateCDNAuth("wangsu", key, streamName, expireHours);
            Console.WriteLine($"Wangsu Cloud - Secret: {wangsuResult.Secret}, Time: {wangsuResult.Time}");
            Console.WriteLine($"Wangsu Cloud - URL: {wangsuResult.Url}\n");

            // Generate Huawei Cloud authentication
            var huaweiResult = GenerateCDNAuth("huawei", key, streamName, expireHours);
            Console.WriteLine($"Huawei Cloud - Secret: {huaweiResult.Secret}, Time: {huaweiResult.Time}");
            Console.WriteLine($"Huawei Cloud - URL: {huaweiResult.Url}");

        }
        catch (Exception e)
        {
            Console.WriteLine($"Failed to generate authentication parameters: {e.Message}");
        }
    }
}
```

</CodeGroup>
