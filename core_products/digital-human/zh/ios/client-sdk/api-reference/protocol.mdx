# Protocol

## ZegoDigitalMobileDelegate

*Declared in `IZegoDigitalMobile.h`*

### 方法
<ParamField
  name="onDigitalMobileStartSuccess"
  prototype="- (void)onDigitalMobileStartSuccess;"
  desc="数字人创建成功回调。"
  parent_file="Declared in \`IZegoDigitalMobile.h\`"
  parent_name="ZegoDigitalMobileDelegate"
  parent_type="class">
**详情**

当数字人SDK成功启动并准备就绪时触发此回调。

<Note title="">
- **通知时机**：数字人SDK成功启动并准备就绪时触发。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：无。
- **注意事项**：无。
</Warning>
</ParamField>

<ParamField
  name="onError:errorMsg:"
  prototype="- (void)onError:(int)errorCode errorMsg:(NSString *)errorMsg;"
  desc="错误回调。"
  parent_file="Declared in \`IZegoDigitalMobile.h\`"
  parent_name="ZegoDigitalMobileDelegate"
  parent_type="class">
**参数**

| 名称 | 类型 | 描述 |
| --- | --- | --- |
| errorCode | int | 错误码，用于标识具体的错误类型。 |
| errorMsg | NSString * | 错误信息描述，提供详细的错误说明。 |

**详情**

当数字人SDK运行过程中发生错误时触发此回调。

<Note title="">
- **通知时机**：数字人SDK运行过程中发生错误时触发。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：无。
- **注意事项**：建议开发者监听此回调并处理错误情况。
</Warning>
</ParamField>

<ParamField
  name="onSurfaceFirstFrameDraw"
  prototype="- (void)onSurfaceFirstFrameDraw;"
  desc="Surface首帧渲染回调。"
  parent_file="Declared in \`IZegoDigitalMobile.h\`"
  parent_name="ZegoDigitalMobileDelegate"
  parent_type="class">
**详情**

当数字人视频首帧开始渲染时触发此回调。客户可以监听此回调在首帧渲染前设置loading view，避免预览视图出现黑屏闪烁。

<Note title="">
- **通知时机**：数字人视频首帧开始渲染时触发。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：无。
- **注意事项**：建议在首帧渲染前设置loading view，避免预览视图出现黑屏闪烁。
</Warning>
</ParamField>

## IZegoDigitalMobile

*Declared in `IZegoDigitalMobile.h`*

### 方法
<ParamField
  name="start:delegate:"
  prototype="- (void)start:(NSString *)digitalHumanConfig delegate:(nullable id<ZegoDigitalMobileDelegate>)delegate;"
  desc="启动数字人任务。"
  parent_file="Declared in \`IZegoDigitalMobile.h\`"
  parent_name="IZegoDigitalMobile"
  parent_type="class">
**参数**

| 名称 | 类型 | 描述 |
| --- | --- | --- |
| digitalHumanConfig | NSString * | 数字人配置字符串，包含数字人的各种参数设置。 |
| delegate | nullable id\<ZegoDigitalMobileDelegate\> | 数字人SDK事件回调代理，用于接收状态变化和错误通知，可选参数。 |

**详情**

根据指定的配置启动数字人服务，建立数字人实例并开始运行。

<Note title="">
- **业务场景**：启动数字人服务，建立数字人实例并开始运行。
- **调用时机**：创建数字人实例后调用。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：无。
- **注意事项**：需要确保配置字符串格式正确。
</Warning>
</ParamField>

<ParamField
  name="attach:"
  prototype="- (void)attach:(UIView *)previewView;"
  desc="绑定预览视图。"
  parent_file="Declared in \`IZegoDigitalMobile.h\`"
  parent_name="IZegoDigitalMobile"
  parent_type="class">
**参数**

| 名称 | 类型 | 描述 |
| --- | --- | --- |
| previewView | UIView * | 用于显示数字人视频的预览视图。 |

**详情**

将数字人的视频输出绑定到指定的UI视图上进行显示。

<Note title="">
- **业务场景**：将数字人视频输出绑定到UI视图进行显示。
- **调用时机**：启动数字人服务后调用。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：无。
- **注意事项**：需要确保预览视图已正确初始化。
</Warning>
</ParamField>

<ParamField
  name="getPreviewView"
  prototype="- (ZegoDigitalView*)getPreviewView;"
  desc="获取已绑定的预览视图。"
  parent_file="Declared in \`IZegoDigitalMobile.h\`"
  parent_name="IZegoDigitalMobile"
  parent_type="class">
**返回值**

数字人SDK引用的ZegoDigitalView。

**详情**

获取数字人SDK引用的ZegoPreviewView。

<Note title="">
- **业务场景**：获取已绑定的预览视图。
- **调用时机**：绑定预览视图后调用。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：无。
- **注意事项**：如果未绑定预览视图，可能返回nil。
</Warning>
</ParamField>

<ParamField
  name="onRemoteVideoFrameRawData:dataLength:param:streamID:"
  prototype="- (void)onRemoteVideoFrameRawData:(unsigned char *_Nonnull *_Nonnull)data dataLength:(unsigned int *)dataLength param:(ZDMVideoFrameParam *)param streamID:(NSString *)streamID;"
  desc="接收远端视频帧原始数据。"
  parent_file="Declared in \`IZegoDigitalMobile.h\`"
  parent_name="IZegoDigitalMobile"
  parent_type="class">
**参数**

| 名称 | 类型 | 描述 |
| --- | --- | --- |
| data | unsigned char * _Nonnull * _Nonnull | 视频帧数据数组，包含各个颜色平面的数据指针。 |
| dataLength | unsigned int * | 每个数据缓冲区的长度数组，对应data数组中每个平面的数据长度。 |
| param | [ZDMVideoFrameParam](./class#zdmvideoframeparam) * | 视频帧参数对象，包含格式、分辨率、旋转角度等信息。 |
| streamID | NSString * | 视频流ID，用于标识数据来源的视频流。 |

**详情**

当接收到远端数字人视频流的原始帧数据时调用此方法。通常由外部SDK在开启自定义视频渲染后，将接收到的视频帧数据传递给数字人SDK进行处理。

<Note title="">
- **业务场景**：将外部SDK接收到的视频帧数据传递给数字人SDK。
- **调用时机**：外部SDK接收到远端视频帧数据时调用。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：需要确保外部SDK已开启自定义视频渲染功能。
- **注意事项**：本方法为高频调用，请勿在本方法中做耗时操作。需要确保在方法中正确处理内存，避免内存泄漏。data 和 dataLength 数组的生命周期由调用方管理，数字人SDK内部会进行数据拷贝。
</Warning>
</ParamField>

<ParamField
  name="onPlayerSyncRecvSEI:data:"
  prototype="- (void)onPlayerSyncRecvSEI:(NSString *)streamID data:(NSData *)data;"
  desc="接收播放器SEI信息。"
  parent_file="Declared in \`IZegoDigitalMobile.h\`"
  parent_name="IZegoDigitalMobile"
  parent_type="class">
**参数**

| 名称 | 类型 | 描述 |
| --- | --- | --- |
| streamID | NSString * | 视频流ID，标识SEI数据来源的视频流。 |
| data | NSData * | SEI数据内容，包含具体的增强信息。 |

**详情**

当播放器接收到视频流中的SEI（Supplemental Enhancement Information）信息时调用此方法。通常由外部SDK(如实时音视频SDK)在接收到SEI数据后，将数据传递给数字人SDK进行处理。SEI通常包含与视频同步的元数据信息，如时间戳、自定义数据等。

<Note title="">
- **业务场景**：将外部SDK接收到的SEI数据传递给数字人SDK。
- **调用时机**：外部SDK接收到视频流中的SEI信息时调用。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：无。
- **注意事项**：需要确保外部SDK已正确监听SEI数据回调。
</Warning>
</ParamField>

<ParamField
  name="stop"
  prototype="- (void)stop;"
  desc="停止数字人服务。"
  parent_file="Declared in \`IZegoDigitalMobile.h\`"
  parent_name="IZegoDigitalMobile"
  parent_type="class">
**详情**

停止当前运行的数字人任务，释放相关资源并清理连接。

<Note title="">
- **业务场景**：停止数字人服务，释放资源。
- **调用时机**：需要停止数字人服务时调用。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：无。
- **注意事项**：调用此方法后，数字人服务将停止，相关资源将被释放。
</Warning>
</ParamField>

## ZegoDigitalHumanResourceDelegate

*Declared in `ZegoDigitalHumanResource.h`*

### 方法
<ParamField
  name="onPreloadSuccess:"
  prototype="- (void)onPreloadSuccess:(NSString *)digitalHumanId;"
  desc="预加载成功回调。"
  parent_file="Declared in \`ZegoDigitalHumanResource.h\`"
  parent_name="ZegoDigitalHumanResourceDelegate"
  parent_type="class">
**参数**

| 名称 | 类型 | 描述 |
| --- | --- | --- |
| digitalHumanId | NSString * | 数字人ID。 |

**详情**

当数字人资源预加载成功时触发此回调。

<Note title="">
- **通知时机**：数字人资源预加载成功时触发。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：此方法为可选方法（@optional）。
- **注意事项**：无。
</Warning>
</ParamField>

<ParamField
  name="onPreloadFailed:errorCode:errorMessage:"
  prototype="- (void)onPreloadFailed:(NSString *)digitalHumanId errorCode:(NSInteger)errorCode errorMessage:(NSString *)errorMessage;"
  desc="预加载失败回调。"
  parent_file="Declared in \`ZegoDigitalHumanResource.h\`"
  parent_name="ZegoDigitalHumanResourceDelegate"
  parent_type="class">
**参数**

| 名称 | 类型 | 描述 |
| --- | --- | --- |
| digitalHumanId | NSString * | 数字人ID。 |
| errorCode | NSInteger | 错误码。 |
| errorMessage | NSString * | 错误信息。 |

**详情**

当数字人资源预加载失败时触发此回调。

<Note title="">
- **通知时机**：数字人资源预加载失败时触发。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：此方法为可选方法（@optional）。
- **注意事项**：建议开发者监听此回调并处理错误情况。
</Warning>
</ParamField>

<ParamField
  name="onPreloadProgress:progress:"
  prototype="- (void)onPreloadProgress:(NSString *)digitalHumanId progress:(float)progress;"
  desc="预加载进度回调。"
  parent_file="Declared in \`ZegoDigitalHumanResource.h\`"
  parent_name="ZegoDigitalHumanResourceDelegate"
  parent_type="class">
**参数**

| 名称 | 类型 | 描述 |
| --- | --- | --- |
| digitalHumanId | NSString * | 数字人ID。 |
| progress | float | 总进度（0-100）。 |

**详情**

当数字人资源预加载进度更新时触发此回调。

<Note title="">
- **通知时机**：数字人资源预加载进度更新时触发。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：此方法为可选方法（@optional）。
- **注意事项**：进度值范围为0-100，可用于更新UI进度条。
</Warning>
</ParamField>

## IsLoadedDelegate

*Declared in `ZegoDigitalHumanResource.h`*

### 方法
<ParamField
  name="onIsLoadedSucceed:isLoaded:"
  prototype="- (void)onIsLoadedSucceed:(NSString *)digitalHumanID isLoaded:(BOOL)isLoaded;"
  desc="接口执行成功回调。"
  parent_file="Declared in \`ZegoDigitalHumanResource.h\`"
  parent_name="IsLoadedDelegate"
  parent_type="class">
**参数**

| 名称 | 类型 | 描述 |
| --- | --- | --- |
| digitalHumanID | NSString * | 被查询的数字人 ID。 |
| isLoaded | BOOL | 查询结果，YES表示已加载，NO表示未加载。 |

**详情**

当检查数字人资源是否已加载的接口执行成功时触发此回调。

<Note title="">
- **通知时机**：检查数字人资源是否已加载的接口执行成功时触发。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：此方法为可选方法（@optional）。
- **注意事项**：无。
</Warning>
</ParamField>

<ParamField
  name="onIsLoadedError:code:msg:"
  prototype="- (void)onIsLoadedError:(NSString *)digitalHumanID code:(int)code msg:(NSString*)msg;"
  desc="接口执行失败回调。"
  parent_file="Declared in \`ZegoDigitalHumanResource.h\`"
  parent_name="IsLoadedDelegate"
  parent_type="class">
**参数**

| 名称 | 类型 | 描述 |
| --- | --- | --- |
| digitalHumanID | NSString * | 被查询的数字人 ID。 |
| code | int | 错误码。 |
| msg | NSString * | 错误信息。 |

**详情**

当检查数字人资源是否已加载的接口执行失败时触发此回调。

<Note title="">
- **通知时机**：检查数字人资源是否已加载的接口执行失败时触发。
</Note>

<Warning title="">
- **支持版本**：1.0.0 及以上。
- **使用限制**：此方法为可选方法（@optional）。
- **注意事项**：建议开发者监听此回调并处理错误情况。
</Warning>
</ParamField>
