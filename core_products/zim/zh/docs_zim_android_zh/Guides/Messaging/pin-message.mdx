---
articleID: 11594
---

import { getPlatformData2 } from "/snippets/utils-content-parser.js"
import { ZIMAudioMessageMap, ZIMCombineMessageMap, ZIMCustomMessageMap, ZIMFileMessageMap, ZIMImageMessageMap, ZIMMultipleMessageMap, ZIMTextMessageMap, ZIMVideoMessageMap, messagePinStatusChangedMap, pinMessageMap, queryPinnedMessageListMap, setEventHandlerMap } from "/snippets/zim/const-link.mdx"

export const ZIMMessagePinnedCallbackMap = {
  'default,window,iOS,mac': <a href='@ZIMMessagePinnedCallback' target='_blank'>ZIMMessagePinnedCallback</a>,
  'Flutter': <a href='https://pub.dev/documentation/zego_zim/latest/zego_zim/ZIMMessagePinnedResult-class.html' target='_blank'>ZIMMessagePinnedResult</a>,
}

export const ZIMPinnedMessageListQueriedCallbackMap = {
  'default,window,iOS,mac': <a href='@ZIMPinnedMessageListQueriedCallback' target='_blank'>ZIMPinnedMessageListQueriedCallback</a>,
  'Web,UTS': <a href='@-ZIMPinnedMessageListQueriedResult' target='_blank'>ZIMPinnedMessageListQueriedResult</a>,
  'Flutter': <a href='https://pub.dev/documentation/zego_zim/latest/zego_zim/ZIMPinnedMessageListQueriedResult-class.html' target='_blank'>ZIMPinnedMessageListQueriedResult</a>,
}

# 消息置顶

- - -

## 功能简介

<Note title="说明">

如需使用本功能，请开通旗舰版套餐。
</Note>

ZIM SDK 支持在会话中将特定消息添加到置顶消息列表，会话成员可以随时查询置顶消息列表中的消息。此功能可用于将重要的消息固定在会话的顶部，方便会话成员快速查看。

## 监听消息置顶状态变更

:::if{props.platform="undefined|window|iOS|mac"}
会话成员注册 {getPlatformData2(props,setEventHandlerMap)} 监听 {getPlatformData2(props,messagePinStatusChangedMap)} 回调监听消息置顶状态变更的相关通知。当其他用户置顶消息后，可以通过该通知获取置顶消息的状态变化、置顶时间和置顶操作者等相关信息。
:::
:::if{props.platform="Web|UTS|Flutter"}
会话成员监听 {getPlatformData2(props,messagePinStatusChangedMap)} 回调监听消息置顶状态变更的相关通知。当其他用户置顶消息后，可以通过该通知获取置顶消息的状态变化、置顶时间和置顶操作者等相关信息。
:::
:::if{props.platform=undefined}
```java title="示例代码"
// 注册事件
zim.setEventHandler(new ZIMEventHandler() {
    @Override
    public void onMessagePinStatusChanged(ZIM zim, ArrayList<ZIMMessagePinStatusChangeInfo> changeInfoList) {
        // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
    }
});
```
:::
:::if{props.platform="iOS|mac"}
```objc title="示例代码"
// 注册事件
- (void)zim:(ZIM *)zim messagePinStatusChanged:(NSArray<ZIMMessagePinStatusChangeInfo *> *)changeInfoList {
    if (zim != self.zim) {
        return;
    }
    // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
};
```
:::
:::if{props.platform="window"}
```cpp title="示例代码"
// 注册事件
void onMessagePinStatusChanged(
    ZIM *zim, const std::vector<ZIMMessagePinStatusChangeInfo> & changeInfoList) override {
    // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
}
```
:::
:::if{props.platform="Flutter"}
```dart title="示例代码"
// 注册事件
ZIMEventHandler.onMessagePinStatusChanged = (zim, changeInfoList) {
    // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
};
```
:::
:::if{props.platform="Web"}
```typescript title="示例代码"
// 注册事件
zim.on('messagePinStatusChanged', (zim: ZIM, data: ZIMEventOfMessagePinStatusChangedResult) => {
    // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
})
```
:::
:::if{props.platform="UTS"}
```typescript title="示例代码"
// 注册事件
zim.onMessagePinStatusChanged((data: ZIMEventOfMessagePinStatusChangedResult) => {
    // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
})
```
:::

## 置顶消息

会话成员可以调用 {getPlatformData2(props,pinMessageMap)} 接口置顶会话内成功发送的消息。支持置顶的消息类型如下表所示：

|消息类型|说明|
|-----|-----|
|{getPlatformData2(props,ZIMTextMessageMap)}|文本消息|
|{getPlatformData2(props,ZIMMultipleMessageMap)}|组合消息|
|{getPlatformData2(props,ZIMImageMessageMap)}|图片消息|
|{getPlatformData2(props,ZIMFileMessageMap)}|文件消息|
|{getPlatformData2(props,ZIMAudioMessageMap)}|音频消息|
|{getPlatformData2(props,ZIMVideoMessageMap)}|视频消息|
|{getPlatformData2(props,ZIMCombineMessageMap)}|合并消息|
|{getPlatformData2(props,ZIMCustomMessageMap)}|自定义消息|

:::if{props.platform="undefined|window|iOS|mac|Flutter"}
消息置顶后可通过 {getPlatformData2(props,ZIMMessagePinnedCallbackMap)} 接口获取置顶操作的结果。
:::

会话中存在置顶消息时，会话成员可以通过调用 {getPlatformData2(props,queryPinnedMessageListMap)} 接口查询置顶消息，并通过 {getPlatformData2(props,ZIMPinnedMessageListQueriedCallbackMap)} 获取置顶消息列表。

<Warning title="注意">
- 消息置顶仅支持在单聊和群聊会话中调用。
- 每个会话仅支持支持最多十条消息。尝试置顶第十一条消息时，会自动将置顶时间最早的消息解除置顶。
- 重复置顶同一条消息会更新其置顶时间。
- ZIMMessage 消息对象中的 pinnedUserID 和 pinnedTime 仅在 {getPlatformData2(props,ZIMPinnedMessageListQueriedCallbackMap)} 和 {getPlatformData2(props,messagePinStatusChangedMap)} 中返回
- 群聊消息置顶和取消置顶操作可通过后台配置是否触发群 Tips 消息推送（默认不触发推送）。配置开启推送后，当群聊会话内有消息被置顶或取消置顶时，群成员会收到消息置顶相关的 TIPS 消息。例如：“XXX置顶了一条消息”。详情请参考 [接收 TIPS 消息](./Receive%20tip%20messages.mdx)。
</Warning>

:::if{props.platform=undefined}
```java title="示例代码"
// 置顶一条文本消息
ZIMTextMessage messageObj; // 从 queryHistoryMessage 接口获取

zim.pinMessage(messageObj, true, new ZIMMessagePinnedCallback() {
    @Override
    public void onMessagePinned(ZIMError errorInfo) {
        // 从这里获知置顶消息的操作是否成功
    }
});

// 查询会话的置顶消息列表
zim.queryPinnedMessageList(conversationID, conversationType, new ZIMPinnedMessageListQueriedCallback() { 
    @Override
    public void onPinnedMessageListQueried(ArrayList<ZIMMessage> messageList, ZIMError errorInfo) { 
        // 从此处获取置顶消息列表
    }
})
```
:::
:::if{props.platform="iOS|mac"}
```objc title="示例代码"
// 置顶一条文本消息
ZIMTextMessage *messageObj; // 从 queryHistoryMessage 接口获取

[[ZIM getInstance] pinMessage:messageObj 
                     isPinned:YES 
                    callback:^(ZIMError * _Nonnull errorInfo) {
    // 从这里获知置顶消息的操作是否成功
}];

// 查询会话的置顶消息列表
[[ZIM getInstance] queryPinnedMessageListByConversationID:conversationID 
                                         conversationType:conversationType 
                                                 callback:^(NSArray<ZIMMessage *> * _Nonnull messageList, ZIMError * _Nonnull errorInfo) {
    // 从此处获取置顶消息列表
}];
```
:::
:::if{props.platform="window"}
```cpp title="示例代码"
// 置顶一条文本消息
std::shared_ptr<zim::ZIMTextMessage> message_obj; // 从 queryHistoryMessage 接口获取

zim_->pinMessage(
    message_obj, true, 
    [=](const zim::ZIMError &errorInfo) {
        // 根据 errorInfo 判断是否操作成功
    });

// 查询会话的置顶消息列表
zim_->queryPinnedMessageList(
    conversation_id, conversation_type,
    [=](const std::vector<std::shared_ptr<zim::ZIMMessage>> &message_list,
        const zim::ZIMError &error_info) {
        // 从此处获取置顶消息列表
    });
```
:::
:::if{props.platform="Flutter"}
```dart title="示例代码"
// 置顶一条文本消息
ZIMTextMessage messageObj; // 从 queryHistoryMessage 接口获取

ZIM.getInstance().pinMessage(messageObj, true)
    .then((result){
    // 操作成功
    })
    .catchError((onError) {
    // 操作失败
    }); 
// 查询会话的置顶消息列表
ZIM.getInstance().queryPinnedMessageList(conversationID, conversationType)
    .then((result) {
    // 从此处获取置顶消息列表
    })
    .catchError((onError) {
    // 操作失败
    });
```
:::
:::if{props.platform="Web|UTS"}
```typescript title="示例代码"
// 置顶一条文本消息
const messageObj: ZIMMessage = {}; // 从 queryHistoryMessage 接口获取

zim.pinMessage(messageObj, true)
    .then(() => {
        // 操作成功
    })
    .catch((err: ZIMError) => {
        // 操作失败 
    });

// 查询会话的置顶消息列表
zim.queryPinnedMessageList(conversationID, conversationType)
    .then((res: ZIMMessagePinnedListQueriedResult) => {
        // 从此处获取置顶消息列表
    })
    .catch((err: ZIMError) => {
        // 操作失败
    });
```
:::
