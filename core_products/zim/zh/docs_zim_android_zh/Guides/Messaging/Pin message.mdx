---
articleID: 11594
---

import { getPlatformData } from "/snippets/utils-content-parser.js"
import { ZIMTextMessageMap, ZIMMultipleMessageMap, ZIMCustomMessageMap, ZIMImageMessageMap, ZIMFileMessageMap, ZIMAudioMessageMap, ZIMVideoMessageMap, ZIMCombineMessageMap, pinMessageMap, queryPinnedMessageListMap, messagePinnedMap, setEventHandlerMap } from "/snippets/zim/const-link.mdx"

export const ZIMMessagePinnedCallbackMap = {
  'Web,UTS': <a href='@-ZIMMessagePinnedResult' target='_blank'>ZIMMessagePinnedResult</a>,
  'window,iOS,mac': <a href='@ZIMMessagePinnedCallback' target='_blank'>ZIMMessagePinnedCallback</a>,
  'Flutter': <a href='https://pub.dev/documentation/zego_zim/latest/zego_zim/ZIMMessagePinnedResult-class.html' target='_blank'>ZIMMessagePinnedResult</a>,
}

export const ZIMPinnedMessageListQueriedCallbackMap = {
  'Web,UTS': <a href='@-ZIMPinnedMessageListQueriedResult' target='_blank'>ZIMPinnedMessageListQueriedResult</a>,
  'window,iOS,mac': <a href='@ZIMPinnedMessageListQueriedCallback' target='_blank'>ZIMPinnedMessageListQueriedCallback</a>,
  'Flutter': <a href='https://pub.dev/documentation/zego_zim/latest/zego_zim/ZIMPinnedMessageListQueriedResult-class.html' target='_blank'>ZIMPinnedMessageListQueriedResult</a>,
}

# 编辑消息

- - -

## 功能简介

<Note title="说明">

如需使用本功能，请开通旗舰版套餐。
</Note>

ZIM SDK 支持在会话中将特定消息固定在置顶消息列表的功能，即使有新的消息进来，它们也可以直接被检索到。这个功能可以帮助用户更容易地找到并访问他们认为重要或频繁查看的消息。

## 设置监听

:::if{props.platform="undefined|Web|window|iOS|mac"}
会话参与者注册 {getPlatformData(props,setEventHandlerMap)} 监听 {getPlatformData(props,messagePinnedMap)} 回调监听消息置顶状态变更的相关通知。当其他用户置顶消息后，可以通过该通知获取置顶消息的状态变化以及相关信息，包括置顶时间和置顶操作者等。
:::
:::if{props.platform="UTS|Flutter"}
会话参与者监听 {getPlatformData(props,messagePinnedMap)} 回调监听消息置顶状态变更的相关通知。当其他用户置顶消息后，可以通过该通知获取置顶消息的状态变化以及相关信息，包括置顶时间和置顶操作者等。

:::if{props.platform=undefined}
```java title="示例代码"
// 注册事件
zim.setEventHandler(new ZIMEventHandler() {
    @Override
    public void onMessagePinStatusChanged(ZIM zim, ArrayList<ZIMMessagePinStatusChangeInfo> changeInfoList) {
        // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
    }
});
:::
:::if{props.platform="iOS|mac"}
```objc title="示例代码"
// 注册事件
- (void)zim:(ZIM *)zim messagePinStatusChanged:(NSArray<ZIMMessagePinStatusChangeInfo *> *)changeInfoList {
    if (zim != self.zim) {
        return;
    }
    // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
};
```
:::
:::if{props.platform="window"}
```cpp title="示例代码"
// 注册事件
void onMessagePinStatusChanged(
    ZIM *zim, const std::vector<ZIMMessagePinStatusChangeInfo> & changeInfoList) override {
    // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
}
```
:::
:::if{props.platform="Flutter"}
```dart title="示例代码"
// 注册事件
ZIMEventHandler.onMessagePinStatusChanged = (zim, changeInfoList) {
    // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
};
```
:::
:::if{props.platform="Web"}
```typescript title="示例代码"
// 注册事件
zim.on('messagePinStatusChanged', (zim: ZIM, data: ZIMEventOfMessagePinStatusChangedResult) => {
    // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
})
```
:::
:::if{props.platform="UTS"}
```typescript title="示例代码"
// 注册事件
zim.onMessagePinStatusChanged((data) => {
    // 收到消息置顶状态变更通知后，可于此处获取到置顶的消息/取消置顶的消息以此刷新 UI
})
```
:::

## 置顶消息

**成功登录 ZIM SDK 后**，会话参与者可以调用 {getPlatformData(props,pinMessageMap)} 接口置顶会话内成功发送的消息（仅支持以下类型的消息：{getPlatformData(props,ZIMTextMessageMap)}、{getPlatformData(props,ZIMMultipleMessageMap)}、{getPlatformData(props,ZIMImageMessageMap)}、{getPlatformData(props,ZIMFileMessageMap)}、{getPlatformData(props,ZIMAudioMessageMap)}、{getPlatformData(props,ZIMVideoMessageMap)}、{getPlatformData(props,ZIMCombineMessageMap)}、{getPlatformData(props,ZIMCustomMessageMap)}）。
随后通过 {getPlatformData(props,ZIMMessagePinnedCallbackMap)} 得知编辑操作结果。
当想会话中存在置顶消息时，会话参与者可以通过调用 {getPlatformData(props,queryPinnedMessageListMap)} 接口查询置顶消息，并通过 {getPlatformData(props,ZIMPinnedMessageListQueriedCallbackMap)} 获取置顶消息列表。

<Note title="说明">
- 消息置顶仅支持在单聊和群聊会话中调用。
- 每个会话仅支持支持最多十条消息。尝试置顶第十一条消息时，会自动将置顶时间最早的消息解除置顶。
- 重复置顶同一条消息会更新其置顶时间。
- ZIMMessage 消息对象中的 pinnedUserID 和 pinnedTime 仅在 {getPlatformData(props,ZIMPinnedMessageListQueriedCallbackMap)} 和 {getPlatformData(props,messagePinnedMap)} 中返回
</Note>

:::if{props.platform=undefined}
```java title="示例代码"
// 置顶一条文本消息
ZIMTextMessage messageObj; // 从 queryHistoryMessage 接口获取

zim.pinMessage(messageObj, true, new ZIMMessagePinnedCallback() {
    @Override
    public void onMessagePinned(ZIMError errorInfo) {
        // 从这里获知置顶消息的操作是否成功
    }
});

zim.queryPinnedMessageList(conversationID, conversationType, new ZIMPinnedMessageListQueriedCallback() { 
    @Override
    public void onPinnedMessageListQueried(ArrayList<ZIMMessage> messageList, ZIMError errorInfo) { 
        // 从此处获取置顶消息列表
    }
})
```
:::
:::if{props.platform="iOS|mac"}
```objc title="示例代码"
// 置顶一条文本消息
ZIMTextMessage *messageObj; // 从 queryHistoryMessage 接口获取

[[ZIM getInstance] pinMessage:messageObj 
                     isPinned:YES 
                    callback:^(ZIMError * _Nonnull errorInfo) {
    // 从这里获知置顶消息的操作是否成功
}];

[[ZIM getInstance] queryPinnedMessageListByConversationID:conversationID 
                                         conversationType:conversationType 
                                                 callback:^(NSArray<ZIMMessage *> * _Nonnull messageList, ZIMError * _Nonnull errorInfo) {
    // 从此处获取置顶消息列表
}];
```
:::
:::if{props.platform="window"}
```cpp title="示例代码"
// 置顶一条文本消息
std::shared_ptr<zim::ZIMTextMessage> message_obj; // 从 queryHistoryMessage 接口获取

zim_->pinMessage(
    message_obj, true, 
    [=](const zim::ZIMError &errorInfo) {
        // 根据 errorInfo 判断是否操作成功
    });

zim_->queryPinnedMessageList(
    conversation_id, conversation_type,
    [=](const std::vector<std::shared_ptr<zim::ZIMMessage>> &message_list,
        const zim::ZIMError &error_info) {
        // 从此处获取置顶消息列表
    });
```
:::
:::if{props.platform="Flutter"}
```dart title="示例代码"
// 置顶一条文本消息
ZIMTextMessage messageObj; // 从 queryHistoryMessage 接口获取

ZIM.getInstance().pinMessage(messageObj, true)
    .then((result){
    // 操作成功
    })
    .catchError((onError) {
    // 操作失败
    }); 

ZIM.getInstance().queryPinnedMessageList(conversationID, conversationType)
    .then((result) {
    // 从此处获取置顶消息列表
    })
    .catchError((onError) {
    // 操作失败
    });
```
:::
:::if{props.platform="Web|UTS"}
```typescript title="示例代码"
// 置顶一条文本消息
const messageObj: ZIMMessage = {}; // 从 queryHistoryMessage 接口获取

zim.pinMessage(messageObj, true)
    .then((res: ZIMMessagePinnedResult) {
        // 操作成功
    })
    .catch((err: ZIMError) => {
        // 操作失败 
    });

zim.queryPinnedMessageList(conversationID, conversationType)
    .then((res: ZIMMessagePinnedListQueriedResult) {
        // 从此处获取置顶消息列表
    })
    .catch((err: ZIMError) => {
        // 操作失败
    });
```
:::
