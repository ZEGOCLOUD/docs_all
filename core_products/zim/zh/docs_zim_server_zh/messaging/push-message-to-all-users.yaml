openapi: 3.0.0
info:
  title: open-api-desc
  version: 1.0.0
  contact:
    name: ZEGO Support
    email: support@zegocloud.com

servers:
  $ref: '../shared-components.yaml#/servers'

tags:
  - messaging

paths:
  /:
    post:
      tags: [messaging]
      summary: 全员推送
      description: |
        全员推送，是指向所有在线用户（包括消息发送用户自己）、离线用户发送特定内容的消息，如文本、图片等。本功能适用于全员活动公告、送礼跨房间飘屏等场景。

        - 在线用户：登录 ZIM 并且心跳未超时的用户。
        - 离线用户：登录 ZIM 并上报 ZPNsPushId 之后，心跳超时的用户。

        <Note title="说明">
        - 如需使用本功能，请开通 ZIM 专业版或旗舰版服务。
        - 通过本接口发送的消息不会导致会话产生，也不会被保存。
        </Note>

        <Note title="说明">调用频率限制：1 次/秒，每 24 小时内仅限 100 次，如需调整，请联系 ZEGO 技术支持。</Note>
      operationId: push-message-to-all-users
      parameters:
        - name: Action
          in: query
          description: |
            > 接口原型参数
            >
            > https://zim-api.zego.im/?Action=SendMessageToAllUsers
          required: true
          schema:
            type: string
            enum: [SendMessageToAllUsers]
          style: form
          explode: true
        - $ref: '../shared-components.yaml#/components/parameters/AppId'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureNonce'
        - $ref: '../shared-components.yaml#/components/parameters/Timestamp'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureVersion'
        - $ref: '../shared-components.yaml#/components/parameters/Signature'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendMessageToAllUsersRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SendMessageToAllUsersResponse'

components:
  schemas:
    SendMessageToAllUsersRequest:
      type: object
      required: [FromUserId, MessageType, MessageBody]
      properties:
        FromUserId:
          type: string
          description: 发送方用户 ID（已登录或已注册）。
          maxLength: 32
          example: "sender_user"
        MessageType:
          type: integer
          format: int32
          description: 消息类型；适用类型见 MessageBody 说明。
          example: 1
        MessageBody:
          type: object
          description: 消息内容；结构见 MessageBody 说明。
          additionalProperties: true
        SubMsgType:
          type: integer
          description: 当 MessageType 为自定义消息时需赋值，范围 [0,200]。
        PushType:
          type: integer
          description: 推送类别：0 仅在线；1 在线+离线；2 所有上报 ZPNsPushId 的用户离线推送。
    SendMessageToAllUsersResponse:
      type: object
      properties:
        Code:
          type: integer
          description: |
            返回码。
            <Note title="说明">当您发起请求同时向多个用户发送消息时：<ul><li>如果只需成功向 1 个或以上的用户发送消息，Code 都会返回 0，表示成功。此时请参考 ErrorList 中的具体信息，确认操作结果，了解是否向部分用户发送消息失败。</li><li>如果向所有用户发送消息都失败，Code 会返回相关返回码，具体请参考 全局返回码。</li></ul></Note>
        Message:
          type: string
        RequestId:
          type: string
      description: 仅返回通用三段，无 Data。
