openapi: 3.0.0
info:
  title: open-api-desc
  version: 1.0.0
  contact:
    name: ZEGO Support
    email: support@zegocloud.com

servers:
  $ref: '../shared-components.yaml#/servers'

tags:
  - conversation

paths:
  /:
    post:
      tags: [conversation]
      summary: QueryPeerMsg
      description: |
        è°ƒç”¨æ­¤æ¥å£ï¼Œåˆ†é¡µæ‹‰å–æŒ‡å®šç”¨æˆ·çš„æŸä¸ªå•èŠä¼šè¯çš„æ¶ˆæ¯åˆ—è¡¨ã€‚

        <Note title="è¯´æ˜">å‚æ•° FromUserId å’Œ ToUserId å¯¹åº”çš„ç”¨æˆ·éœ€å·²ç™»å½•æˆ–å·²æ³¨å†Œã€‚</Note>

        <Note title="è¯´æ˜">è°ƒç”¨é¢‘ç‡é™åˆ¶ï¼š20 æ¬¡/ç§’ã€‚</Note>
      operationId: query-the-message-list-of-one-on-one-chats
      parameters:
        - name: Action
          in: query
          description: |
            > æ¥å£åŸå‹å‚æ•°
            >
            > https://zim-api.zego.im/?Action=QueryPeerMsg
          required: true
          schema:
            type: string
            enum: [QueryPeerMsg]
          style: form
          explode: true
        - $ref: '../shared-components.yaml#/components/parameters/AppId'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureNonce'
        - $ref: '../shared-components.yaml#/components/parameters/Timestamp'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureVersion'
        - $ref: '../shared-components.yaml#/components/parameters/Signature'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryPeerMsgRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryPeerMsgResponse'

components:
  schemas:
    QueryPeerMsgRequest:
      type: object
      required: [FromUserId, ToUserId]
      properties:
        FromUserId:
          type: string
          description: |
            å¦‚éœ€æŸ¥è¯¢ç”¨æˆ· A ä¸ç”¨æˆ· B çš„å•èŠä¼šè¯æ¶ˆæ¯åˆ—è¡¨ï¼Œæ­¤å¤„å¡«å…¥ç”¨æˆ· A çš„ UserIDï¼ˆå·²åœ¨å®¢æˆ·ç«¯è°ƒç”¨ login æ–¹æ³•ç™»å½• ZIM æœåŠ¡ï¼Œæˆ–å·²è°ƒç”¨ [æœåŠ¡ç«¯ API](/zim-server/user/batch-register-users) å®Œæˆæ³¨å†Œï¼‰ã€‚

            > **è¯´æ˜**
            >
            > FromUserId ä»…æ”¯æŒæ•°å­—ï¼Œè‹±æ–‡å­—ç¬¦å’Œ "'!'ï¼Œ'#'ï¼Œ'$'ï¼Œ'%'ï¼Œ'&'ï¼Œ'('ï¼Œ')'ï¼Œ'+'ï¼Œ''ï¼Œ':'ï¼Œ';'ï¼Œ'<'ï¼Œ'='ï¼Œ'.'ï¼Œ'>'ï¼Œ'?'ï¼Œ'@'ï¼Œ'['ï¼Œ']'ï¼Œ'^'ï¼Œ'_'ï¼Œ' 'ï¼Œ'{'ï¼Œ'}'ï¼Œ'|'ï¼Œ'~'"ã€‚
          maxLength: 32
          example: "u1"
        ToUserId:
          type: string
          description: æ­¤å¤„å¡«å…¥ç”¨æˆ· B çš„ UserIDã€‚
          maxLength: 32
          example: "u2"
        Limit:
          type: number
          description: |
            å•æ¬¡è·å–æ¶ˆæ¯çš„æ•°é‡ï¼Œå–å€¼èŒƒå›´ä¸º (0, 100]ï¼Œé»˜è®¤ä¸º 10ã€‚
            - å½“å€¼ â‰¤ 0 æ—¶ï¼Œä¿®æ­£ä¸º 10ã€‚
            - å½“å€¼ > 100ï¼Œä¿®æ­£ä¸º 100ã€‚
          minimum: 1
          maximum: 100
          default: 10
          example: 10
        Next:
          type: number
          description: |
            åˆ†é¡µæ‹‰å–æ ‡å¿—ï¼Œç¬¬ä¸€æ¬¡å¡« 0 ï¼Œä¹‹åå¡«ä¸Šä¸€æ¬¡è¿”å›çš„ Next å€¼ã€‚å½“è¿”å›çš„ Next ä¸º 0 æ—¶ï¼Œä»£è¡¨æ¶ˆæ¯åˆ—è¡¨è·å–å®Œæ¯•ã€‚

            ä¾‹å¦‚ï¼Œå½“å‰å•èŠä¼šè¯æœ‰ 250 æ¡æ¶ˆæ¯ï¼Œè°ƒç”¨æœ¬æ¥å£æŸ¥è¯¢æ—¶ï¼š
            - ç¬¬ä¸€æ¬¡è°ƒç”¨æœ¬æ¥å£ï¼ŒLimit å¡« 100ï¼ŒNext ä¼  0ï¼ŒæŸ¥è¯¢ç¬¬ 1 ï½100 æ¡æ¶ˆæ¯ï¼›è¿”å›ç»“æœä¸­çš„ Next å€¼ä¸º num1ã€‚
            - ç¬¬äºŒæ¬¡è°ƒç”¨æœ¬æ¥å£ï¼ŒLimit å¡« 100ï¼ŒNext å¡« num1ï¼ŒæŸ¥è¯¢ç¬¬ 101 ï½ 200 æ¡æ¶ˆæ¯ï¼›è¿”å›ç»“æœä¸­ Next å€¼ä¸º num2ã€‚
            - ç¬¬ä¸‰æ¬¡è°ƒç”¨æœ¬æ¥å£ï¼ŒLimit å¡« 100ï¼ŒNext å¡« num2ï¼ŒæŸ¥è¯¢ç¬¬ 201 ï½ 250 æ¡æ¶ˆæ¯ï¼›æŸ¥è¯¢å®Œæ¯•ï¼Œè¿”å›ç»“æœä¸­çš„ Next ä¸º 0ã€‚
          example: 0
        WithEmptyMsg:
          type: number
          description: |
            è¿”å›ç»“æœæ˜¯å¦åŒ…å«å·²æ’¤å›æ¶ˆæ¯å’Œåœ¨æœåŠ¡ç«¯è¢«åˆ é™¤çš„æ¶ˆæ¯ã€‚
            - 0ï¼šé»˜è®¤å€¼ï¼Œä¸åŒ…å«ã€‚
            - 1ï¼šåŒ…å«ã€‚
          enum: [0, 1]
          default: 0
          example: 0
    QueryPeerMsgResponse:
      type: object
      properties:
        Code:
          type: number
          description: |
            è¿”å›ç ã€‚

            ä»¥ä¸‹ä»…åˆ—å‡ºäº†æ¥å£ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„è¿”å›ç ï¼Œå®Œæ•´è¿”å›ç è¯·å‚è€ƒ [å…¨å±€è¿”å›ç ](/zim-server/return-codes)ã€‚
            <table>
            <thead><tr><th>è¿”å›ç </th><th>è¯´æ˜</th><th>å¤„ç†å»ºè®®</th></tr></thead>
            <tbody>
            <tr><td>660000002</td><td>è¾“å…¥å‚æ•°é”™è¯¯ã€‚</td><td>è¯·æ£€æŸ¥è¾“å…¥çš„å‚æ•°ã€‚</td></tr>
            <tr><td>660300005</td><td>è°ƒç”¨æ¥å£çš„é¢‘ç‡è¶…å‡ºäº† AppID çº§åˆ«é™åˆ¶ã€‚</td><td>è¯·ç¨åå†è¯•ã€‚</td></tr>
            <tr><td>660500002</td><td>FromUserId æœªæ³¨å†Œã€‚</td><td>è¯·æ£€æŸ¥ FromUserId æ˜¯å¦æ­£ç¡®ã€‚</td></tr>
            </tbody>
            </table>
        Message:
          type: string
          description: è¯·æ±‚ç»“æœçš„è¯´æ˜ä¿¡æ¯ã€‚
          example: "success"
        RequestId:
          type: string
          description: è¯·æ±‚ IDã€‚
          example: "343649807833778782"
        Next:
          type: number
          description: |
            åˆ†é¡µæ‹‰å–æ ‡å¿—ã€‚
            - é 0ï¼šè¡¨ç¤ºè¿˜æœ‰æ¶ˆæ¯æœªè¿”å›ï¼Œéœ€è¦å°†è¯¥å­—æ®µè®¾ç½®åˆ°è¯·æ±‚å‚æ•° Next ä¸­æ‹‰å–æ›´å¤šæ¶ˆæ¯ã€‚
            - ä¸º 0ï¼šè¡¨ç¤ºå·²ç»è¿”å›å®Œæ•´æ¶ˆæ¯åˆ—è¡¨ã€‚

            > **è¯´æ˜**
            >
            > é™¤ä¸Šè¿°è¯´æ˜ä¹‹å¤–ï¼Œæ­¤å­—æ®µä¸åˆ—è¡¨ä¿¡æ¯æ— ä»»ä½•å…³è”ï¼Œè¯·å‹¿åŸºäºæ­¤åšä»»ä½•å…¶ä»–é€»è¾‘ã€‚
          example: 1000
        List:
          type: array
          description: æ¶ˆæ¯åˆ—è¡¨ã€‚æŒ‰ MsgTime é™åºè¿”å›ç»“æœã€‚
          items:
            type: object
            properties:
              Sender:
                type: string
                description: æ¶ˆæ¯å‘é€è€… IDã€‚
                example: "user1"
              MsgType:
                type: number
                description: |
                  æ¶ˆæ¯ç±»å‹ï¼š
                  - 1ï¼šæ–‡æœ¬ã€‚
                  - 10ï¼šç»„åˆã€‚
                  - 11ï¼šå›¾ç‰‡ã€‚
                  - 12ï¼šæ–‡æ¡£ã€‚
                  - 13ï¼šéŸ³é¢‘ã€‚
                  - 14ï¼šè§†é¢‘ã€‚
                  - 200ï¼šè‡ªå®šä¹‰ã€‚
                example: 1
              SubMsgType:
                type: number
                description: å…·ä½“çš„è‡ªå®šä¹‰ç±»å‹ã€‚å€¼ç”±ç”¨æˆ·å‘é€è‡ªå®šä¹‰æ¶ˆæ¯æ—¶å¡«å†™ï¼Œå–å€¼èŒƒå›´ä¸º [0,200]ã€‚åªæœ‰å½“ MsgType ä¸º 200ï¼ˆè‡ªå®šä¹‰ç±»å‹ï¼‰æ—¶ï¼Œæ­¤å‚æ•°æ‰æœ‰æ„ä¹‰ã€‚
              MsgBody:
                type: string
                description: |
                  æ¶ˆæ¯å†…å®¹ã€‚
                  - å½“ MsgType ä¸º 1ï¼ˆæ–‡æœ¬ç±»å‹ï¼‰æˆ– 200ï¼ˆè‡ªå®šä¹‰ç±»å‹ï¼‰ï¼ŒMsgBody ä¸ºå‘é€æ¶ˆæ¯æ—¶ä¼ å…¥çš„æ¶ˆæ¯å†…å®¹ï¼Œå¼€å‘è€…å¯ç›´æ¥é˜…è¯»æ¶ˆæ¯å†…å®¹ã€‚
                  - å½“ MsgType ä¸ºä¸‹åˆ—ç±»å‹æ—¶ï¼ŒMsgBody ä¸º JSON å­—ç¬¦ä¸²ã€‚è¯·ä½¿ç”¨ URLDecode å¯¹æ­¤ JSON å­—ç¬¦ä¸²è§£ç ï¼Œå¹¶æŒ‰ç…§å¯¹åº”ç»“æ„è·å–æ¶ˆæ¯ä¸­å„å­—æ®µæ•°æ®ï¼š
                    - å½“ MsgType ä¸º 11ã€12ã€13ã€14ï¼ˆå¤šåª’ä½“æ¶ˆæ¯ï¼‰æ—¶ ï¼Œè¯·å‚è€ƒ MsgBody JSON å­—ç¬¦ä¸²è§£æç»“æœçš„å¤šåª’ä½“æ¶ˆæ¯å‚æ•°è¯´æ˜ã€‚
                    - å½“ MsgType ä¸º 10ï¼ˆç»„åˆæ¶ˆæ¯ï¼‰æ—¶ï¼Œè¯·å‚è€ƒ MsgBody JSON å­—ç¬¦ä¸²è§£æç»“æœçš„ç»„åˆæ¶ˆæ¯å‚æ•°è¯´æ˜ã€‚
                example: "è¿™æ˜¯ä¸€æ¡æ¶ˆæ¯"
                oneOf:
                  - $ref: '#/components/schemas/å¤šåª’ä½“æ¶ˆæ¯'
                  - $ref: '#/components/schemas/ç»„åˆæ¶ˆæ¯'
              MsgId:
                type: number
                description: æ¶ˆæ¯ IDï¼Œå¯å€Ÿæ­¤ç¡®å®šæ¶ˆæ¯çš„å”¯ä¸€æ€§ã€‚
                example: 971503777289036700
              MsgSeq:
                type: number
                description: æ¶ˆæ¯ Seqã€‚
                example: 1
              Payload:
                type: string
                description: æ¶ˆæ¯æ‰©å±•å­—æ®µã€‚
                example: "Payload"
              MsgTime:
                type: number
                description: æœåŠ¡ç«¯æ”¶åˆ°æ¶ˆæ¯çš„æ—¶é—´ï¼ŒUnix æ—¶é—´æˆ³ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼ˆmsï¼‰ã€‚
                example: 1705895412000
              IsEmpty:
                type: number
                description: |
                  æ˜¯å¦æ˜¯ç©ºæ¶ˆæ¯ã€‚
                  - 0ï¼šéç©ºã€‚
                  - 1ï¼šæ¶ˆæ¯è¢«åˆ é™¤æˆ–è€…å·²è¿‡æœŸã€‚
                  - 2ï¼šæ¶ˆæ¯è¢«æ’¤å›ã€‚
                example: 0
          example:
            - Sender: "user1"
              MsgType: 1
              MsgBody: "è¿™æ˜¯ä¸€æ¡æ¶ˆæ¯"
              MsgId: 971503777289036700
              MsgSeq: 1
              Payload: "Payload"
              MsgTime: 1705895412000
              IsEmpty: 0
    å¤šåª’ä½“æ¶ˆæ¯:
      type: object
      description: |
        å¤šåª’ä½“æ¶ˆæ¯ä½“ã€‚å½“ MsgType ä¸º 11ã€12ã€13ã€14ï¼ˆå¤šåª’ä½“æ¶ˆæ¯ï¼‰æ—¶ï¼ŒMsgBody ä¸º JSON å­—ç¬¦ä¸²ã€‚
        è¯·ä½¿ç”¨ URLDecode å¯¹æ­¤ JSON å­—ç¬¦ä¸²è§£ç ï¼Œå¹¶æŒ‰ç…§ä»¥ä¸‹ç»“æ„è·å–æ¶ˆæ¯ä¸­å„å­—æ®µæ•°æ®ã€‚
      required: [md5, file_name, file_size, download_url]
      properties:
        md5:
          type: string
          description: æ–‡ä»¶çš„ MD5 å€¼ã€‚
          example: "5d41402abc4b2a76b9719d911017c592"
        file_name:
          type: string
          description: æ–‡ä»¶åç§°ã€‚
          example: "image.jpg"
        file_size:
          type: string
          description: æ–‡ä»¶å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼ˆBï¼‰ã€‚
          example: "1024"
        download_url:
          type: string
          description: ä¸‹è½½åœ°å€ã€‚
          example: "https://example.com/download/image.jpg"
        media_duration:
          type: string
          description: éŸ³è§†é¢‘æ—¶é•¿ï¼Œå•ä½ä¸ºç§’ï¼ˆsï¼‰ã€‚
          example: "30"
        origin_image_width:
          type: integer
          description: ğŸï¸å¦‚æœæ˜¯å›¾ç‰‡æ¶ˆæ¯åˆ™åŒ…å«æ­¤å±æ€§ã€‚åŸå›¾çš„å®½åº¦ï¼Œå•ä½ä¸ºåƒç´ ï¼ˆpxï¼‰ã€‚
          example: 1920
        origin_image_height:
          type: integer
          description: ğŸï¸å¦‚æœæ˜¯å›¾ç‰‡æ¶ˆæ¯åˆ™åŒ…å«æ­¤å±æ€§ã€‚åŸå›¾çš„é«˜åº¦ï¼Œå•ä½ä¸ºåƒç´ ï¼ˆpxï¼‰ã€‚
          example: 1080
        large_image_download_url:
          type: string
          description: ğŸï¸å¦‚æœæ˜¯å›¾ç‰‡æ¶ˆæ¯åˆ™åŒ…å«æ­¤å±æ€§ã€‚å¤§å›¾ä¸‹è½½åœ°å€ã€‚
          example: "https://example.com/download/image_large.jpg"
        large_image_width:
          type: integer
          description: ğŸï¸å¦‚æœæ˜¯å›¾ç‰‡æ¶ˆæ¯åˆ™åŒ…å«æ­¤å±æ€§ã€‚å¤§å›¾çš„å®½åº¦ï¼Œå•ä½ä¸ºåƒç´ ï¼ˆpxï¼‰ã€‚
          example: 1920
        large_image_height:
          type: integer
          description: ğŸï¸å¦‚æœæ˜¯å›¾ç‰‡æ¶ˆæ¯åˆ™åŒ…å«æ­¤å±æ€§ã€‚å¤§å›¾çš„é«˜åº¦ï¼Œå•ä½ä¸ºåƒç´ ï¼ˆpxï¼‰ã€‚
          example: 1080
        thumbnail_download_url:
          type: string
          description: ğŸï¸å¦‚æœæ˜¯å›¾ç‰‡æ¶ˆæ¯åˆ™åŒ…å«æ­¤å±æ€§ã€‚ç¼©ç•¥å›¾ä¸‹è½½åœ°å€ã€‚
          example: "https://example.com/download/image_thumb.jpg"
        thumbnail_width:
          type: integer
          description: ğŸï¸å¦‚æœæ˜¯å›¾ç‰‡æ¶ˆæ¯åˆ™åŒ…å«æ­¤å±æ€§ã€‚ç¼©ç•¥å›¾çš„å®½åº¦ï¼Œå•ä½ä¸ºåƒç´ ï¼ˆpxï¼‰ã€‚
          example: 200
        thumbnail_height:
          type: integer
          description: ğŸï¸å¦‚æœæ˜¯å›¾ç‰‡æ¶ˆæ¯åˆ™åŒ…å«æ­¤å±æ€§ã€‚ç¼©ç•¥å›¾çš„é«˜åº¦ï¼Œå•ä½ä¸ºåƒç´ ï¼ˆpxï¼‰ã€‚
          example: 200
        video_first_frame_download_url:
          type: string
          description: ğŸ¬å¦‚æœæ˜¯è§†é¢‘æ¶ˆæ¯åˆ™åŒ…å«æ­¤å±æ€§ã€‚è§†é¢‘é¦–å¸§å›¾çš„ä¸‹è½½åœ°å€ã€‚
          example: "https://example.com/download/video_frame.jpg"
        video_first_frame_width:
          type: integer
          description: ğŸ¬å¦‚æœæ˜¯è§†é¢‘æ¶ˆæ¯åˆ™åŒ…å«æ­¤å±æ€§ã€‚è§†é¢‘é¦–å¸§å›¾çš„å®½åº¦ï¼Œå•ä½ä¸ºåƒç´ ï¼ˆpxï¼‰ã€‚
          example: 1920
        video_first_frame_height:
          type: integer
          description: ğŸ¬å¦‚æœæ˜¯è§†é¢‘æ¶ˆæ¯åˆ™åŒ…å«æ­¤å±æ€§ã€‚è§†é¢‘é¦–å¸§å›¾çš„é«˜åº¦ï¼Œå•ä½ä¸ºåƒç´ ï¼ˆpxï¼‰ã€‚
          example: 1080
    ç»„åˆæ¶ˆæ¯:
      type: object
      description: |
        ç»„åˆæ¶ˆæ¯ä½“ã€‚å½“ MsgType ä¸º 10ï¼ˆç»„åˆæ¶ˆæ¯ï¼‰æ—¶ï¼ŒMsgBody ä¸º JSON å­—ç¬¦ä¸²ã€‚
        è¯·ä½¿ç”¨ URLDecode å¯¹æ­¤ JSON å­—ç¬¦ä¸²è§£ç ï¼Œå¹¶æŒ‰ç…§ä»¥ä¸‹ç»“æ„è·å–æ¶ˆæ¯ä¸­å„å­—æ®µæ•°æ®ã€‚
      required: [multi_msg]
      properties:
        multi_msg:
          type: array
          description: ç»„åˆæ¶ˆæ¯ Item æ•°ç»„ã€‚
          items:
            type: object
            required: [msg_type]
            properties:
              msg_type:
                type: integer
                description: |
                  Item ç±»å‹ï¼š
                  - 1ï¼šæ–‡æœ¬ã€‚
                  - 11ï¼šå›¾ç‰‡ã€‚
                  - 12ï¼šæ–‡æ¡£ã€‚
                  - 13ï¼šéŸ³é¢‘ã€‚
                  - 14ï¼šè§†é¢‘ã€‚
                  - 200ï¼šè‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹ã€‚
                example: 1
              sub_msg_type:
                type: integer
                description: ä»…å½“ msg_type ä¸º 200 æ—¶ï¼Œè¿”å›æ­¤å‚æ•°ã€‚è¡¨ç¤ºå…·ä½“çš„è‡ªå®šä¹‰ç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º [0,200]ã€‚
                example: 0
              callback_content:
                type: string
                description: |
                  Item å†…å®¹ã€‚
                  - ä»…å½“ msg_type ä¸º 1 æˆ– 200 æ—¶ï¼Œå¯ç›´æ¥åœ¨æ­¤å‚æ•°é˜…è¯»æ¶ˆæ¯å†…å®¹ã€‚
                  - å½“ Item ä¸º 11ã€12ã€13 æˆ– 14ï¼Œè¯·å‚è€ƒæœ¬æ–‡ å¤šåª’ä½“æ¶ˆæ¯ç»“æ„ äº†è§£æ¶ˆæ¯çš„çš„å„ä¸ªå­—æ®µæ•°æ®ã€‚
                example: "è¿™æ˜¯ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯"


