openapi: 3.0.0
info:
  title: open-api-desc
  version: 1.0.0
  contact:
    name: ZEGO Support
    email: support@zegocloud.com

servers:
  $ref: '../shared-components.yaml#/servers'

paths:
  /:
    post:
      tags:
        - call-invitation
      summary: 发起呼叫邀请
      description: |
        通过该接口可以创建**普通模式**的呼叫邀请。

        呼叫邀请创建成功后，通过以下 ZIM SDK 的回调接口，发起邀请的用户（主叫）会收到邀请已创建的通知：

        | iOS-25% | Android-25% | macOS-25% | Windows-25% |
        |-----|---------|--------|---------|
        | [callInvitationCreated](https://doc-zh.zego.im/article/api?doc=zim_API~objective-c_ios~protocol~ZIMEventHandler#zim-call-invitation-created-call-id) | [onCallInvitationCreated](https://doc-zh.zego.im/article/api?doc=zim_API~java_android~class~ZIMEventHandler#on-call-invitation-created) | [callInvitationCreated](https://doc-zh.zego.im/article/api?doc=zim_API~objective-c_macos~protocol~ZIMEventHandler#zim-call-invitation-created-call-id) | [onCallInvitationCreated](https://doc-zh.zego.im/article/api?doc=zim_API~cpp_windows~class~ZIMEventHandler#on-call-invitation-created) |

        | Web-25% | 小程序-25% | Flutter-25% | React Native-25% |
        |-----|--------|---------|--------------|
        | [callInvitationCreated](https://doc-zh.zego.im/article/api?doc=zim_API~javascript_web~interface~ZIMEventHandler#call-invitation-created) | [callInvitationCreated](https://doc-zh.zego.im/article/api?doc=zim_API~javascript_wxxcx~interface~ZIMEventHandler#call-invitation-created) | [onCallInvitationCreated](https://pub.dev/documentation/zego_zim/latest/zego_zim/ZIMEventHandler/onCallInvitationCreated.html) | [callInvitationCreated](https://doc-zh.zego.im/article/api?doc=zim_API~javascript_react-native~interface~ZIMEventHandler#call-invitation-created) |

        | Unity3D-25% | uniapp \| uniapp x-25% | HarmonyOS-25% |
        |--------|--|--|
        | [onCallInvitationCreated](https://doc-zh.zego.im/article/api?doc=zim_API~cs_unity3d~class~ZIMEventHandler#on-call-invitation-created) |[callInvitationCreated](https://doc-zh.zego.im/article/api?doc=zim_API~javascript_uni-app~interface~ZIMEventHandler#call-invitation-created) | [callInvitationCreated](https://doc-zh.zego.im/article/api?doc=zim_API~javascript_harmony~interface~ZIMEventHandler#call-invitation-created) | 

        被邀请的用户（被叫）会收到被邀请的通知：

        | iOS-25% | Android-25% | macOS-25% | Windows-25% |
        |-----|---------|--------|---------|
        | [callInvitationReceived](https://doc-zh.zego.im/article/api?doc=zim_API~objective-c_ios~protocol~ZIMEventHandler#zim-call-invitation-received-call-id) | [onCallInvitationReceived](https://doc-zh.zego.im/article/api?doc=zim_API~java_android~class~ZIMEventHandler#on-call-invitation-received) | [callInvitationReceived](https://doc-zh.zego.im/article/api?doc=zim_API~objective-c_macos~protocol~ZIMEventHandler#zim-call-invitation-received-call-id) | [onCallInvitationReceived](https://doc-zh.zego.im/article/api?doc=zim_API~cpp_windows~class~ZIMEventHandler#on-call-invitation-received) |

        | Web-25% | 小程序-25% | Flutter-25% | React Native-25% |
        |-----|--------|---------|--------------|
        | [callInvitationReceived](https://doc-zh.zego.im/article/api?doc=zim_API~javascript_web~interface~ZIMEventHandler#call-invitation-received) | [callInvitationReceived](https://doc-zh.zego.im/article/api?doc=zim_API~javascript_wxxcx~interface~ZIMEventHandler#call-invitation-received) | [onCallInvitationReceived](https://pub.dev/documentation/zego_zim/latest/zego_zim/ZIMEventHandler/onCallInvitationReceived.html) | [callInvitationReceived](https://doc-zh.zego.im/article/api?doc=zim_API~javascript_react-native~interface~ZIMEventHandler#call-invitation-received) |

        | Unity3D-25% | uniapp \| uniapp x-25% | HarmonyOS-25% |
        |---------|---------|------------|
        | [OnCallInvitationReceived](https://doc-zh.zego.im/article/api?doc=zim_API~cs_unity3d~class~ZIMEventHandler#on-call-invitation-received) | [callInvitationReceived](https://doc-zh.zego.im/article/api?doc=zim_API~javascript_uni-app~interface~ZIMEventHandler#call-invitation-received) | [callInvitationReceived](https://doc-zh.zego.im/article/api?doc=zim_API~javascript_harmony~interface~ZIMEventHandler#call-invitation-received) |  |

        <Note title="说明">参数 `FromUserId` 和 `UserIds` 对应的用户已在客户端调用 `login` 方法登录 ZIM 服务，或开发者已调用 [服务端 API](/zim-server/user/batch-register-users) 注册相关的 userID。</Note>

        <Note title="说明">参数 FromUserId 和 UserIds 仅支持数字，英文字符和 '!'，'#'，'$'，'%'，'&'，'('，')'，'+'，'-'，':'，';'，'\<'，'='，'.'，'\>'，'?'，'@'，'['，']'，'^'，'_'，' '，'\{'，'\}'，'|'，'~'。</Note>

        <Note title="说明">调用频率限制：20 次/秒</Note>
      operationId: send-a-call-invitation
      parameters:
        - name: Action
          in: query
          description: |
            > 接口原型参数
            >
            > https://zim-api.zego.im/?Action=CallInvite
          required: true
          allowEmptyValue: false
          schema:
            type: string
            enum: [CallInvite]
          style: form
          explode: true
        - $ref: '../shared-components.yaml#/components/parameters/AppId'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureNonce'
        - $ref: '../shared-components.yaml#/components/parameters/Timestamp'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureVersion'
        - $ref: '../shared-components.yaml#/components/parameters/Signature'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CallInviteRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CallInviteResponse'

components:
  schemas:
    CallInviteRequest:
      type: object
      required: [FromUserId, UserIds, OfflinePush]
      properties:
        FromUserId:
          type: string
          description: |
            主叫用户 ID（已在客户端调用 `login` 方法登录 ZIM 服务，或已调用 [服务端 API](/zim-server/user/batch-register-users) 完成注册）。
          maxLength: 32
          example: "caller_user"
        UserIds:
          type: array
          description: |
            被叫用户列表，上限为 9 名用户。如需上调，请联系 ZEGO 技术支持。
          maxItems: 9
          items:
            type: string
            maxLength: 32
            example: "callee1"
          style: form
          explode: true
          example: ["callee1", "callee2"]
        Timeout:
          type: number
          description: 呼叫超时时间，单位为秒，取值范围为 (0, 600]。传 0 或为空取默认值 90。
          minimum: 0
          maximum: 600
          default: 90
          example: 90
        ExtendedData:
          type: string
          description: 扩展字段，长度上限为 2 KB。
          maxLength: 2048
          example: "Extended data"
        OfflinePush:
          type: object
          description: |
            离线推送配置，详情请参考 [MessageBody 说明 - OfflinePush 说明](https://doc-zh.zego.im/article/17609#offlinePush)。
          properties:
            Enable:
              type: integer
              description: 是否启用离线推送。1 表示启用，0 表示禁用。
              example: 1
            Title:
              type: string
              description: 离线推送展示的标题。
              example: "title"
            Content:
              type: string
              description: 离线推送展示的内容。
              example: "content"
            Payload:
              type: string
              description: 扩展字段，开发者可以自定义收到离线推送消息后的行为。
              example: "payload"

    CallInviteResponse:
      type: object
      properties:
        Code:
          type: integer
          description: |
            返回码。

            以下仅列出了接口业务逻辑相关的返回码，完整返回码请参考 [全局返回码](/zim-server/return-codes)。
            <table>
            <tbody><tr>
            <th>返回码</th>
            <th>说明</th>
            <th>处理建议</th>
            </tr>
            <tr>
            <td>660000002</td>
            <td>参数错误。</td>
            <td>请检查请求参数。</td>
            </tr>
            <tr>
            <td>660300005</td>
            <td>调用接口的频率超出了 AppID 级别限制。</td>
            <td>请稍后再试。</td>
            </tr>
            <tr>
            <td>660500002</td>
            <td>操作者用户未注册。</td>
            <td>请先让操作者用户注册 ZIM 服务。</td>
            </tr>
            <tr>
            <td>660900003</td>
            <td>所有被叫用户需为已注册。</td>
            <td>请检查被叫用户的注册状态或稍后再试。</td>
            </tr>
            <tr>
            <td>660900007</td>
            <td>被叫用户列表长度超过限制。</td>
            <td>请缩短被叫用户列表长度，或联系 ZEGO 技术支持上调上限。</td>
            </tr>
            </tbody></table>
          example: 0
        Message:
          type: string
          description: 操作结果描述。
          example: success
        RequestId:
          type: string
          description: 请求 ID。
          example: '343649807833778782'
        CallId:
           type: string
           description: 呼叫 ID。
           example: "12261423186766631832"
        CreateTime:
          type: number
          description: 呼叫邀请创建时间戳。
          example: 1713249504000
        ErrorUsers:
          type: array
          description: |
            邀请失败用户信息。

            Code 为 0：
            <ul>  
              <li>ErrorUsers 为空，向全部指定用户发起邀请成功。</li>
              <li>ErrorUsers 不为空，表示向部分指定用户发起邀请失败，请参考 SubCode 处理。</li>
            </ul>
            Code 不为 0：
            <ul>
              <li>ErrorUsers 为空，表示参数错误、接口频率限制、系统错误。</li>
              <li>ErrorUsers 不为空，表示向全部指定用户发起邀请失败。</li>
            </ul>
          items:
            type: object
            properties:
              UserId:
                type: string
                description: 失败用户 ID。
                example: "uid2"
              SubCode:
                type: number
                description: |
                  失败的具体返回码。
                  以下仅列出了接口业务逻辑相关的返回码，完整返回码请参考 [全局返回码](/zim-server/return-codes)。
                  <table>
                  <tbody><tr>
                  <th>返回码</th>
                  <th>说明</th>
                  <th>处理建议</th>
                  </tr>
                  <tr>
                  <td>660000002</td>
                  <td>参数错误。</td>
                  <td>请检查请求参数。</td>
                  </tr>
                  <tr>
                  <td>660300005</td>
                  <td>调用接口的频率超出了 AppID 级别限制。</td>
                  <td>请稍后再试。</td>
                  </tr>
                  <tr>
                  <td>660500002</td>
                  <td>操作者用户未注册。</td>
                  <td>请先让操作者用户注册 ZIM 服务。</td>
                  </tr>
                  <tr>
                  <td>660900003</td>
                  <td>所有被叫用户需为已注册。</td>
                  <td>请检查被叫用户的注册状态或稍后再试。</td>
                  </tr>
                  <tr>
                  <td>660900007</td>
                  <td>被叫用户列表长度超过限制。</td>
                  <td>请缩短被叫用户列表长度，或联系 ZEGO 技术支持上调上限。</td>
                  </tr>
                  </tbody></table>
                example: 660500002
