openapi: 3.0.0
info:
  title: open-api-desc
  version: 1.0.0
  contact:
    name: ZEGO Support
    email: support@zegocloud.com

servers:
  $ref: '../shared-components.yaml#/servers'

tags:
  - group

paths:
  /:
    post:
      tags: [group]
      summary: 修改群组属性
      description: |
        通过该接口可以设置某个群的群属性。

        <Note title="说明">调用频率限制：20 次/秒。</Note>
      operationId: modify-group-attributes
      parameters:
        - name: Action
          in: query
          description: |
            > 接口原型参数
            >
            > https://zim-api.zego.im/?Action=ModifyGroupAttribute
          required: true
          schema:
            type: string
            enum: [ModifyGroupAttribute]
          style: form
          explode: true
        - $ref: '../shared-components.yaml#/components/parameters/AppId'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureNonce'
        - $ref: '../shared-components.yaml#/components/parameters/Timestamp'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureVersion'
        - $ref: '../shared-components.yaml#/components/parameters/Signature'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ModifyGroupAttributeRequest'
            example:
              GroupId: "room123"
              FromUserId: "fromUserId"
              Action: 0
              Attributes:
                - Key: "attribute1"
                  Value: "value1"
                - Key: "attribute2"
                  Value: ""
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModifyGroupAttributeResponse'
              example:
                Code: 0
                Message: success
                RequestId: "req-123456789"
                FailKeys:
                  - Reason: "key db-non-existent"
                    Key: "attr1"
                  - Reason: "key db-non-existent"
                    Key: "attr2"
                Attributes:
                  Attributes:
                    - Key: "attribute1"
                      Value: "value1"
                    - Key: "attribute2"
                      Value: "value2"

components:
  schemas:
    ModifyGroupAttributeRequest:
      type: object
      required: [Action, FromUserId, GroupId, Attributes]
      properties:
        Action:
          type: number
          description: |
            本次请求的修改行为。
            - 0（默认）：更新群组属性。
            - 1：删除群组属性。
          example: 0
        FromUserId:
          type: string
          description: 操作者 id ，需要是已注册状态。
          example: "fromUserId"
        GroupId:
          type: string
          description: 群组 id。
          example: "room123"
        Attributes:
          type: array
          description: 更新的群组属性信息。
          items:
            type: object
            required: [Key]
            properties:
              Key:
                type: string
                description: |
                  群组属性key。修改群组属性时，如果群组属性 key 已经存在，则更新群组属性；如果群组属性 key 不存在，则创建群组属性。
                example: "attribute1"
              Value:
                type: string
                description: |
                  群组属性value。Action 为 0 时，需要此参数；Action 为 1 时，不需要此参数。
                example: "value1"
    ModifyGroupAttributeResponse:
      type: object
      properties:
        Code:
          type: number
          description: |
            返回状态码（0表示成功）。

            以下仅列出了接口业务逻辑相关的返回码，完整返回码请参考 [全局返回码](/zim-server/return-codes)。
            <table>
            <thead><tr><th>返回码</th><th>说明</th><th>处理建议</th></tr></thead>
            <tbody>
            <tr><td>660000002</td><td>参数错误。</td><td>请检查并输入正确的参数。</td></tr>
            <tr><td>660300006</td><td>调用接口的频率超出了群/房间限制。</td><td>请稍后再试。</td></tr>
            <tr><td>660500002</td><td>FromUserId 未注册。</td><td>请先注册 FromUserId。</td></tr>
            <tr><td>660600001</td><td>群组不存在。</td><td>请确认输入的 GroupId 是否正确，或创建群组。</td></tr>
            <tr><td>660600009</td><td>获取群组相关信息失败。</td><td>请先确认 GroupID 是否正确。如果 GroupID 正确，请联系 ZEGO 技术支持。</td></tr>
            <tr><td>660600028</td><td>修改群组资料失败。</td><td>请联系 ZEGO 技术支持。</td></tr>
            <tr><td>660300019</td><td>已设置的群组属性的value总长度超出限制</td><td>请联系 ZEGO 技术支持。</td></tr>
            </tbody>
            </table>
          example: 0
        Message:
          type: string
          description: 返回状态信息。
          example: "success"
        RequestId:
          type: string
          description: 请求唯一标识。
          example: "req-123456789"
        FailKeys:
          type: array
          description: 更新或者删除失败的 key 列表。
          items:
            type: object
            properties:
              Reason:
                type: string
                description: 失败原因。
                example: "key db-non-existent"
              Key:
                type: string
                description: 更新或者删除失败的 key 值。
                example: "attr1"
        Attributes:
          type: object
          description: 更新或者删除成功的群组属性列表。
          properties:
            Attributes:
              type: array
              items:
                type: object
                properties:
                  Key:
                    type: string
                    description: 群组属性 key。
                    example: "attribute1"
                  Value:
                    type: string
                    description: 群组属性 value。
                    example: "value1"

