openapi: 3.0.0
info:
  title: open-api-desc
  version: 1.0.0
  contact:
    name: ZEGO Support
    email: support@zegocloud.com

servers:
  $ref: '../shared-components.yaml#/servers'

tags:
  - user

paths:
  /:
    get:
      tags: [user]
      summary: Query blocklist
      description: |
        Paginate and retrieve all blocklist data based on user ID.

        <Note title="QPS Limit">20 times/s</Note>
      operationId: query-the-blocklist
      parameters:
        - name: Action
          in: query
          description: |
            > API prototype parameter
            >
            > https://zim-api.zego.im/?Action=QueryBlacklist
          required: true
          schema:
            type: string
            enum: [QueryBlacklist]
          style: form
          explode: true
        - $ref: '../shared-components.yaml#/components/parameters/AppId'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureNonce'
        - $ref: '../shared-components.yaml#/components/parameters/Timestamp'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureVersion'
        - $ref: '../shared-components.yaml#/components/parameters/Signature'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryBlacklistRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryBlacklistResponse'
              example:
                Code: 0
                Message: success
                RequestId: "343649807833778782"
                TotalCount: 500
                Next: 1
                Blacklist:
                  - UserId: "usera1"
                    UserName: "Nicknamea1"
                    Avatar: "Avatar1"
                    UpdateTime: 1698310534000
                  - UserId: "usera2"
                    UserName: "Nicknamea2"
                    Avatar: "Avatar2"
                    UpdateTime: 1698310534000

components:
  schemas:
    QueryBlacklistRequest:
      type: object
      required: [FromUserId, Limit, Next]
      properties:
        FromUserId:
          type: string
          description: Query the blocklist of this UserID (who has logged in to the ZIM service by calling the login method on the client, or has completed registration by calling the [server-side API](/zim-server/user/batch-register-users)).
          maxLength: 32
          example: "zego"
        Limit:
          type: number
          description: How many users' information to retrieve at a time. Value range is [0, 100]. If not filled in or the value is 0 or greater than 100, the value is 100.
          minimum: 0
          maximum: 100
          example: 100
        Next:
          type: number
          description: |
            Pagination flag. Fill in 0 for the first time, and then fill in the Next value returned last time. When the returned Next is 0, it means the blocklist retrieval is complete.

            For example, if FromUserId has blocked 250 users, when calling this API to query:

            - First call: Limit is 100, Next is empty, query users 1 ~ 100; the Next value in the returned result is num1.
            - Second call: Limit is 100, Next is num1, query users 101 ~ 200; the Next value in the returned result is num2.
            - Third call: Limit is 100, Next is num2, query users 201 ~ 250; query is complete, the Next in the returned result is 0.
          example: 2
    BlackItem:
      type: object
      properties:
        UserId:
          type: string
          description: User ID.
          example: "usera1"
        UserName:
          type: string
          description: User name.
          example: "Nicknamea1"
        Avatar:
          type: string
          description: User avatar URL.
          example: "Avatar1"
        UpdateTime:
          type: number
          description: Block time in milliseconds (ms).
          example: 1698310534000
    QueryBlacklistResponse:
      type: object
      properties:
        Code:
          type: integer
          description: |
            Return code.

            <table>
            <tbody><tr>
            <th>Return Code</th>
            <th>Description</th>
            <th>Suggested Solution</th>
            </tr>
            <tr>
            <td>660000002</td>
            <td>Parameter error.</td>
            <td>Please check the request parameters.</td>
            </tr>
            <tr>
            <td>660300005</td>
            <td>The API call frequency exceeds the AppID-level limit.</td>
            <td>Please try again later.</td>
            </tr>
            <tr>
            <td>660500002</td>
            <td>FromUserId is not registered.</td>
            <td>Please confirm whether the user is registered:<br/>If confirmed registered, please contact ZEGOCLOUD Technical Support for troubleshooting.<br/>If confirmed not registered, please register this user.</td>
            </tr>
            <tr>
            <td>660800001</td>
            <td>FromUserId is not registered.</td>
            <td>Please confirm whether the user is registered:<br/>If confirmed registered, please contact ZEGOCLOUD Technical Support for troubleshooting.<br/>If confirmed not registered, please register this user.</td>
            </tr>
            </tbody></table>
          example: 0
        Message:
          type: string
          description: Description of the request result.
          example: "success"
        RequestId:
          type: string
          description: Request ID.
          example: "343649807833778782"
        TotalCount:
          type: integer
          format: int32
          description: Total number of current blocklist users.
          example: 500
        Next:
          type: number
          description: |
            Pagination flag. Non-zero means there is still blocklist information not returned, and this field needs to be set in the request parameter Next to retrieve more blocklist information; 0 means all blocklist information has been returned.
            >**Note**
            >
            > In addition to the above description, this field has no association with the list information. Do not make any other logic based on this.
          example: 1
        Blacklist:
          type: array
          description: Blocklist data list.
          items:
            $ref: '#/components/schemas/BlackItem'
