openapi: 3.0.0
info:
  title: open-api-desc
  version: 1.0.0
  contact:
    name: ZEGO Support
    email: support@zegocloud.com
servers:
  $ref: '../shared-components.yaml#/servers'
tags:
  - user
paths:
  /:
    post:
      tags: [user]
      summary: Batch register users
      description: |
        Backend registration. Developers can use this API to batch register IM accounts for users to enable message reception, so that users can receive historical messages after logging in to ZIM. Commonly used in education scenarios.

        <Note title="QPS Limit">  20 times/s</Note>
      operationId: batch-register-users
      parameters:
        - name: Action
          in: query
          description: |
            > API prototype parameter
            >
            > https://zim-api.zego.im/?Action=UserRegister
          required: true
          schema:
            type: string
            enum: [UserRegister]
          style: form
          explode: true
        - $ref: '../shared-components.yaml#/components/parameters/AppId'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureNonce'
        - $ref: '../shared-components.yaml#/components/parameters/Timestamp'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureVersion'
        - $ref: '../shared-components.yaml#/components/parameters/Signature'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegisterRequest'
            example:
              UserInfo:
                - UserId: "aaa"
                  UserName: "userNamea"
                  UserAvatar: "http"
                - UserId: "bbb"
                  UserName: "userNameb"
                  UserAvatar: "http"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRegisterResponse'
components:
  schemas:
    UserRegisterRequest:
      type: object
      required: [UserInfo]
      properties:
        UserInfo:
          type: array
          description: User information. A maximum of 100 users can be registered at a time.
          maxItems: 100
          items:
            type: object
            required: [UserId]
            properties:
              UserId:
                type: string
                description: |
                  User ID, with a maximum length of 32 bytes.

                  >**Note**
                  >
                  > UserIds Only supports numbers, English characters, and '!'，'#'，'$'，'%'，'&'，'('，')'，'+'，'-'，':'，';'，'<'，'='，'.'，'>'，'?'，'@'，'['，']'，'^'，'_'，' '，'{'，'}'，'|'，'~'。
                maxLength: 32
                example: "aaa"
              UserName:
                type: string
                description: User name, with a maximum length of 256 bytes.
                maxLength: 256
                example: "userNamea"
              UserAvatar:
                type: string
                description: 用户头像地址，with a maximum length of 500 bytes。
                maxLength: 500
                example: "http"
    UserRegisterResponse:
      type: object
      properties:
        Code:
          type: integer
          description: |
            Return code.

            以下仅列出了接口业务逻辑相关的 Code 和 SubCode ，完整返回码请参考 [全局返回码](/zim-server/return-codes)。
            > **Note**
            >
            > 当您发起请求同时注册多个用户时：
            > <ul><li>如果有 1 个或以上的用户 ID 注册成功，Code 都会返回 0。此时请参考 ErrorList 中的具体信息，确认操作结果。</li>
            > <li>如果全部用户注册失败，Code 会返回相关返回码，具体请参考 <a href="/zim-server/return-codes" target="_blank">全局返回码</a>。</li></ul>

            <table>
            <tbody><tr>
            <th>Code / SubCode</th>
            <th>描述</th>
            <th>可能原因</th>
            <th>Suggested Solution</th>
            </tr>
            <tr>
            <td>660000001</td>
            <td>业务类通用错误。</td>
            <td>服务端出错。</td>
            <td>请重试，或联系 ZEGOCLOUD Technical Support。</td>
            </tr>
            <tr>
            <td>660000002</td>
            <td>Input parameter error。</td>
            <td>输入的参数缺失或不合法。</td>
            <td>Please check the input parameters。</td>
            </tr>
            <tr>
            <td>660000012</td>
            <td>UserID 长度超过限制。</td>
            <td>UserID 最大长度为 32 bytes。</td>
            <td>请确认 UserID 的长度。</td>
            </tr>
            <tr>
            <td>660700001</td>
            <td>请求过于频繁。</td>
            <td>发起请求频率超过 20 times/s。</td>
            <td>请稍后再试。</td>
            </tr>
            <tr>
            <td>660700002</td>
            <td>用户已存在。</td>
            <td>发送请求的 UserID 已存在。</td>
            <td>请避免重复注册相同的 UserID。</td>
            </tr>
            <tr>
            <td>660700006</td>
            <td>UserName 长度超过限制。</td>
            <td>UserName 长度最大为 256 bytes。</td>
            <td>请确认 UserName 的长度。</td>
            </tr>
            <tr>
            <td>660700007</td>
            <td>UserAvatar 地址长度超过限制。</td>
            <td>UserAvatar 地址长度最大为 500 bytes。</td>
            <td>请确认 UserAvatar 的长度。</td>
            </tr>
            </tbody></table>
          example: 0
        Message:
          type: string
          description: Description of the request result.
          example: "success"
        RequestId:
          type: string
          description: Request ID.
          example: "343649807833778782"
        ErrorList:
          type: array
          description: |
            失败信息列表。
            <ul>
            <li>Code 为 0：</li>
            <li>  ErrorList 为空，全部用户注册成功。</li>
            <li>  ErrorList 不为空，表示部分用户注册失败，请参考 SubCode、SubMessage 处理。</li>
            <li>Code 不为 0：</li>
            <li>  ErrorList 为空，表示参数错误、接口频率限制、系统错误。</li>
            <li>  ErrorList 不为空，表示所有用户都注册失败，全部都是已经存在的用户。</li>
            </ul>
          items:
            type: object
            properties:
              UserId:
                type: string
                description: 注册失败的 UserID。
                example: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
              SubCode:
                type: number
                description: |
                  用户注册失败的具体返回码，完整返回码请参考 Code 说明或者 [全局返回码](/zim-server/return-codes)。
                example: 660000012
              SubMessage:
                type: string
                description: 用户注册失败的原因说明。
                example: "user length limit"
