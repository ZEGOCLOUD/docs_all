openapi: 3.0.0
info:
  title: open-api-desc
  version: 1.0.0
  contact:
    name: ZEGO Support
    email: support@zegocloud.com
servers:
  $ref: '../shared-components.yaml#/servers'
tags:
  - user
paths:
  /:
    post:
      tags: [user]
      summary: Batch register users
      description: |
        Backend registration. Developers can use this API to batch register IM accounts for users to enable message reception, so that users can receive historical messages after logging in to ZIM. Commonly used in education scenarios.

        <Note title="QPS Limit">  20 times/s</Note>
      operationId: batch-register-users
      parameters:
        - name: Action
          in: query
          description: |
            > API prototype parameter
            >
            > https://zim-api.zego.im/?Action=UserRegister
          required: true
          schema:
            type: string
            enum: [UserRegister]
          style: form
          explode: true
        - $ref: '../shared-components.yaml#/components/parameters/AppId'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureNonce'
        - $ref: '../shared-components.yaml#/components/parameters/Timestamp'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureVersion'
        - $ref: '../shared-components.yaml#/components/parameters/Signature'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegisterRequest'
            example:
              UserInfo:
                - UserId: "aaa"
                  UserName: "userNamea"
                  UserAvatar: "http"
                - UserId: "bbb"
                  UserName: "userNameb"
                  UserAvatar: "http"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRegisterResponse'
components:
  schemas:
    UserRegisterRequest:
      type: object
      required: [UserInfo]
      properties:
        UserInfo:
          type: array
          description: User information. A maximum of 100 users can be registered at a time.
          maxItems: 100
          items:
            type: object
            required: [UserId]
            properties:
              UserId:
                type: string
                description: |
                  User ID, with a maximum length of 32 bytes.

                  >**Note**
                  >
                  > UserIds Only supports numbers, English characters, and '!'，'#'，'$'，'%'，'&'，'('，')'，'+'，'-'，':'，';'，'<'，'='，'.'，'>'，'?'，'@'，'['，']'，'^'，'_'，' '，'{'，'}'，'|'，'~'。
                maxLength: 32
                example: "aaa"
              UserName:
                type: string
                description: User name, with a maximum length of 256 bytes.
                maxLength: 256
                example: "userNamea"
              UserAvatar:
                type: string
                description: User avatar URL, with a maximum length of 500 bytes.
                maxLength: 500
                example: "http"
    UserRegisterResponse:
      type: object
      properties:
        Code:
          type: integer
          description: |
            Return code.

            The following only lists the Code and SubCode related to the API business logic. For complete return codes, please refer to [Global Return Codes](/zim-server/return-codes).
            > **Note**
            >
            > When you initiate a request to register multiple users at the same time:
            > <ul><li>If 1 or more user IDs are successfully registered, Code will return 0. In this case, please refer to the specific information in ErrorList to confirm the operation result.</li>
            > <li>If all users fail to be registered, Code will return the relevant return code. For details, please refer to <a href="/zim-server/return-codes" target="_blank">Global Return Codes</a>.</li></ul>

            <table>
            <tbody><tr>
            <th>Code / SubCode</th>
            <th>Description</th>
            <th>Possible Cause</th>
            <th>Suggested Solution</th>
            </tr>
            <tr>
            <td>660000001</td>
            <td>General business error.</td>
            <td>Server error.</td>
            <td>Please retry or contact ZEGOCLOUD Technical Support.</td>
            </tr>
            <tr>
            <td>660000002</td>
            <td>Input parameter error。</td>
            <td>Input parameters are missing or invalid.</td>
            <td>Please check the input parameters。</td>
            </tr>
            <tr>
            <td>660000012</td>
            <td>UserID length exceeds the limit.</td>
            <td>The maximum length of UserID is 32 bytes.</td>
            <td>Please confirm the length of UserID.</td>
            </tr>
            <tr>
            <td>660700001</td>
            <td>Requests are too frequent.</td>
            <td>Request frequency exceeds 20 times/s.</td>
            <td>Please try again later.</td>
            </tr>
            <tr>
            <td>660700002</td>
            <td>User already exists.</td>
            <td>The UserID of the request already exists.</td>
            <td>Please avoid registering the same UserID repeatedly.</td>
            </tr>
            <tr>
            <td>660700006</td>
            <td>UserName length exceeds the limit.</td>
            <td>The maximum length of UserName is 256 bytes.</td>
            <td>Please confirm the length of UserName.</td>
            </tr>
            <tr>
            <td>660700007</td>
            <td>UserAvatar URL length exceeds the limit.</td>
            <td>The maximum length of UserAvatar URL is 500 bytes.</td>
            <td>Please confirm the length of UserAvatar.</td>
            </tr>
            </tbody></table>
          example: 0
        Message:
          type: string
          description: Description of the request result.
          example: "success"
        RequestId:
          type: string
          description: Request ID.
          example: "343649807833778782"
        ErrorList:
          type: array
          description: |
            Failure information list.
            <ul>
            <li>Code is 0:</li>
            <li>ErrorList is empty, all users are successfully registered.</li>
            <li>ErrorList is not empty, indicating that some users failed to register. Please refer to SubCode and SubMessage for processing.</li>
            <li>Code is not 0:</li>
            <li>ErrorList is empty, indicating parameter error, API frequency limit, or system error.</li>
            <li>ErrorList is not empty, indicating that all users failed to register and all are existing users.</li>
            </ul>
          items:
            type: object
            properties:
              UserId:
                type: string
                description: UserID that failed to register.
                example: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
              SubCode:
                type: number
                description: |
                  Specific return code for user registration failure. For complete return codes, please refer to the Code description or [Global Return Codes](/zim-server/return-codes).
                example: 660000012
              SubMessage:
                type: string
                description: Reason for user registration failure.
                example: "user length limit"
