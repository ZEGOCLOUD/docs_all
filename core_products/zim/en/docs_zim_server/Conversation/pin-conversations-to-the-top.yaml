openapi: 3.0.0
info:
  title: open-api-desc
  version: 1.0.0
  contact:
    name: ZEGO Support
    email: support@zegocloud.com

servers:
  $ref: '../shared-components.yaml#/servers'

tags:
  - conversation

paths:
  /:
    post:
      tags: [conversation]
      summary: Pin conversations to the top
      description: |
        By calling this API, you can batch pin or unpin up to 20 conversations for users. If you need to increase this limit, please contact ZEGOCLOUD Technical Support.

        The client will receive changes in the pin status of conversations through the following ZIM SDK callback:

        | iOS-25% | Android-25% | macOS-25% | Windows-25% |
        |-----|---------|-------|---------|
        | [conversationChanged](https://www.zegocloud.com/docs/api?doc=zim_API~objective-c_ios~protocol~ZIMEventHandler#zim-group-member-info-updated-operated-info-group-id) | [onConversationChanged](https://www.zegocloud.com/docs/api?doc=zim_API~java_android~class~ZIMEventHandler#on-conversation-changed) | [conversationChanged](https://www.zegocloud.com/docs/api?doc=zim_API~objective-c_macos~protocol~ZIMEventHandler#zim-group-member-info-updated-operated-info-group-id) | [onConversationChanged](https://www.zegocloud.com/docs/api?doc=zim_API~cpp_windows~class~ZIMEventHandler#on-conversation-changed) |

        | Web-25% | Mini Program-25% | Flutter-25% | React Native-25% |
        |-----|---------|-------|---------|
        |[conversationChanged](https://www.zegocloud.com/docs/api?doc=zim_API~javascript_web~interface~ZIMEventHandler#conversation-changed) |[conversationChanged](https://www.zegocloud.com/docs/api?doc=zim_API~javascript_wxxcx~interface~ZIMEventHandler#conversation-changed) | [onConversationChanged](https://pub.dev/documentation/zego_zim/latest/zego_zim/ZIMEventHandler/onConversationChanged.html) | [conversationChanged](https://www.zegocloud.com/docs/api?doc=zim_API~javascript_react-native~interface~ZIMEventHandler#conversation-changed) |

        | Unity3D-25% |  uni-app \| uni-app x-25% |HarmonyOS-25% |
        |-----|---------|-------|
        | [OnConversationChanged](https://www.zegocloud.com/docs/api?doc=zim_API~cs_unity3d~class~ZIMEventHandler#on-conversation-changed) |[conversationChanged](https://www.zegocloud.com/docs/api?doc=zim_API~javascript_uni-app~interface~ZIMEventHandler#conversation-changed) | [conversationChanged](https://www.zegocloud.com/docs/api?doc=zim_API~javascript_harmony~interface~ZIMEventHandler#conversation-changed) |

        <Note title="QPS Limit"> 20 times/s</Note>
      operationId: pin-conversations-to-the-top
      parameters:
        - name: Action
          in: query
          description: |
            > API prototype parameter
            >
            > https://zim-api.zego.im/?Action=ConvPinned
          required: true
          schema:
            type: string
            enum: [ConvPinned]
          style: form
          explode: true
        - $ref: '../shared-components.yaml#/components/parameters/AppId'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureNonce'
        - $ref: '../shared-components.yaml#/components/parameters/Timestamp'
        - $ref: '../shared-components.yaml#/components/parameters/SignatureVersion'
        - $ref: '../shared-components.yaml#/components/parameters/Signature'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConvPinnedRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConvPinnedResponse'

components:
  schemas:
    ConvPinnedRequest:
      type: object
      required: [FromUserId, ConvList, PinnedType]
      properties:
        FromUserId:
          type: string
          description: |
            Set the pin status of conversations for this UserID (who has logged in to the ZIM service by calling the login method on the client, or has completed registration by calling the [server-side API](/zim-server/user/batch-register-users)).

            > **Note**
            >
            > FromUserId only supports numbers, English characters, and "'!', '#', '$', '%', '&', '(', ')', '+', '-', ':', ';', '<', '=', '.', '>', '?', '@', '[', ']', '^', '_', ' ', '{', '}', '|', '~'".
          maxLength: 32
          example: "user0"
        ConvList:
          type: array
          description: Conversation list, default length limit is 20.
          maxItems: 20
          items:
            type: object
            required: [ConvId, ConvType]
            properties:
              ConvId:
                type: string
                description: |
                  Conversation ID.
                  - For one-on-one chats, conversationID is the userID of the peer user (who has logged in to the ZIM service by calling the login method on the client, or has completed registration by calling the [server-side API](/zim-server/user/batch-register-users)).
                  - For group chats, conversationID is the groupID of the group.
                maxLength: 32
                example: "user1"
              ConvType:
                type: number
                description: |
                  Conversation type:
                  - 0: One-on-one conversation.
                  - 2: Group conversation.
                enum: [0, 2]
                example: 0
          example:
            - ConvId: "user1"
              ConvType: 0
            - ConvId: "user2"
              ConvType: 0
        PinnedType:
          type: number
          description: |
            Pin operation:
            - 0: Unpin.
            - 1: Pin.
          enum: [0, 1]
          example: 1
    ConvPinnedResponse:
      type: object
      properties:
        Code:
          type: number
          description: |
            Return code.

            The following only lists the Code and SubCode related to the API business logic. For the complete return codes, please refer to [Return codes](/zim-server/return-codes).
            > **Note**
            >
            > When you request to modify the pin status of multiple conversations:
            > <ul><li>As long as the status of 1 or more conversations is successfully modified, Code will return 0, indicating success. In this case, please refer to the specific information in ErrorList to understand the details of failed conversation status modifications.</li>
            > <li>If the status of all conversations fails to be modified, Code will return the relevant return code. For details, please refer to <a href="/zim-server/return-codes" target="_blank">Return codes</a>.</li></ul>
            <table>
            <thead><tr><th>Code / SubCode</th><th>Description</th><th>Suggested Solution</th></tr></thead>
            <tbody>
            <tr><td>660000001</td><td>General business error.</td><td>Please retry or contact ZEGOCLOUD Technical Support.</td></tr>
            <tr><td>660000002</td><td>Input parameter error.</td><td>Please check the input parameters.</td></tr>
            <tr><td>660300005</td><td>The API call frequency exceeds the AppID-level limit.</td><td>Please try again later.</td></tr>
            <tr><td>660500002</td><td>FromUserId is not registered.</td><td>Please register FromUserId first.</td></tr>
            <tr><td>660800001</td><td>When pinning a one-on-one conversation, the user corresponding to the target conversation ConvID is not registered.</td><td>Please confirm if the user corresponding to this ConvId is registered: <ul><li>If confirmed registered, please contact ZEGOCLOUD Technical Support for troubleshooting.</li><li>If confirmed not registered, please register this user.</li></ul></td></tr>
            <tr><td>660800048</td><td>Pin list length exceeds the limit (100, not configurable).</td><td>No action needed.</td></tr>
            </tbody>
            </table>
        Message:
          type: string
          description: Description of the request result.
          example: "success"
        RequestId:
          type: string
          description: Request ID.
          example: "343649807833778782"
        ErrorList:
          type: array
          description: |
            Failure list.
            - When Code is 0:
              - If ErrorList is empty, the pin status of all conversations has been successfully modified.
              - If ErrorList is not empty, it means the pin status modification of some conversations failed. Please refer to SubCode and SubMessage for handling.
            - When Code is not 0:
              - If ErrorList is empty, it indicates parameter error, API frequency limit, or system error.
              - If ErrorList is not empty, it means the pin status modification of all conversations failed.
          items:
            type: object
            properties:
              ConvId:
                type: string
                description: Conversation ID for which the pin status modification failed.
                example: "user1"
              ConvType:
                type: number
                description: Conversation type.
                example: 0
              SubCode:
                type: number
                description: |
                  Specific error code for the failed pin status modification. For the complete return codes, please refer to the Code description or [Return codes](/zim-server/return-codes).
                example: 660000002
              SubMessage:
                type: string
                description: Specific error description.
                example: "input params error"
          example:
            - ConvId: "user1"
              ConvType: 0
              SubCode: 660000002
              SubMessage: "input params error"
