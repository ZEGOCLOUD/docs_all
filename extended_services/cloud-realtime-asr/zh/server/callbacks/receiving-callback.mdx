
import Content from '/snippets/Reuse/SignatureVerificationZH.mdx'

# 接收回调


<Warning title="注意">回调服务不能保证完全可靠，请慎重考虑使用回调方案构建核心业务流程的风险。</Warning>

通过本回调，您可以监听实时语音识别过程中所发生的事件，包含 ASR 结果、异常事件。

<Warning title="注意">请确保您已参考 [开始任务](./../api-reference/start.mdx) 接口成功开启了实时语音识别任务。</Warning>

## 回调说明

- 请求方法：POST。
    <Note title="说明">回调数据格式为 JSON。您需要对其进行 UrlDecode 解码.</Note>
- 请求地址：请提供您业务后台用于接收回调的地址并联系 ZEGO 技术支持配置。
- 传输协议：HTTPS/HTTP，建议使用 HTTPS。

## 回调参数

<Note title="说明">回调的相关参数，ZEGO 会在之后的迭代计划中，持续优化更新（例如：新增字段、或新增某些字段的参数取值）。开发者在接入时，请避免将代码写死，造成后期更新后，无法兼容新版本。</Note>

| 参数 | 类型 | 描述 |
|------|------|------|
| AppId | Number | ZEGO 给开发者 APP 的唯一标识。 |
| Event | String | 事件通知类型。<ul><li>ASRResult：ASR 结果。</li><li>TranslationResult：翻译结果。</li><li>Exception：异常事件。</li></ul> |
| Nonce | String | 随机数，用于检验串计算。 |
| Timestamp | Number | 回调发送时的 Unix 时间戳（毫秒），用于检验串计算。 |
| Signature | String | 检验串，验证回调发送方身份。 |
| TaskId | String | 任务的唯一标识，全局唯一。 |
| RoomId | String | 房间 ID。 |
| Data | Object | 事件详细信息。根据 Event 取值不同，该回调参数的成员不同。 |

### Data

**根据 `Event` 取值不同，Data 包含的参数不同。**

<Tabs>
<Tab title="Event 为 ASRResult">
| 参数    | 类型   | 描述                                                                 |
|---------|--------|----------------------------------------------------------------------|
| UserId  | String | 讲话人的 UserId                                                      |
|StreamId|String|流的唯一标识|
| Round   | Int64  | 对话轮次，每次用户主动说话，轮次增加。保证有序性，不保证连续性。      |
| Text    | String | 文本内容                                                             |
</Tab>
<Tab title="Event 为 TranslationResult">
| 参数    | 类型   | 描述                                                                 |
|---------|--------|----------------------------------------------------------------------|
| UserId  | String | 讲话人的 UserId                                                  |
|StreamId|String|流的唯一标识|
| Round   | Int64  | 对话轮次，每次用户主动说话，轮次增加。保证有序性，不保证连续性。    |
| Text    | String | 翻译结果文本                                                     |
</Tab>
<Tab title="Event 为 Exception">
| 参数    | 类型   | 描述                                                                                                                                                                                                                      |
|---------|--------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Code    | Int    | 事件码：请参考 [异常事件错误码](./exception-codes.mdx) |
| Message | String | 异常信息描述                                                                                                                                                                                                            |
</Tab>
</Tabs>


## 回调示例

以下展示各 `Event` 的回调示例。

<Tabs>
<Tab title="Event 为 ASRResult">
```json
{
    "AppId": 1285661813,
    "Data": {
        "Round": 67202235,
        "Text": "你好，我是即构实时语音识别服务",
        "UserId": "abcd123"
    },
    "Event": "ASRResult",
    "Nonce": "7503829353462121337",
    "RoomId": "111",
    "Signature": "bc457c45e23c1026afdb6dae93f702ccffad4182",
    "TaskId": "1922184164614877184",
    "Timestamp": 1747121418250
}
```
</Tab>
<Tab title="Event 为 TranslationResult">
```json
{
    "AppId": 1285661813,
    "Data": {
        "Round": 67202235,
        "Text": "Hello, I am Zego Real-time Speech Recognition Service",
        "UserId": "abcd123"
    },
    "Event": "TranslationResult",
    "Nonce": "7503829353462121337",
    "RoomId": "111",
    "Signature": "bc457c45e23c1026afdb6dae93f702ccffad4182",
    "TaskId": "1922184164614877184",
    "Timestamp": 1747121418250
}
```
</Tab>
<Tab title="Event 为 Exception">
```json

{
    "AppId": 1285661813,
    "Data": {
        "Code": 1001,
        "Message": "通用错误"
    },
    "Event": "Exception",
    "Nonce": "7503829353462121337",
    "RoomId": "111",
    "Signature": "bc457c45e23c1026afdb6dae93f702ccffad4182",
    "TaskId": "1922184164614877184",
    "Timestamp": 1747121418250
}
```
</Tab>
</Tabs>

## 验证签名

<Content />
## 返回响应

当您收到回调后，请返回 HTTP status code 为 2XX （例如 200），表示接收成功。返回其他，都表示接收失败。


## 回调重试策略

如果 ZEGO 服务器没有收到响应，或收到的 HTTP status code 不为 2XX（例如 200），都会尝试重试，**最多进行 5 次重试**。每次重试请求与**上一次请求**的间隔时间分别为 2s、4s、8s、16s、32s。若第 5 次重试后仍然失败，将不再重试，该回调丢失。
