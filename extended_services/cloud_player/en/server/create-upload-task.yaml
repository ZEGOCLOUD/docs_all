openapi: 3.0.0
info:
  title: open-api-desc
  version: 1.0.0
  contact:
    name: ZEGO Support
    email: support@zegocloud.com

servers:
  $ref: './shared-components.yaml#/servers'

paths:
  /:
    post:
      tags:
        - upload
      summary: CreateUploadTask
      description: |
        Create an upload task to upload URL online resources to OSS. After uploading, cloud player clusters in the same region can obtain playback resources through the internal network stream URL, ensuring the stability of the resource transmission process.

        <Note title="Note">
        This feature is a value-added service. If you need to use it, please contact ZEGOCLOUD sales personnel to activate it.
        </Note>

        <Note title="Note">
        For a single AppID, ZEGOCLOUD server can process a maximum of 10 upload tasks simultaneously (including uploading and waiting). If you need to increase the limit, please contact ZEGOCLOUD Technical Support to modify it.
        </Note>

        <Note title="Note">Call frequency limit: 20 times/second</Note>
      operationId: create-upload-task
      parameters:
        - name: Action
          in: query
          description: |
            > API prototype parameter
            >
            > https://cloud-player-api.zego.im?Action=CreateUploadTask
          required: true
          allowEmptyValue: false
          schema:
            type: string
            enum: [CreateUploadTask]
          style: form
          explode: true
        - $ref: './shared-components.yaml#/components/parameters/AppId'
        - $ref: './shared-components.yaml#/components/parameters/SignatureNonce'
        - $ref: './shared-components.yaml#/components/parameters/Timestamp'
        - $ref: './shared-components.yaml#/components/parameters/SignatureVersion'
        - $ref: './shared-components.yaml#/components/parameters/Signature'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - Title
                - StreamUrl
              properties:
                Title:
                  type: string
                  maxLength: 100
                  description: |
                    File name, with a maximum length of 100B. The file extension (supports `.mp3`, `.mp4`, `.flv`, `.wav`, `.aac`, and `.flac`) must be retained and correct, otherwise playback may fail.
                    > **Warning**
                    >
                    > Do not use the same file name. If multiple files have the same Title, they will replace each other, and only the last uploaded file will be retained. However, the new file may inherit the expiration time of the old file.
                  example: "your-title.mp4"
                StreamUrl:
                  type: string
                  maxLength: 1024
                  description: The address of the media resource, which must be a valid HTTP/HTTPS address with a length within 1024 bytes. The file size limit is 5GB.
                  example: "https://xxx.com/video/test.mp4"
                RetentionDays:
                  type: number
                  minimum: 1
                  maximum: 7
                  default: 3
                  description: |
                    Resource validity period, unit is days. Valid value range is [1, 7], (default value: 3). If you need to increase the limit, please contact ZEGOCLOUD Technical Support for assistance.
                  example: 3
                ContentMd5:
                  type: string
                  description: |
                    ContentMd5 is the hash value generated by calculating the file through the MD5 algorithm, and then Base64 encoded, used to verify whether the file maintains integrity during the upload process.

                    If you provide the ContentMd5 parameter when uploading, ZEGOCLOUD server will calculate the ContentMd5 of the file through OSS and compare it with the value you provided. If the two are inconsistent, the upload will fail, indicating that the file may have been tampered with or damaged.

                    To ensure the integrity and security of the file, it is strongly recommended to pass in the ContentMd5 parameter when uploading files.


                    The following is an example of generating ContentMd5 using PHP:
                    ```PHP
                    function calculateMD5($content) {
                        return base64_encode(md5($content, true));
                    }
                    ```
                  example: "0uyh0doi++pDCwZkI0VEfA=="
              example:
                Title: "your-title.mp4"
                StreamUrl: "https://xxx.com/video/test.mp4"
                RetentionDays: 3
                ContentMd5: "0uyh0doi++pDCwZkI0VEfA=="
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  Code:
                    type: number
                    description: |
                      Return code.

                      The following only lists the return codes related to the API business logic. For the complete return codes, please refer to [Global Return Codes](/cloud-player-server/return-codes).
                      <table>
                      <thead>
                      <tr><th>Return Code</th><th>Description</th><th>Handling Suggestion</th></tr>
                      </thead>
                      <tbody>
                      <tr><td>0</td><td>Success.</td><td>-</td></tr>
                      <tr><td>100000004</td><td>Signature expired.</td><td>Please regenerate the signature.</td></tr>
                      <tr><td>100000005</td><td>Signature error.</td><td>Please confirm whether the parameters for generating the signature are correct.</td></tr>
                      <tr><td>350006001</td><td>API request frequency exceeds the limit.</td><td>Please confirm the QPS limit of the corresponding API and reduce the request frequency.</td></tr>
                      <tr><td>350006002</td><td>Gateway verification failed.</td><td>Please contact ZEGOCLOUD Technical Support for assistance.</td></tr>
                      <tr><td>350006003</td><td>Invalid input parameter.</td><td>Please adjust the value of the corresponding parameter according to the Message prompt.</td></tr>
                      <tr><td>350006006</td><td>Service not activated.</td><td>Please contact ZEGOCLOUD Technical Support to activate the service permission.</td></tr>
                      <tr><td>350010000</td><td>System error.</td><td>Please contact ZEGOCLOUD Technical Support for assistance.</td></tr>
                      </tbody>
                      </table>
                    example: 0
                  Message:
                    type: string
                    description: Operation result description.
                    example: "succeed"
                  RequestId:
                    type: string
                    description: Request ID.
                    example: "955607951583870294"
                  Data:
                    type: object
                    description: Response object.
                    properties:
                      UploadTaskId:
                        type: string
                        description: Upload task ID.
                        example: "upload_task_1"
                      CreateTime:
                        type: number
                        description: |
                          Unix timestamp when the file upload task was successfully created, unit: seconds.
                        example: 1681221508
                example:
                  Code: 0
                  Message: "succeed"
                  RequestId: "955607951583870294"
                  Data:
                    UploadTaskId: "upload_task_1"
                    CreateTime: 1681221508

