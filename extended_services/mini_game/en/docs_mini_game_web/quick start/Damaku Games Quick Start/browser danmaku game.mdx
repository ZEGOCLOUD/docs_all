---
articleID : 16589
---

# Implement live comment-based games on browsers as a host

- - -

This topic describes how to implement a live comment-based game on Web/H5 as a host by using ZEGO MiniGameEngine SDK and ZEGO Express SDK.

## Prerequisites

Before you implement a live comment-based game as a host, make sure that the following prerequisites are met:

- A project is created in the [ZEGOCLOUD console](https://console.zegocloud.com). The value of the `AppID` parameter of the project is obtained. For more information, see [How to view project information](https://www.zegocloud.com/docs/admin-console/view-project-information).
- The mini-game service is activated by contacting ZEGOCLOUD business staff.
- ZEGO MiniGameEngine SDK is integrated with your project. For more information, see [Integrate the SDK](../Integrate%20the%20SDK.mdx).
- ZEGO Express SDK is integrated with your project. For more information, see [Integrate the SDK](https://docs.zegocloud.com/article/1029) in the "Video Call" documentation.

## Sample code

ZEGOCLOUD provides [sample code](../run%20sample%20codes.mdx) on how to implement a live comment-based game for your reference.

## Procedure

The following figure shows the flowchart of implementing a live comment-based game as a host.

<Frame width="512" height="auto" caption="">
  <img src="https://storage.zego.im/sdk-doc/Pics/zegocloud/mini_game/16613en.png" />
</Frame>

### 1\. (Server) Connect to the ZEGOCLOUD server and obtain a token

#### 1.1 Connect to the ZEGOCLOUD server


For more information about how to connect to the ZEGOCLOUD MiniGameEngine server, see [Server API - Make API requests](/en/mini-game-server/making-api-requests). For more information about how to obtain a game start code, see [Obtain a game start code](!ZegoMiniGameEngine-Get_Activation_Code). This way, the host can obtain the game start code before the host <a href="#startCloudGame">starts the live comment-based game</a>. ZEGOCLOUD provides [sample server code](!ZegoMiniGameEngine-download) for your reference. For your data security, do not use the sample server code in a production environment.


#### 1.2 Obtain a token

When a user uses the ZEGOCLOUD mini-game service, the ZEGOCLOUD server checks whether the user has the required permissions based on the token that is specified when the user initializes ZEGO MiniGameEngine SDK. This prevents risks caused by insufficient permissions or improper operations.

Generate a token on your server and return the token to the client of the user. For more information, see [Token Authentication](/en/mini-game-server/making-api-requests).

### 2\.  (Client) Initialize SDKs

#### 2.1 Create a ZegoExpressEngine instance and log in to an RTC room

For more information about how to create a ZegoExpressEngine instance, see the "Create a ZegoExpressEngine instance" section of the [Implement a basic video call](https://www.zegocloud.com/docs/video-call/implement-basic-videocall?platform=web&language=javascript#4_1) topic in the "Video Call" documentation.

After the initialization, log in to the real-time communication (RTC) room. For more information, see the "Log in to a room" section of the [Implement a basic video call](https://www.zegocloud.com/docs/video-call/implement-basic-videocall?platform=web&language=javascript#4_2) topic in the "Video Call" documentation.

<a id="initMiniGameEngine"></a>

#### 2.2 Initialize the ZEGO MiniGameEngine SDK

Call the [init](@init) operation and specify your AppID, the token generated by your server, the custom user ID and username, and the URL of the avatar image. Then, initialize the ZEGO MiniGameEngine SDK.



```javascript title="Sample code"
const appID = ;  // After you create a project in the [ZEGOCLOUD console] (https://console.zegocloud.com), you can obtain the AppID from Project Management. The type of appID is number. 
const token = ""; // The token that your server generates. Required
const userInfo: ZegoUserInfo = {
    userId: "your user ID", // Your custom user ID. Require. Must be consistent with the userID used for the token generation. 
    userName: "your user name", // Your custom user name. Required
    avatar: "your user avatar", // Optional. The URL of the avatar image. The HTTPS protocol must be used.
}
let instance = null;
await ZegoMiniGameEngine.init(appID, token, userInfo)
    .then((result) => {
        // Initialization succeeded
        result && (instance = result);
    })
    .catch((error) => {
        // Initialization failed
        console.log(`errorCode: ${error.errorCode}, message: ${error.message}`);
    });
```

<a id="setCloudGameContainer"></a>

#### 2.3 Set the game container and register a listener for live comment-based game events

Call the [setCloudGameContainer](@setCloudGameContainer) operation to configure the parent container of the game for subsequently starting the game. Call the [on](@on) method to listen [cloudGameError](@cloudGameError)(live comment-based game events). The relevant events are returned in the [ZegoEventHandler](@-ZegoEventHandler) callback after <a href="#startCloudGame">the live comment-based game is started</a>.



```javascript title="Sample code"
// Set the game container
// Call the interface and pass in the <div> container ID specified when integrating the SDK, and the ID needs to be prefixed with #
// For example, if the <div> container ID specified for live comment-based games when integrating the SDK is "cloudGame", the parameter passed in should be '#cloudGame'
instance.setCloudGameContainer('#cloudGame');
// If you are assigning a value to the class of the <div> container when integrating the SDK, instead of the ID, the parameter format should be ".xxx" when calling the interface, where xxx is the actual class name.
// For example: instance.setCloudGameContainer('.cloudGame');

// Set the event delegation
instance.on('cloudGameError', (data) => {
    // Game error
});
```

<a id="getGameList"></a>

### 3\. (Client) Start the game

#### 3.1 Get the game list

Call the [getGameList](@getGameList) operation, set the `gameMode` parameter as `4`(which is GameModeCloudGame) to specify that the game is in live comment-based gaming mode, and then obtain the list of live comment-based games. Select a game ID from the list.

The following sample code provides an example on how to obtain the list of games that are in comment-based gaming mode:

```javascript
// Obtain the list of live comment-based games.
instance.getGameList(4).then((res) => {
    // Return the list
});
```

<a id="getGameCode"></a>

#### 3.2 Obtain a game activation code

After the game to play is determined, the host needs to obtain a game activation code by call the [ZEGOCLOUD server API](/en/mini-game-server/bullet-comments-games-related/get-activation-code). In this case, you need to send the game activation code to the client.

<a id="startCloudGame"></a>

#### 3.3 Start the live comment-based game

To start the game, Call the [startCloudGame](@startCloudGame) operation, and specify the room ID and the game ID.

<Note title="Note">

- (Recommended) If you specify the game activation code in this step, the game is automatically started after the game is loaded.   
- If you do not specify the game activation code, you must enter the game activation code after the game is loaded.
</Note>



```javascript title="Sample code"
const gameID = "your game ID"; // The game ID
const roomID = "your room ID"; // The game room ID. We recommend that you use your business room ID.

// Optional. Configure the game settings.
const gameConfig =  {
    // You can specify the game activation code and other parameters as required. The parameter formats are different for different games. You can contact ZEGOCLOUD technical support for help.
    // We recommend that you specify the game activation code. In this case, after the startCloudGame method is called, the game is automatically started.
    // If you do not specify the game activation code. After the startCloudGame operation is called, you are required to enter the game activation code subsequently during the game.
    runningParameters: "Game activation code",
};
// Start the game
instance.startCloudGame(gameID, roomID, gameConfig)
    .then((result) => {
        // Start succeeded
    })
    .catch((error) => {
        // Start failed
        console.log(`errorCode: ${error.errorCode}, message: ${error.message}`);
    });
```

<a id="startPublish"></a>

#### 3.4 Publish the live comment-based game stream to the RTC room

After the game is started, call the [startPublishCloudGameStream](@startPublishCloudGameStream) operation to publish the game stream to the RTC room.

```javascript
const gameID = "your game ID"; // The game ID
const roomID = "your room ID"; // The game room ID. We recommend that you use your business room ID.
const streamID = "your stream ID"; // The stream ID. You can specify the stream ID as needed. The value can not exceed 256 characters in length.
                                   // The value can contain only digits, letters, hyphens (-), and underscores (_).
                                   // Make sure that the stream ID is globally unique under the same appID. If different streams are published with the same `streamID`, the latter stream will fail.instance.startPublishCloudGameStream(gameID, roomID, streamID)
    .then((res)=>{
        if (res.code === 0) {
            // Publishing succeeded
        } else {
            // Publishing failed
        }
    });
```

@@@startNewGame@@@

<a id="stop"></a>

### 4\. (Client) Stop the game

Before you stop the live comment-based game, you must stop publishing the stream.

<a id="stopPublish"></a>

#### 4.1 Stop publishing the stream

Call the [stopPublishCloudGameStream](@stopPublishCloudGameStream) function to stop publishing the game streams.

```javascript
const gameID = "your game ID"; // The game ID. It should be the same as the gameID used when publishing the stream
const roomID = "your room ID"; // The game room ID. It should be the same as the roomID used when publishing the stream
const streamID = "your stream id"; // The stream ID. It should be the same as the streamID used when publishing the stream.
instance.stopPublishCloudGameStream(gameID, roomID, streamID)
    .then((res)=>{
        if (res.code === 0) {
            // Stop succeeded
        } else {
            // Stop failed
        }
    });
```

<a id="stopGame"></a>

#### 4.2 Stop the live comment-based game

Call the [stopCloudGame](@stopCloudGame) operation to stop the live comment-based game.



```javascript title="Sample code"
const gameID = "your game ID"; // The game ID
const roomID = "your room ID"; // The game room ID. We recommend that you use your business room ID.
instance.stopCloudGame(gameID, roomID)
    .then((result) => {
        // Stop succeeded
    })
    .catch(()=>{
        // Stop failed
        console.log(`errorCode: ${error.errorCode}, message: ${error.message}`);
    });
```

### 5\. (Client) Uninitialize the SDK

If you no longer need to play live comment-based games, you can log out of the RTC room, destroy the ZegoExpressEngine instance, and uninitialize ZEGO MiniGameEngine SDK to release resources.

#### 5.1 Log out of the RTC room

For more information about how to log out of the RTC room, see the "Log out of a room" section of the [Implement a basic video call](https://www.zegocloud.com/docs/video-call/implement-basic-videocall?platform=web&language=javascript#5_2) topic in the "Video Call" documentation.

#### 5.2 Destroy the ZegoExpressEngine instance

For more information about how to destroy the ZegoExpressEngine instance, see the "Destroy a ZegoExpressEngine instance" section of the [Implement a video call](https://www.zegocloud.com/docs/video-call/implement-basic-videocall?platform=web&language=javascript#5_2) topic in the "Real-Time Audio/Video" documentation.

<a id="unInit"></a>

#### 5.3 Uninitialize ZEGO MiniGameEngine SDK

Call the [unInit](@unInit) operation to uninitialize the ZEGO MiniGameEngine SDK.


```javascript title="Sample code"
instance.unInit();
```

## More feature

### (Client) Listen for the first frame rendering event of live comment-based games

If you want to customize the waiting screen for the live comment-based game or implement other business logic, please follow these steps:

1. Before <a href="#startCloudGame">the host starts the game </a>, hide the iframe used to load the game.
2. After <a href="#startCloudGame">the host starts the game</a>, play a custom loading animation or implement other business logic.
3. Call the [on\|_blank](@on) interface to listen to the [cloudGameFirstFrame\|_blank](@cloudGameFirstFrame) event. When receiving this event notification, display the iframe.

    ```javascript
    // Set the event delegation
    instance.on('cloudGameFirstFrame', () => {
        // First game frame is rendered successful
        // Display your iframe
        const iframe =  document.querySelector('#iframe');
        iframe.style.display = 'block';
    });
    ```

<a id="keyboardEvent"></a>

### (Client) Send a keyboard event

<Note title="Note">

If your game provides a keyboard for mobile devices and you like the keyboard, you do not need to customize a new keyboard. In this case, skip this step.
</Note>

After the host starts the live comment-based game on a mobile device, if the game does not have an available keyboard, the host needs to call the [sendKeyboardEvent](@sendKeyboardEvent) function and specify the keyboard code to implement a keyboard event such as configuration of the forward step or adjustment of the field of view (FOV). This helps the game run smoothly. For more information about keyboard codes, see <a href="https://www.toptal.com/developers/keycode" target="_blank" rel="noopener noreferrer">JavaScript Key Code Event</a>.


```javascript title="Sample code"
const keyboardCode = 65; // The value corresponding to the letter "A" in the keyboard
instance.sendKeyboardEvent(keyboardCode);
```
