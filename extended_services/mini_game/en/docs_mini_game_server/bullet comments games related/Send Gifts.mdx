# Send gifts

- - -
## Description
Calling this interface to trigger the gift-giving event in the live comment-based game will produce corresponding effects on thelive comment-based game client.

<Warning title="Warning">

- The gift-giving event can only occur after the user joins the game. If the user does not join the game when the gift-giving behavior occurs, the gift-giving event will fail (a few games have special circumstances, please contact technical support to confirm).
- Please merge the user's gift messages in the room dimension, and then request to this interface. Integrating the user's gift messages every 50-200 ms is recommended.
</Warning>

## Interface prototype

- Request method: POST
- Request URL: `https://mini-game-api.zego.im/?Action=SendDanmakuGifts`
- Transport Protocol: HTTPS
- Call frequency limit: 20 times/second (at the room level)


## Request parameters

The following request parameter list only lists interface request parameters. For the public parameter list, please refer to [Make API requests](../Making%20API%20Requests.mdx).

<table class="collapsible-table">
  
<tbody><tr data-row-level="1">
<th>Parameters</th>
<th>Type</th>
<th>Is it required</th>
<th>Description</th>
</tr>
<tr data-row-level="2">
<td>RoomId</td>
<td>String</td>
<td>Yes</td>
<td>Room ID, defined by you, can be up to 64 characters long.</td>
</tr>
<tr data-row-level="3">
<td>MiniGameId</td>
<td>String</td>
<td>Yes</td>
<td>To obtain your Game ID, please contact ZEGOCLOUD technical support.</td>
</tr>
<tr data-row-level="4" data-row-child="true">
<td>GiftList</td>
<td>Array of Object</td>
<td>Yes</td>
<td>Consolidated gift list.</td>
</tr>
<tr data-row-level="4-1" data-row-child="true">
<td>UserInfo</td>
<td>Object</td>
<td>Yes</td>
<td>User information object.</td>
</tr>
<tr data-row-level="4-1-1">
<td>UserId</td>
<td>String</td>
<td>Yes</td>
<td>User ID to join the game, defined by you. The maximum length is 48 characters, only numbers and English are allowed.</td>
</tr>
<tr data-row-level="4-1-2">
<td>Nickname</td>
<td>String</td>
<td>Yes</td>
<td>The user nickname is defined by you. It can be up to 32 characters long.</td>
</tr>
<tr data-row-level="4-1-3">
<td>Avatar</td>
<td>String</td>
<td>Yes</td>
<td>The address of the user's avatar must be a valid HTTP/HTTPS address and the length must be within 1024 bytes.。</td>
</tr>
<tr data-row-level="4-1-4">
<td>Sex</td>
<td>String</td>
<td>No</td>
<td>User gender.<ul><li>1：Male.</li><li>2：Female</li></ul></td>
</tr>
<tr data-row-level="4-2" data-row-child="true">
<td>GiftInfo</td>
<td>Object</td>
<td>Yes</td>
<td>Gift information object.</td>
</tr>
<tr data-row-level="4-2-1">
<td>GiftId</td>
<td>String</td>
<td>Yes</td>
<td>Gift ID. For a specific Gift ID, please contact ZEGOCLOUD technical support.</td>
</tr>
<tr data-row-level="4-2-2">
<td>Value</td>
<td>Number</td>
<td>No</td>
<td>Number of gifts required for a single effect. Not required, only needed if the gift ID requires different amounts of gifts (value) to trigger different effects. <br />Please contact ZEGOCLOUD technical support to determine the specific quantity and its relationship to the effect. If not specified, the default value is 1.<div class="mk-hint"><p>Users cannot send an unlimited number of gifts. They must send a specified number of gifts based on the enumeration values predefined in the game rules.</p><p>For example, if the game requires 5 gifts of type A to summon a soldier, then when the user sends gifts, the value should be set to 5.</p></div></td>
</tr>
<tr data-row-level="4-2-3">
<td>Num</td>
<td>Number</td>
<td>Yes</td>
<td><p>Number of desired game effects.</p>
<p><b>Giftid + Value</b> The corresponding game effects are pre-defined game rules. They are specific to the game. See <a href="#description"> </a> below for input instructions for GiftId, Value, and Num.</p></td>
</tr>
<tr data-row-level="4-3">
<td>ReceiverId</td>
<td>String</td>
<td>No</td>
<td>User ID for receiving gifts. This data is needed to record when multiple hosts compete in the same room for PK.</td>
</tr>
<tr data-row-level="4-4">
<td>Timestamp</td>
<td>Number</td>
<td>Yes</td>
<td>Unix timestamp in milliseconds when the gifting event occurs.</td>
</tr>
<tr data-row-level="4-5">
<td>MsgId</td>
<td>String</td>
<td>Yes</td>
<td>Gift Message ID generated by you, representing the message record ID for a single gift. It is used to ensure idempotent consumption of gifts and to query the gifting result. It should be unique for at least 24 hours. Using a duplicate MsgId within 24 hours will return the gifting result of the first occurrence and will not duplicate the gift. The maximum length is 64 characters and supports numbers, English letters, '_' and '-'.</td>
</tr>
</tbody></table>

<a id="description"></a>
### Input instructions for GiftId, Value, and Num 

Num (number of game effect units) is related to GiftID (gift) and Value (number of gifts required per unit of effect). It is also influenced by specific game rules. For more details, please contact the ZEGOCLOUD technical support team.

For example, in game A:
- The GiftId of the "rocket"(a gift) is g1.
- Sending 10 "rockets" at once will summon a "soldier"(the effect) in the game.
- Sending 66 "rockets" at once will summon a "general"(the effect) in the game.


During the game, there may be the following situations:
- When the audience wants to send 20 "rockets" to summon two soldiers in the game, the `GiftInfo` value passed in at this time is:：

    ```json
    "GiftInfo": {
        "GiftId": "g1",
        "Value": 10,
        "Num": 2
    }
    ```

- When the audience wants to send 66 "rockets" to summon a "general" in the game, the value passed in at this time is:

    ```json
    "GiftInfo": {
        "GiftId": "g1",
        "Value": 66,
        "Num": 1
    }
    ```

- If the developer's value does not match what was agreed with the ZEGOCLOUD technical support, an error message will be returned because it does not comply with the agreed game rules.

    ```json
    "GiftInfo": {
        "GiftId": "g1",
        "Value":30, // 30 is not equal to 10 or 66
        "Num": 1
    }
    ```

## Request example

- Request URL
  
    ```json
    https://mini-game-api.zego.im/?Action=SendDanmakuGifts
    &<Public request parameters>
    ```

- Request message body
  
    ```json
    {
      "RoomId": "room123",
      "MiniGameId": "TinyLoveWar",
      "GiftList": [
        {
          "UserInfo": {
            "UserId": "user1",
            "Nickname": "test1",
            "Avatar": "http://",
            "Sex": 1
          },
          "GiftInfo": {
            "GiftId": "g1",
            "Value": 5,
            "Num": 2
          },
          "Timestamp": 12312312,
          "ReceiverId":"anchor111",
          "MsgId":"445623452643416236"
      ]
    }
    ```

## Response parameters

<table class="collapsible-table" >
  
<tbody><tr data-row-level="1">
<th>Parameters</th>
<th>Type</th>
<th>Description</th>
</tr>
<tr data-row-level="2">
<td>Code</td>
<td>Int64</td>
<td>Error code.</td>
</tr>
<tr data-row-level="3">
<td>Message</td>
<td>String</td>
<td>Description of the request result.</td>
</tr>
<tr data-row-level="4">
<td>RequestId</td>
<td>String</td>
<td>Request ID.</td>
</tr>
<tr data-row-level="5" data-row-child="true">
<td>Data</td>
<td>Object</td>
<td>The specific information returned.</td>
</tr>
<tr data-row-level="5-1" data-row-child="true">
<td>Results</td>
<td>String</td>
<td>List of gift bullet processing results.</td>
</tr>
<tr data-row-level="5-1-1">
<td>Result</td>
<td>Number</td>
<td>process result. 0 indicates success, the rest indicates failure.</td>
</tr>
<tr data-row-level="5-1-2">
<td>Msg</td>
<td>String</td>
<td>Reason for failure.</td>
</tr>
<tr data-row-level="5-1-3">
<td>MsgId</td>
<td>String</td>
<td>The unique MsgId of the gift corresponding to the processing result.</td>
</tr>
</tbody></table>

There are two scenarios for gift delivery failure:
  -  If the error code “code != 0”, it means that all gifts have failed to be delivered. In this case, the MsgId will not be recorded, and you can retry the delivery directly without generating a new MsgId.
  -  If the error code “code == 0”, it means that the gift requests have been successfully consumed. However, there may be cases where some gifts are successfully delivered while others fail. The specific information about whether the gifts are successful or the reasons for failure can be found in the Result parameter of the response body. If you need to re-gift a failed gift, you need to regenerate the MsgId.

## Response example

```json
{
    "Code": 0,
    "Message": "succeed",
    "RequestId": "abcd123",
    "Data": {
        "Results": [
          {
            "Result": 0,
            "Msg": "success",
            "MsgId":"445623452643416236"
          }
        ]
    }
}
```

## Return code

The following only lists the return codes related to the interface business logic. For complete return codes, please refer to [Global return codes](../Return%20Codes.mdx).

<table>
  
<tbody><tr>
<th>Return code</th>
<th>Description</th>
<th>Handling suggestions</th>
</tr>
<tr>
<td>7202001</td>
<td>The game was not found, possible reasons include:<ul><li>Incorrect input of `MiniGameId`.</li><li>No permission to access this game.</li></ul></td>
<td><ul><li>Please check if the `MiniGameId` is correct.</li><li>Please contact ZEGOCLOUD business personnel to obtain permission for this game.</li></ul></td>
</tr>
<tr>
<td>7202002</td>
<td>`MiniGameId` format error.</td>
<td>Please confirm whether the format is String.</td>
</tr>
<tr>
<td>7206001</td>
<td>The game has not started.</td>
<td>Please confirm to send the gift after the game has started.</td>
</tr>
</tbody></table>

## Result processing result code
<table>
  
<tbody><tr>
<th>Return code</th>
<th>Description</th>
<th>Handling suggestions</th>
</tr>
<tr>
<td>10003</td>
<td>The possible reasons for gift delivery failure include:<ul><li>The user has not joined the game.</li><li>The room does not exist or has ended.</li><li>Unknown error.</li></ul></td>
<td>Please contact ZEGOCLOUD technical staff for troubleshooting.</td>
</tr>
<tr>
<td>10004</td>
<td>No corresponding gift configured.</td>
<td>Please confirm if the gift has been configured.</td>
</tr>
<tr>
<td>10005</td>
<td>Gift delivery exception.</td>
<td>Please contact ZEGOCLOUD technical staff for troubleshooting.</td>
</tr>
<tr>
<td>10006</td>
<td>The gift request corresponding to `MsgId` is being processed.</td>
<td>Please try again later.</td>
</tr>
</tbody></table>
