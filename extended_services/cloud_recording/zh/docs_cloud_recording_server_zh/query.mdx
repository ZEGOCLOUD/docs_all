@@@ServerAPIWarning@@@

# 查询录制状态

---

## 1 描述

开始录制后，开发者可以通过调用本接口来查询录制任务的状态。支持查询录制开始时间在发起接口调用时三天内的任务。

## 2 接口原型

- 请求方法：POST
- 请求地址：https://cloudrecord-api.zego.im/?Action=DescribeRecordStatus
- 传输协议：HTTPS
- 调用频率限制：10 次/秒

## 3 请求参数

@@@Request_Params_Des@@@

<table>
  
  <tbody><tr>
    <th>参数</th>
    <th>类型</th>
    <th>是否必选</th>
    <th>描述</th>
  </tr>
  <tr>
    <td>TaskId</td>
    <td>Int</td>
    <td>是</td>
    <td>录制任务 ID，长度固定为 16 个字节的字符串。</td>
  </tr>
</tbody></table>

## 4 请求示例

以下是 DescribeRecordStatus 接口的请求示例。
- 请求 URL  
```
https://cloudrecord-api.zego.im/?Action=DescribeRecordStatus
&AppId=1234567890
&SignatureNonce=15215528852396
&Timestamp=1234567890
&Signature=7a2c0f11145fb760d607a07b54825013
&SignatureVersion=2.0
```
- 请求消息体  
```json
{
	"TaskId": "X3CgNeE4I1qAAABN"
}
```

## 5 响应参数

<table>
  
  <tbody><tr>
    <th>参数</th>
    <th>类型</th>
    <th>描述</th>
  </tr>
  <tr>
    <td>Code</td>
    <td>Int64</td>
    <td>错误码。</td>
  </tr>
  <tr>
    <td>Message</td>
    <td>String</td>
    <td>错误描述。</td>
  </tr>
    <tr>
    <td>RequestId</td>
    <td>String</td>
    <td>请求 ID。</td>
  </tr>
  <tr>
    <td>Data</td>
    <td>Object</td>
    <td>响应对象。<br />详见 <a href="#Data">Data 属性列表</a>。</td>
  </tr>
</tbody></table>

<p id="Data">Data 属性如下：</p>
<table>
  
  <tbody><tr>
    <th>参数</th>
    <th>类型</th>
    <th>描述</th>
  </tr>
  <tr>
    <td>RoomId</td>
    <td>String</td>
    <td>录制的目标房间。</td>
  </tr>
  <tr>
    <td>RecordMode</td>
    <td>Int</td>
    <td>请参考 <a href=12322 target="_blank">开始录制</a>。</td>
  </tr>
  <tr>
    <td>StreamType</td>
    <td>Int</td>
    <td>请参考 <a href=12322 target="_blank">开始录制</a>。</td>
  </tr>
  <tr>
    <td>RecordBeginTimestamp</td>
    <td>Int64</td>
    <td>录制任务开始的时间，为 Unix 时间戳，单位：ms。</td>
  </tr>
  <tr>
    <td>RecordEndTimestamp</td>
    <td>Int64</td>
    <td>录制任务结束的时间，为 Unix 时间戳，单位：ms。</td>
  </tr>
  <tr>
    <td>Status</td>
    <td>Int</td>
    <td><p>录制任务的状态。</p><ul><li>1：录制任务初始化</li><li>2：录制任务进行中</li><li>3：录制任务已结束</li><li>4：录制任务异常结束</li><li>5：录制任务暂停中</li></ul></td>
  </tr>
  <tr>
    <td>RecordFiles</td>
    <td>Array of Object</td>
    <td>文件信息。<br />详见 <a href="#record_files">RecordFiles 属性列表</a>。<br />如果使用了视频截图功能，则不返回该字段。</td>
  </tr>
</tbody></table>

<Warning title="Warning">

录制任务为已结束状态时，如果录制过程中房间内无用户推流，则不会产生录制文件，也不会返回 RecordFiles 字段。

</Warning>

<p id="record_files">RecordFiles 属性如下：</p>

<table>
  
  <tbody><tr>
    <th>参数</th>
    <th>类型</th>
    <th>描述</th>
  </tr>
  <tr>
    <td>UserId</td>
    <td>String</td>
    <td>录制流对应的推流用户 ID（混流时，为 MixOutputStreamId）。</td>
  </tr>
  <tr>
    <td>UserName</td>
    <td>String</td>
    <td>录制流对应的推流用户昵称（混流时，为 MixOutputStreamId）。</td>
  </tr>
  <tr>
    <td>StreamId</td>
    <td>String</td>
    <td>录制流对应的流 ID（混流时，为 MixOutputStreamId）。</td>
  </tr>
  <tr>
    <td>FileId</td>
    <td>String</td>
    <td>请参考 <a href=12322 target="_blank">开始录制</a> 中的 OutputFileRule 参数。</td>
  </tr>
  <tr>
    <td>VideoId</td>
    <td>String</td>
    <td>阿里云 Vod、腾讯云 Vod 上传成功得到的视频 ID 参数。阿里云 Vod 对应的是 VideoId，腾讯云 Vod 对应的是 FileId。</td>
  </tr>
  <tr>
    <td>FileUrl</td>
    <td>String</td>
    <td>文件访问 URL。第三方存储为七牛云或阿里云 Vod 时不返回。</td>
  </tr>
  <tr>
    <td>OutputFileFormat</td>
    <td>String</td>
    <td>输出录制文件的格式，包括“mp4”、“flv”、“hls”、“jpg” 和 “aac”。</td>
  </tr>
  <tr>
    <td>FileSize</td>
    <td>Int64</td>
    <td>文件大小，单位：字节。</td>
  </tr>
  <tr>
    <td>Duration</td>
    <td>Int</td>
    <td>文件时长，单位：ms。</td>
  </tr>
  <tr>
    <td>ResolutionWidth</td>
    <td>Int</td>
    <td>视频分辨率宽，单位：像素。</td>
  </tr>
  <tr>
    <td>ResolutionHeight</td>
    <td>Int</td>
    <td>视频分辨率高，单位：像素。</td>
  </tr>
  <tr>
    <td>MediaTrackType</td>
    <td>Int</td>
    <td>文件媒体类型。<ul><li>1：只有音频</li><li>2：只有视频</li><li>3：音视频</li></ul></td>
  </tr>
  <tr>
    <td>BeginTimestamp</td>
    <td>Int64</td>
    <td>开始录制文件时的 Unix 时间戳，单位：ms。</td>
  </tr>
  <tr>
    <td>Status</td>
    <td>Int</td>
    <td>文件状态。<ul><li>1：录制中，表示正在录制文件。</li><li>2：上传中，表示正在上传录制文件至客户指定云存储。</li><li>3：上传成功，表示上传录制文件至客户指定云存储成功。</li><li>4：已经上传至备份云存储，表示上传客户指定云存储失败，已上传至 ZEGO 备份云存储。<b>请注意，ZEGO 备份云存储的有效期为 3 天，请您及时下载录制文件，保存到本地。</b></li><li>5：上传失败，表示上传客户指定云存储和 ZEGO 备份云存储均失败。</li></ul></td>
  </tr>
</tbody></table>

## 6 响应示例

以下是 DescribeRecordStatus 接口的响应示例。
```json
{
    "Code": 0,
    "Message": "succeed",
    "RequestId": "abcd123",
    "Data": {
        "RoomId": "xxxx",
        "RecordMode": 2,
        "StreamType": 3,
        "RecordBeginTimestamp": 1601221452099,
        "RecordEndTimestamp": 1601221508795,
        "Status": 3,
        "RecordFiles": [
            {
                "UserId": "my_out",
                "UserName": "my_out",
                "StreamId": "my_out",
                "FileId": "X3CgNeE4I1qAAABN_xxxx_my_out_VA_20200927154419775.mp4",
                "VideoId": "820e50e52e0a490caf44eec8aec527a7",
                "OutputFileFormat": "mp4",
                "FileSize": 432643544,
                "Duration": 33874,
                "ResolutionWidth": 1920,
                "ResolutionHeight": 1080,
                "MediaTrackType": 3,
                "BeginTimestamp": 1601221459830,
                "Status": 3,
                "FileUrl": "https://xxxx.oss-cn-shanghai.aliyuncs.com/record/X3CgNeE4I1qAAABN_xxxx_my_out_VA_20200927154419775.mp4"
            }
        ]
    }
}
```
