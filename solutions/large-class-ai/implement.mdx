# æ–¹æ¡ˆå®ç°

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•åœ¨ç›´æ’­å¤§ç­è¯¾ä¸­ **åŠ å…¥ AI æ•°å­—äººè€å¸ˆ**ï¼Œå¹¶å®ç°æ•™å­¦è¿‡ç¨‹ä¸­è®©æ‰€æœ‰å­¦ç”ŸåŒæ—¶åˆ»ä¸AIæ•°å­—äººè€å¸ˆè¿›è¡Œäº’åŠ¨å¯¹è¯ã€‚

## å‰ææè¦
åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š
- å·²è”ç³» ZEGO æŠ€æœ¯æ”¯æŒå®šåˆ¶ AIæ•°å­—äººè€å¸ˆå½¢è±¡ï¼ˆè‹¥ä½¿ç”¨å…¬æ¨¡åˆ™å¯ä»¥å¿½ç•¥æ­¤æ­¥éª¤ï¼‰
- åœ¨ [ZEGO æ§åˆ¶å°](https://console.zego.im/ProjectManage) ä¸­æ³¨å†Œå¹¶åˆ›å»ºé¡¹ç›®ï¼Œå¹¶è”ç³»æŠ€æœ¯æ”¯æŒ å¼€é€š AI Agentã€æ•°å­—äººæœåŠ¡å’Œç›¸å…³æ¥å£æƒé™
- å·²åœ¨é¡¹ç›®ä¸­é›†æˆ ZEGO Express SDKï¼Œè¯¦æƒ…è¯·å‚è€ƒ [å¿«é€Ÿå¼€å§‹ - é›†æˆ SDK](/real-time-voice-android/quick-start/integrating-sdk)ã€‚

## å®ç°æ–¹æ¡ˆ

å®ç°æ–¹æ¡ˆæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š
```mermaid
sequenceDiagram
    participant S as å­¦ç”Ÿç«¯
    participant B as ä¸šåŠ¡åå°
    participant Z as ZEGOæœåŠ¡

    Note over S,Z: å­¦ç”Ÿç«¯å¼€å§‹å¤§ç­è¯¾

    %% Token è·å–å’Œèµ„æºé¢„ä¸‹è½½
    S->>B: è¯·æ±‚ zego token
    B->>S: è¿”å› token
    S->>Z: ä½¿ç”¨ token é‰´æƒå¹¶é¢„ä¸‹è½½æ•°å­—äººèµ„æº
    Z->>S: è¿”å›èµ„æº

    Note over S,Z: å¯åŠ¨æ•°å­—äºº 1v1 è¯¾ç¨‹
    S->>B: å‘ä¸šåŠ¡åå°è¯·æ±‚åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹
    B->>Z: è¯·æ±‚åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹
    Z->>B: è¿”å›æ•°å­—äººæ™ºèƒ½ä½“é…ç½®digital_human_config
    B->>S: è¿”å›æ•°å­—äººæ™ºèƒ½ä½“é…ç½®digital_human_config
    S->>S: ä½¿ç”¨digital_human_configåˆå§‹åŒ–æ•°å­—äºº SDK
    S->>S: åˆå§‹åŒ– ZEGO Express SDK
    S->>B: è¯·æ±‚ zego token
    B->>S: è¿”å› zego token
    S->>Z: ä½¿ç”¨ zego token ç™»å½•æˆ¿é—´
    Z->>S: ç™»å½•æˆåŠŸ
    S->>S: å¼€å¯é¢„è§ˆã€æ¨éŸ³é¢‘æµã€æ‹‰æ•°å­—äººæµ


    Note over S,Z: ...è¯¾ç¨‹è¿›è¡Œä¸­...
    S->>S: å€’è®¡æ—¶ç»“æŸ
    S->>B: è¯·æ±‚åˆ é™¤æ•°å­—äººæ™ºèƒ½ä½“
    B->>Z: è¯·æ±‚åˆ é™¤æ•°å­—äººæ™ºèƒ½ä½“
    Z->>B: åˆ é™¤æˆåŠŸ
    B->>S: åˆ é™¤æˆåŠŸ
    S->>S: é€€å‡ºrtcæˆ¿é—´ï¼Œé‡Šæ”¾ ZEGO Express SDK,é‡Šæ”¾æ•°å­—äººSDK
```

## å®ç°è¿‡ç¨‹

<Steps titleSize="h3">
<Step title="æ„å»ºå¤§ç­è¯¾">
è¯·æ‚¨æŒ‰ç…§ [å¤§ç­è¯¾è§£å†³æ–¹æ¡ˆ](/large-class/overview) æŒ‡å¼•å…ˆå®ç°åŸºç¡€å¤§ç­è¯¾åœºæ™¯ã€‚
</Step>
<Step title="åœ¨å¤§ç­è¯¾ä¸­å®ç°AIæ•°å­—äººæ•™å¸ˆå’Œå­¦ç”Ÿä¹‹é—´ 1V1 å¯¹è¯">

è¦å®ç°å¤§ç­è¯¾ä¸­AIæ•°å­—äººæ•™å¸ˆå’Œå­¦ç”Ÿä¹‹é—´ 1V1 å¯¹è¯ï¼Œæ‚¨å¿…é¡»å®ç°æœåŠ¡ç«¯ç›¸å…³é€»è¾‘å’Œé›†æˆå®¢æˆ·ç«¯ SDKï¼ˆZEGO Express SDKå’Œæ•°å­—äºº SDKï¼‰å¹¶è°ƒç”¨ç›¸å…³åå°æ¥å£ã€‚è¯·æ‚¨æŒ‰ç…§ [AI Agent - å®ç°æ•°å­—äººè§†é¢‘é€šè¯](/aiagent-server/quick-start-with-digital-human) æŒ‡å¼•å®ç°ã€‚

<Note title="è¯´æ˜">è¯¥æŒ‡å¼•æ–‡æ¡£ä¸­åŒæ—¶æä¾›äº†æœåŠ¡ç«¯è·Ÿå®¢æˆ·ç«¯çš„ç¤ºä¾‹ä»£ç </Note>

</Step>
<Step title="æ ¹æ®å¤§ç­è¯¾åœºæ™¯åšæœ€ä½³å®è·µé…ç½®">

#### ä¸šåŠ¡åå°æœ€ä½³é…ç½®
åœ¨ AI æ•°å­—äººä¼´å­¦äº’åŠ¨åœºæ™¯ä¸­ï¼Œæ™ºèƒ½ä½“å®ä¾‹éœ€è¦ç»‘å®šä¸€ä¸ªæˆ¿é—´ roomIdï¼Œä»¥åŠæ™ºèƒ½ä½“è‡ªèº«çš„ agent_user_idã€agent_stream_id å’Œç”¨æˆ·çš„ user_idã€user_stream_idã€‚
æ•°å­—äººä¼šæ ¹æ®ç»‘å®šçš„é…ç½®ï¼Œåœ¨æŒ‡å®šçš„ roomId ä¸‹ï¼Œä»¥ agent_user_id ä½œä¸º userId æ¨æµï¼ˆstreamId ä¸º agent_stream_idï¼‰ï¼ŒåŒæ—¶æ ¹æ®ç»‘å®šçš„é…ç½®æ‹‰å– user_id çš„æµï¼ˆstreamId ä¸º user_stream_idï¼‰ã€‚å¦‚æœè¿™äº› ID é…ç½®ä¸ä¸€è‡´ï¼Œå°†æ— æ³•æ­£å¸¸å¯åŠ¨æ•°å­—äºº 1v1 é€šè¯ã€‚

<Warning title="è­¦å‘Š">æ¯ä¸ªæ™ºèƒ½ä½“å®ä¾‹éƒ½éœ€è¦ä¸ä¸Šè¿°å„ç±» ID å”¯ä¸€ç»‘å®šï¼Œå·²è¢«æŸä¸ªå®ä¾‹å ç”¨çš„ ID ä¸èƒ½è¢«å…¶ä»–å®ä¾‹å¤ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ™ºèƒ½ä½“é€šè¯å¼‚å¸¸ã€‚</Warning>

```javascript åå°åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹æ¥å£æœ€ä½³é…ç½®
async createDigitalHumanAgentInstance(agentId: string, userId: string, rtcInfo: RtcInfo, digitalHuman: DigitalHumanInfo, messages?: any[]) {
    // è¯·æ±‚æ¥å£ï¼šhttps://aigc-aiagent-api.zegotech.cn?Action=CreateDigitalHumanAgentInstance
    // !mark(1:18)
    // ç›¸å…³ ID è§„åˆ™åŠç¤ºä¾‹ã€‚
    // ğŸ’¡è¯·ä¿è¯ ç›¸å…³ ID ä¸å®¢æˆ·ç«¯ä¸€è‡´ã€‚

    // const prefixes = "v-" //v-è¡¨ç¤ºæ•°å­—äººè§†é¢‘æˆ¿ï¼Œa-è¡¨ç¤ºé™çº§çš„è¯­éŸ³æˆ¿
    // const suffix = "_è¯¾ç¨‹id_studentId_éšæœºæ•°"

    // const agentId = "agent_è¯¾ç¨‹id"; // æ³¨å†Œæ™ºèƒ½ä½“æ—¶å®šä¹‰çš„ agent_id
    // const roomId = prefixes + "room" + suffix;
    // const agentUserId = prefixes + "agent_user" + suffix;
    // const agentStreamId = prefixes + "agent_stream" + suffix;
    // const userId = prefixes + "user" + suffix;
    // const userStreamId = prefixes + "user_stream" + suffix
    // const rtcInfo = {
    //   RoomId: roomId,
    //   AgentStreamId: agentStreamId,
    //   AgentUserId: agentUserId,
    //   UserStreamId: userStreamId,
    // };
    const action = 'CreateDigitalHumanAgentInstance';
    const body = {
        AgentId: agentId,
        UserId: userId, // ä¸è¯¥ AIAgent å®ä¾‹äº¤äº’çš„çœŸå®ç”¨æˆ· ID
        RTC: rtcInfo,
        DigitalHuman: digitalHuman, // æµ‹è¯•æ—¶å¯ä½¿ç”¨å…¬å…± ID ï¼šc4b56d5c-db98-4d91-86d4-5a97b507da97
        MessageHistory: {
            SyncMode: 1, // Change to 0 to use history messages from ZIM
            Messages: messages && messages.length > 0 ? messages : [],
            WindowSize: 10
        }
    };
    // sendRequest æ–¹æ³•å°è£…äº†è¯·æ±‚çš„ URL å’Œå…¬å…±å‚æ•°ã€‚è¯¦æƒ…å‚è€ƒï¼šhttps://doc-zh.zego.im/aiagent-server/api-reference/accessing-server-apis
    const result = await this.sendRequest<any>(action, body);
    console.log("create agent instance result", result);
    // è¿”å›çš„ DigitalHumanConfig æ˜¯æ•°å­—äººé…ç½®ï¼Œå®¢æˆ·ç«¯æ ¹æ®æ•°å­—äººé…ç½®åˆå§‹åŒ–æ•°å­—äºº SDK ï¼Œç„¶åå³å¯ä¸æ•°å­—äººè¿›è¡Œå®æ—¶äº’åŠ¨ã€‚
    return result.AgentInstanceId, result.DigitalHumanConfig;
}
```

#### å®¢æˆ·ç«¯æœ€ä½³é…ç½®

åœ¨å¤§ç­è¯¾ AI æ•°å­—äººä¼´å­¦äº’åŠ¨åœºæ™¯ä¸­ï¼Œç”±çœŸäººè€å¸ˆæ§åˆ¶ç³»ç»Ÿå¼€å¯ 1V1 äº’åŠ¨å¼¹çª—æ—¶ï¼Œä¸šåŠ¡åå°ä¸ºæ¯ä¸€ä¸ªå­¦ç”Ÿåˆ›å»ºä¸€ä¸ªæ™ºèƒ½ä½“å®ä¾‹ï¼Œå¹¶ä¸”åˆ†å‘åˆ°å„ä¸ªå­¦ç”Ÿç«¯ï¼Œå­¦ç”Ÿç«¯æ ¹æ®è¿”å›é…ç½®ä¿¡æ¯æ‰§è¡Œè¿›æˆ¿ã€æ¨æ‹‰æµã€è‡ªå®šä¹‰æ¸²æŸ“é©±åŠ¨æ•°å­—äººï¼Œä¸æ•°å­—äººé€šè¯ã€‚


æ ¸å¿ƒæ­¥éª¤å¦‚ä¸‹ï¼š

<Steps titleSize="p">
<Step title="å‘ä¸šåŠ¡åå°è¯·æ±‚ Token å¹¶é¢„åŠ è½½æ•°å­—äººèµ„æº">
å‘ä¸šåŠ¡åå°è¯·æ±‚çš„ Tokenã€‚å¯ç”¨äºç™»å½• RTC ï¼ˆZEGO Express SDKï¼‰æˆ¿é—´å’Œç”¨äºä¸‹è½½æ•°å­—äººèµ„æºã€‚

åœ¨æˆåŠŸè·å– Token åï¼Œå¯ä»¥é¢„ä¸‹è½½æ•°å­—äººèµ„æºï¼Œå‡å°‘æ•°å­—äººé¦–æ¬¡å¯åŠ¨è€—æ—¶ã€‚
<Note title="è¯´æ˜">æ¨èåœ¨å¯åŠ¨æ•°å­—äºº1v1é¡µé¢ä¹‹å‰ï¼Œæ¯æ¬¡éƒ½è§¦å‘é¢„ä¸‹è½½æ•°å­—äººèµ„æºã€‚(å¤‡æ³¨ï¼šé¢„ä¸‹è½½æ—¶ï¼ŒSDKå†…éƒ¨ä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦ä¸‹è½½æˆ–æ›´æ–°æ•°å­—äººèµ„æº)</Note>

- å‘åå°è¯·æ±‚ Token
<CodeGroup>
```java Android(Java)
var userToken = ""
private fun requestToken() {
    Log.i(TAG, "requestZegoToken")
    // æ³¨æ„ä½¿ç”¨çš„ user id ä¸æœåŠ¡ç«¯åˆ›å»ºæ•°å­—äººæ™ºèƒ½ä½“å®ä¾‹æ—¶å¡«å†™çš„ä¸€è‡´
    // !mark
    val request: Request = Request.Builder().url("${BASE_URL}/api/zego-token?userId=$userId").get().build()
    client.newCall(request)
        .enqueue(object : Callback {
            override fun onFailure(call: Call, e: IOException) {
                Log.e(TAG, "http failed: " + e.message)
            }

            @Throws(IOException::class)
            override fun onResponse(call: Call, response: Response) {
                if (response.isSuccessful) {
                    val responseBody = response.body!!.string()
                    println(responseBody)
                    try {
                        val json = JSONObject(responseBody)
                        val token = json["token"] as String
                        if (!TextUtils.isEmpty(token)) {
                            Log.d(TAG, "get token : $token")
                            runOnUiThread {
                                // !mark
                               userToken = token
                            }
                        } else {
                            Log.e(TAG, "get token failed")
                        }
                    } catch (e: JSONException) {
                        throw RuntimeException(e)
                    }
                } else {
                    Log.e(TAG, "get token failed: " + response.code)
                }
            }
        })
}

//é¢„ä¸‹è½½æ•°å­—äººèµ„æºï¼Œå‡å°‘æ•°å­—äººé¦–æ¬¡å¯åŠ¨è€—æ—¶ï¼›
// !mark
preloadDigitalmobileRes(userToken, digitalHumanID)
```

```swift iOS(Swift)
var userToken = ""
private func requestToken() {
    print("TAG: requestZegoToken")
    // æ³¨æ„ä½¿ç”¨çš„ user id ä¸æœåŠ¡ç«¯åˆ›å»ºæ•°å­—äººæ™ºèƒ½ä½“å®ä¾‹æ—¶å¡«å†™çš„ä¸€è‡´
    // !mark
    let request = URLRequest(url: URL(string: "\(BASE_URL)/api/zego-token?userId=\(userId)")!)
    URLSession.shared.dataTask(with: request) { data, response, error in
        if let error = error {
            print("TAG: http failed: \(error.localizedDescription)")
            return
        }

        if let httpResponse = response as? HTTPURLResponse, httpResponse.statusCode == 200,
           let data = data {
            let responseBody = String(data: data, encoding: .utf8)
            print(responseBody ?? "")
            do {
                let json = try JSONSerialization.jsonObject(with: data) as? [String: Any]
                let token = json?["token"] as? String
                if !token?.isEmpty ?? false {
                    print("TAG: get token : \(token ?? "")")
                    DispatchQueue.main.async {
                        // !mark
                        userToken = token ?? ""
                    }
                } else {
                    print("TAG: get token failed")
                }
            } catch {
                print("TAG: JSON error: \(error.localizedDescription)")
            }
        } else {
            print("TAG: get token failed: \((response as? HTTPURLResponse)?.statusCode ?? 0)")
        }
    }.resume()
}

//é¢„ä¸‹è½½æ•°å­—äººèµ„æºï¼Œå‡å°‘æ•°å­—äººé¦–æ¬¡å¯åŠ¨è€—æ—¶ï¼›
// !mark
preloadDigitalmobileRes(userToken: userToken, digitalHumanID: digitalHumanID)
```
</CodeGroup>

- é¢„ä¸‹è½½æ•°å­—äººèµ„æº
<CodeGroup>
```java Android(Java)
private fun preloadDigitalmobileRes(token: String, digitalHumanID: String) {
    // !mark
    var auth = ZegoDigitalMobileAuth(APP_ID, userId, token)
    val context = this
    // !mark
    ZegoDigitalHumanResource.INSTANCE.preload(this, auth, digitalHumanID,
        object : PreloadCallback {
            override fun onSuccess() {
                Log.d(TAG, "preloadDigitalmobileRes, onSuccess")
                ZegoDigitalHumanResource.INSTANCE.isLoaded(context, auth, digitalHumanID,
                    object : ZegoDigitalHumanResource.IsLoadedCallback {
                        override fun onError(p0: Int, p1: String?) {
                            Log.d(TAG, "isLoaded onError errCode=$p0 errMsg=$p1")
                        }

                        override fun onResult(p0: Boolean) {
                            Log.d(TAG, "isLoaded onResult=$p0")
                        }
                    })
            }

            override fun onProgress(p0: Int) {
                Log.d(TAG, "preloadDigitalmobileRes, onProgress $p0")
            }

            override fun onError(p0: Int, p1: String?) {
                Log.d(TAG, "preloadDigitalmobileRes, onError errCode=$p0 errMsg=$p1")
            }
        })
}
```

```swift iOS(Swift)
private func preloadDigitalmobileRes(token: String, digitalHumanID: String) {
    // !mark
    let auth = ZegoDigitalMobileAuth(appID: APP_ID, userId: userId, token: token)
    let context = self
    // !mark
    ZegoDigitalHumanResource.shared.preload(
        with: auth,
        digitalHumanID: digitalHumanID,
        callback: PreloadCallback(
            onSuccess: {
                print("TAG: preloadDigitalmobileRes, onSuccess")
                ZegoDigitalHumanResource.shared.isLoaded(
                    with: auth,
                    digitalHumanID: digitalHumanID,
                    callback: IsLoadedCallback(
                        onError: { errorCode, errorMessage in
                            print("TAG: isLoaded onError errCode=\(errorCode) errMsg=\(errorMessage ?? "")")
                        },
                        onResult: { isLoaded in
                            print("TAG: isLoaded onResult=\(isLoaded)")
                        }
                    )
                )
            },
            onProgress: { progress in
                print("TAG: preloadDigitalmobileRes, onProgress \(progress)")
            },
            onError: { errorCode, errorMessage in
                print("TAG: preloadDigitalmobileRes, onError errCode=\(errorCode) errMsg=\(errorMessage ?? "")")
            }
        )
    )
}
```
</CodeGroup>

</Step>

<Step title="å‘ä¸šåŠ¡åå°è¯·æ±‚åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹">
åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹åï¼Œæ™ºèƒ½ä½“å®ä¾‹å°±ä¼šç™»å½•æˆ¿é—´å¹¶æ¨æµï¼ŒåŒæ—¶ä¹Ÿä¼šæ‹‰çœŸå®ç”¨æˆ·çš„æµã€‚åŒæ—¶ä¸šåŠ¡åå°ä¼šè¿”å›æ•°å­—äººé…ç½®ç”¨äºåˆå§‹åŒ–æ•°å­—äºº SDKï¼Œå­¦ç”Ÿç«¯æ ¹æ®è¿”å›é…ç½®ä¿¡æ¯æ‰§è¡Œè¿›æˆ¿ã€æ¨æ‹‰æµã€è‡ªå®šä¹‰æ¸²æŸ“é©±åŠ¨æ•°å­—äººï¼Œä¸æ•°å­—äººé€šè¯ã€‚

<CodeGroup>
```java Android(Java)
private fun startDiagitalAgentRoom() {
    Log.i(TAG, "startDigitalHumanChat")

    val jsonContent = try {
        val jsonObject = JSONObject()
        //ã€ã€è¯·æ±‚åˆ›å»ºæ™ºèƒ½ä½“å…³é”®å‚æ•°ã€‘ã€‘
        //ç§»åŠ¨ç«¯é…ç½®(éœ€è¦ç«¯ä¸Šæ•°å­—äººSDKåˆæˆè§†é¢‘)
        // !mark
        jsonObject.put("config_id", "mobile");
        //webç«¯é…ç½®(ç›´æ¥æ‹‰æ•°å­—äººæµï¼Œä¸éœ€è¦ç«¯ä¸Šå¤„ç†)
        //jsonObject.put("config_id", "web");
        jsonObject.toString()
    } catch (e: JSONException) {
        Log.e(TAG, "startDigitalHumanChat json error: " + e.message)
        return
    }

    //å‘ä¸šåŠ¡åå°è¯·æ±‚åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹ï¼Œè·å–æ•°å­—äººæ™ºèƒ½ä½“å®ä¾‹Idã€æ•°å­—äººé…ç½®
    val body = RequestBody.create("application/json; charset=utf-8".toMediaTypeOrNull(), jsonContent)
    // !mark(1:2)
    // è¯¥æ¥å£å®é™…ä¼šè°ƒç”¨ AI Agent çš„ CreateDigitalHumanAgentInstance æ¥å£ï¼ˆhttps://doc-zh.zego.im/aiagent-server/api-reference/agent-instance-management/create-digital-human-agent-instanceï¼‰ã€‚
    val request = Request.Builder().url("$BASE_URL/api/start-digital-human").post(body).build()
    OkHttpClient.Builder().build().newCall(request).enqueue(object : Callback {
        override fun onFailure(call: Call, e: IOException) {
            Log.e(TAG, "startDigitalHumanChat http failed: " + e.message)
        }

        @Throws(IOException::class)
        override fun onResponse(call: Call, response: Response) {
            if (response.isSuccessful) {
                val responseBody = response.body!!.string()
                Log.e(TAG, "startDigitalHumanChat response: $responseBody")
                try {
                    val json = JSONObject(responseBody)
                    val errorCode = json["code"] as Int
                    // åå°è¿”å›çš„æ•°å­—äººé…ç½®
                    // !mark
                    val digitalHumanConfig = json["digital_human_config"] as String
                    if (errorCode == 0) {
                        //æ•°å­—äººæ™ºèƒ½ä½“å®ä¾‹
                        agentInstanceId = json["agent_instance_id"] as String
                        var config = DigitalMobileConfigDecoder.decode(digitalHumanConfig)
                        runOnUiThread {
                            //ä¸‹ä¸€æ­¥ï¼šè¿›RTCæˆ¿é—´ã€åˆå§‹åŒ–æ•°å­—äººSDK.
                            // æ³¨æ„æ‰€æœ‰ç›¸å…³ ID ä¸æœåŠ¡ç«¯åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹æ—¶å¡«å†™çš„ä¸€è‡´
                            // !mark(1:2)
                            initDigitalMobileSDK(digitalHumanConfig)
                            loginRoom(roomId, userId, userStreamId)
                        }
                    } else {
                        runOnUiThread { stopDiagitalAgentRoom() }
                        Log.e(TAG, "startDigitalHumanChat start failed: $errorCode")
                    }
                } catch (e: JSONException) {
                    Log.e(TAG, "startDigitalHumanChat parse json failed: " + e.message)
                }
            } else {
                Log.e(TAG, "startDigitalHumanChat http failed: " + response.code)
            }
        }
    })
}
```

```swift iOS(Swift)
private func startDiagitalAgentRoom() {
    print("TAG: startDigitalHumanChat")

    let jsonContent: String
    do {
        let jsonObject: [String: Any] = [
            //ã€ã€è¯·æ±‚åˆ›å»ºæ™ºèƒ½ä½“å…³é”®å‚æ•°ã€‘ã€‘
            //ç§»åŠ¨ç«¯é…ç½®(éœ€è¦ç«¯ä¸Šæ•°å­—äººSDKåˆæˆè§†é¢‘)
            // !mark
            "config_id": "mobile"
        ]
        let jsonData = try JSONSerialization.data(withJSONObject: jsonObject)
        jsonContent = String(data: jsonData, encoding: .utf8) ?? ""
    } catch {
        print("TAG: startDigitalHumanChat json error: \(error.localizedDescription)")
        return
    }

    //å‘ä¸šåŠ¡åå°è¯·æ±‚åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹ï¼Œè·å–æ•°å­—äººæ™ºèƒ½ä½“å®ä¾‹Idã€æ•°å­—äººé…ç½®
    let body = jsonContent.data(using: .utf8)
    // !mark(1:2)
    // è¯¥æ¥å£å®é™…ä¼šè°ƒç”¨ AI Agent çš„ CreateDigitalHumanAgentInstance æ¥å£ï¼ˆhttps://doc-zh.zego.im/aiagent-server/api-reference/agent-instance-management/create-digital-human-agent-instanceï¼‰ã€‚
    var request = URLRequest(url: URL(string: "\(BASE_URL)/api/start-digital-human")!)
    request.httpMethod = "POST"
    request.setValue("application/json; charset=utf-8", forHTTPHeaderField: "Content-Type")
    request.httpBody = body

    URLSession.shared.dataTask(with: request) { data, response, error in
        if let error = error {
            print("TAG: startDigitalHumanChat http failed: \(error.localizedDescription)")
            return
        }

        if let httpResponse = response as? HTTPURLResponse, httpResponse.statusCode == 200,
           let data = data {
            let responseBody = String(data: data, encoding: .utf8)
            print("TAG: startDigitalHumanChat response: \(responseBody ?? "")")
            do {
                let json = try JSONSerialization.jsonObject(with: data) as? [String: Any]
                let errorCode = json?["code"] as? Int ?? 0
                // åå°è¿”å›çš„æ•°å­—äººé…ç½®
                // !mark
                let digitalHumanConfig = json?["digital_human_config"] as? String ?? ""
                if errorCode == 0 {
                    //æ•°å­—äººæ™ºèƒ½ä½“å®ä¾‹
                    agentInstanceId = json?["agent_instance_id"] as? String ?? ""
                    let config = DigitalMobileConfigDecoder.decode(digitalHumanConfig)
                    DispatchQueue.main.async {
                        //ä¸‹ä¸€æ­¥ï¼šè¿›RTCæˆ¿é—´ã€åˆå§‹åŒ–æ•°å­—äººSDK.
                        // æ³¨æ„æ‰€æœ‰ç›¸å…³ ID ä¸æœåŠ¡ç«¯åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹æ—¶å¡«å†™çš„ä¸€è‡´
                        // !mark(1:2)
                        initDigitalMobileSDK(digitalHumanConfig: digitalHumanConfig)
                        loginRoom(roomId: roomId, userId: userId, userStreamId: userStreamId)
                    }
                } else {
                    DispatchQueue.main.async {
                        stopDiagitalAgentRoom()
                    }
                    print("TAG: startDigitalHumanChat start failed: \(errorCode)")
                }
            } catch {
                print("TAG: startDigitalHumanChat parse json failed: \(error.localizedDescription)")
            }
        } else {
            print("TAG: startDigitalHumanChat http failed: \((response as? HTTPURLResponse)?.statusCode ?? 0)")
        }
    }.resume()
}
```
</CodeGroup>

</Step>
<Step title="åˆå§‹åŒ–æ•°å­—äºº SDK">
<CodeGroup>
```java title="Android(Java)"
private fun initDigitalMobileSDK(digitalHumanConfig: String) {
    Log.i(TAG, "initDigitalMobileSDK: $digitalHumanConfig")
    runOnUiThread(Runnable {
        // !mark(1:2)
        digitalMobileSDK = ZegoDigitalMobileFactory.create(this)
        digitalMobileSDK?.start(digitalHumanConfig, object : ZegoDigitalMobileListener {
            override fun onDigitalMobileStartSuccess() {
                Log.i(TAG, "onDigitalMobileStartSuccess")
            }

            override fun onError(errCode: Int, errMsg: String) {
                Log.i(TAG, "initDigitalMobileSDK, errCode=$errCode, errMsg=$errMsg")
            }

            override fun onSurfaceFirstFrameDraw() {
                Log.i(TAG, "onSurfaceFirstFrameDraw")
            }
        })
        digitalMobileSDK?.attach(playView)
    })
}
```

```swift title="iOS(Swift)"
private func initDigitalMobileSDK(digitalHumanConfig: String) {
    print("TAG: initDigitalMobileSDK: \(digitalHumanConfig)")
    DispatchQueue.main.async {
        // !mark(1:2)
        digitalMobileSDK = ZegoDigitalMobileFactory.create()
        digitalMobileSDK?.start(
            withConfig: digitalHumanConfig,
            listener: DigitalMobileListener(
                onStartSuccess: {
                    print("TAG: onDigitalMobileStartSuccess")
                },
                onError: { errCode, errMsg in
                    print("TAG: initDigitalMobileSDK, errCode=\(errCode), errMsg=\(errMsg ?? "")")
                },
                onSurfaceFirstFrameDraw: {
                    print("TAG: onSurfaceFirstFrameDraw")
                }
            )
        )
        digitalMobileSDK?.attach(to: playView)
    }
}
```
</CodeGroup>

</Step>

<Step title="åˆå§‹åŒ– ZEGO Express SDK">

åœ¨ç™»å½• RTC ï¼ˆZEGO Express SDKï¼‰æˆ¿é—´å‰ï¼Œéœ€è¦åˆå§‹åŒ– ZEGO Express SDKã€‚ä»¥ä¸‹ç¤ºä¾‹ä»£ç åŒ…å«äº†é€‚é… AI æ•°å­—äººä¼´å­¦äº’åŠ¨åœºæ™¯ä¸­åˆå§‹åŒ– ZEGO Express SDK çš„æœ€ä½³å®è·µé…ç½®ï¼š

<CodeGroup>
```java title="Android(Java)"
//1.åˆ›å»ºå¼•æ“å‰ï¼Œè®¾ç½®ç›¸å…³å‚æ•°é…ç½®
var config = ZegoEngineConfig().apply {
    //è®¾ç½®éŸ³é‡é—ªé¿æ¨¡å¼ï¼Œæå‡asrå¯¹ç”¨æˆ·å£°éŸ³è¯†åˆ«æˆåŠŸç‡ã€‚ä»…iOSé…ç½®ï¼ŒAndroidç«¯ä¸è®¾ç½®é¿å…ä½ç«¯æœºæ€§èƒ½ä¸è¶³å¯¼è‡´æ¨æµå¼‚å¸¸
    //advancedConfig = hashMapOf("set_audio_volume_ducking_mode" to "1")
    //è®¾ç½®æ‹‰æµéŸ³é‡è‡ªé€‚åº”è°ƒèŠ‚ï¼Œå‡å°‘å¹²æ‰°ç”¨æˆ·å£°éŸ³ï¼Œæå‡asrå¯¹ç”¨æˆ·å£°éŸ³è¯†åˆ«æˆåŠŸç‡ã€‚
    advancedConfig["enable_rnd_volume_adaptive"] = "true"
    advancedConfig["sideinfo_callback_version"] = "3"
    advancedConfig["sideinfo_bound_to_video_decoder"] = "true"
    //é¿å…å› ç½‘ç»œå·®å¯¼è‡´å£°éŸ³å¿«æ…¢æ”¾é—®é¢˜
    advancedConfig["jitter_level_compensation"] = "true"
}
ZegoExpressEngine.setEngineConfig(config)

//2.åˆ›å»ºå¼•æ“ï¼Œåœºæ™¯æ¨¡å¼è®¾ç½®ä¸ºHIGH_QUALITY_CHATROOM(æ¨èæœ€ä¼˜é…ç½®)
var profile = ZegoEngineProfile().apply {
    appID = APP_ID
    application = application
    scenario = ZegoScenario.HIGH_QUALITY_CHATROOM
}
ZegoExpressEngine.createEngine(profile, null)

//3ã€åˆ›å»ºå¼•æ“åï¼Œå¼€å¯ç›¸å…³è®¾ç½®
ZegoExpressEngine.getEngine().setAudioDeviceMode(ZegoAudioDeviceMode.GENERAL)
ZegoExpressEngine.getEngine().enableAEC(true)
ZegoExpressEngine.getEngine().enableAGC(true)
ZegoExpressEngine.getEngine().enableANS(true)
ZegoExpressEngine.getEngine().setAECMode(ZegoAECMode.AI_BALANCED) //è®¾ç½®AIå›å£°æ¶ˆé™¤æ¨¡å¼
ZegoExpressEngine.getEngine().setANSMode(ZegoANSMode.MEDIUM) //è®¾ç½®é™å™ªæ¨¡å¼
ZegoExpressEngine.getEngine().enableCamera(true) //å…è®¸å¼€å¯æ‘„åƒå¤´
ZegoExpressEngine.getEngine().muteMicrophone(false) //å…è®¸å¼€å¯éº¦å…‹é£
ZegoExpressEngine.getEngine().mutePublishStreamVideo(true) //ç”¨æˆ·ç«¯ä»…æ¨éŸ³é¢‘æµ
```

```swift title="iOS(Swift)"
//1.åˆ›å»ºå¼•æ“å‰ï¼Œè®¾ç½®ç›¸å…³å‚æ•°é…ç½®
let config = ZegoEngineConfig()
//è®¾ç½®éŸ³é‡é—ªé¿æ¨¡å¼ï¼Œæå‡asrå¯¹ç”¨æˆ·å£°éŸ³è¯†åˆ«æˆåŠŸç‡ã€‚ä»…iOSé…ç½®ï¼ŒAndroidç«¯ä¸è®¾ç½®é¿å…ä½ç«¯æœºæ€§èƒ½ä¸è¶³å¯¼è‡´æ¨æµå¼‚å¸¸
config.advancedConfig["set_audio_volume_ducking_mode"] = "1"
//è®¾ç½®æ‹‰æµéŸ³é‡è‡ªé€‚åº”è°ƒèŠ‚ï¼Œå‡å°‘å¹²æ‰°ç”¨æˆ·å£°éŸ³ï¼Œæå‡asrå¯¹ç”¨æˆ·å£°éŸ³è¯†åˆ«æˆåŠŸç‡ã€‚
config.advancedConfig["enable_rnd_volume_adaptive"] = "true"
config.advancedConfig["sideinfo_callback_version"] = "3"
config.advancedConfig["sideinfo_bound_to_video_decoder"] = "true"
//é¿å…å› ç½‘ç»œå·®å¯¼è‡´å£°éŸ³å¿«æ…¢æ”¾é—®é¢˜
config.advancedConfig["jitter_level_compensation"] = "true"
ZegoExpressEngine.setEngineConfig(config)

//2.åˆ›å»ºå¼•æ“ï¼Œåœºæ™¯æ¨¡å¼è®¾ç½®ä¸ºHIGH_QUALITY_CHATROOM(æ¨èæœ€ä¼˜é…ç½®)
let profile = ZegoEngineProfile()
profile.appID = APP_ID
profile.scenario = .highQualityChatroom
ZegoExpressEngine.createEngine(with: profile)

//3ã€åˆ›å»ºå¼•æ“åï¼Œå¼€å¯ç›¸å…³è®¾ç½®
ZegoExpressEngine.shared?.setAudioDeviceMode(.general)
ZegoExpressEngine.shared?.enableAEC(true)
ZegoExpressEngine.shared?.enableAGC(true)
ZegoExpressEngine.shared?.enableANS(true)
ZegoExpressEngine.shared?.setAECMode(.aiBalanced) //è®¾ç½®AIå›å£°æ¶ˆé™¤æ¨¡å¼
ZegoExpressEngine.shared?.setANSMode(.medium) //è®¾ç½®é™å™ªæ¨¡å¼
ZegoExpressEngine.shared?.enableCamera(true) //å…è®¸å¼€å¯æ‘„åƒå¤´
ZegoExpressEngine.shared?.muteMicrophone(false) //å…è®¸å¼€å¯éº¦å…‹é£
ZegoExpressEngine.shared?.mutePublishStreamVideo(true) //ç”¨æˆ·ç«¯ä»…æ¨éŸ³é¢‘æµ
```
</CodeGroup>

</Step>

<Step title="ç™»å½•æˆ¿é—´å¹¶è¿›æˆ¿ã€æ¨æµã€æ‹‰æµåå®ç°é€šè¯ã€‚">

åœ¨åšå¥½å¿…è¦å‡†å¤‡åï¼ŒçœŸå®ç”¨æˆ·ï¼ˆå­¦ç”Ÿï¼‰å¯ä»¥ç™»å½•æˆ¿é—´ã€‚ç™»å½•æˆ¿é—´åæ¨æµï¼Œæ•°å­—äººå°±å¯ä»¥é€šè¿‡æ‹‰å–çœŸå®ç”¨æˆ·çš„éŸ³é¢‘æµå¹¶è¯†åˆ«åè¿›è¡Œå›ç­”ï¼›ç”¨æˆ·ä¹Ÿå¯ä»¥æ‹‰æµå¬åˆ°æ•°å­—äººçš„å›ç­”ã€‚

<Warning title="è­¦å‘Š">è¯·åŠ¡å¿…å‚è€ƒæ­¥éª¤ 1 å†æ¬¡å‘ä¸šåŠ¡åå°è¯·æ±‚ Token åå†ç™»å½•æˆ¿é—´ï¼Œé˜²æ­¢ Token è¿‡æœŸå¯¼è‡´ç™»å½•æˆ¿é—´å¤±è´¥ã€‚</Warning>
<CodeGroup>
```java title="Android(Java)"
//ç™»å½•æˆ¿é—´
ZegoRoomConfig roomConfig = new ZegoRoomConfig();
//èƒ½ä½¿å¾—æ•°å­—äººå®æ—¶å¾—åˆ°è¯¥ç”¨æˆ·è¿›æˆ¿é€šçŸ¥.
//AIAgentæœåŠ¡ç«¯ä¼šä¾èµ–ç”¨æˆ·è¿›æˆ¿onUserUpdateå›è°ƒè¿›è¡Œè¶…æ—¶ç®¡ç†ï¼Œ
//å½“æ²¡æœ‰æ”¶åˆ°æŒ‡å®šç”¨æˆ·çš„userUpdateäº‹ä»¶ï¼Œè¶…è¿‡120så°†ä¼šå¼‚å¸¸ç»“æŸé€šè¯ï¼Œåˆ é™¤æ•°å­—äººæ™ºèƒ½ä½“å®ä¾‹.
// !mark
roomConfig.isUserStatusNotify = true;
// æ³¨æ„åº”è¯¥åœ¨è¿›æˆ¿å‰å†è°ƒç”¨ä¸€æ¬¡é˜²æ­¢ token è¿‡æœŸå¯¼è‡´ç™»å½•æˆ¿é—´å¤±è´¥ã€‚
// !mark
roomConfig.token = userToken;
// !mark
ZegoExpressEngine.getEngine().loginRoom(Constant.room_id, new ZegoUser(userId, userName), roomConfig, (errorCode, extendedData) -> {
    ZegoCanvas zegoCanvas = new ZegoCanvas(renderView);
    zegoCanvas.viewMode = ZegoViewMode.ASPECT_FILL;
    //å¼€å¯é¢„è§ˆ
    ZegoExpressEngine.getEngine().startPreview(zegoCanvas);
    // å¼€å¯æ¨æµï¼Œæ™ºèƒ½ä½“å®ä¾‹å°±å¯ä»¥é€šè¿‡æ‹‰å–çœŸå®ç”¨æˆ·çš„éŸ³é¢‘æµå¹¶è¯†åˆ«åè¿›è¡Œå›ç­”ã€‚
    // æ³¨æ„è¿™é‡Œçš„userStreamIdè¦ä¸æœåŠ¡ç«¯åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹æ—¶å¡«å†™çš„ä¸€è‡´
    // !mark
    ZegoExpressEngine.getEngine().startPublishingStream(userStreamId);

    //æ‹‰æ•°å­—äººæµã€‚æ˜¾ç¤ºæ•°å­—äººç”»é¢ã€‚
    ZegoCanvas zegoCanvas = new ZegoCanvas(renderView);
    zegoCanvas.viewMode = ZegoViewMode.ASPECT_FILL;
    // !mark
    ZegoExpressEngine.getEngine().startPlayingStream(agentStreamID, zegoCanvas);
});

//å¼€å¯è‡ªå®šä¹‰æ¸²æŸ“ï¼šæ•°å­—äººç”»é¢äº¤ç»™æ•°å­—äººSDKæ¸²æŸ“.
ZegoCustomVideoRenderConfig renderConfig = new ZegoCustomVideoRenderConfig();
renderConfig.bufferType = ZegoVideoBufferType.RAW_DATA;
renderConfig.frameFormatSeries = ZegoVideoFrameFormatSeries.RGB;
//è¯¥é…ç½®çš„ä½œç”¨ï¼šé¢„è§ˆç”»é¢è·³è¿‡è‡ªå®šä¹‰æ¸²æŸ“.
renderConfig.enableEngineRender = true;
ZegoExpressEngine.getEngine().enableCustomVideoRender(true, renderConfig);
//è‡ªå®šä¹‰æ¸²æŸ“å¤„ç†ï¼šæ•°å­—äººæœ¬åœ°æ¸²æŸ“é©±åŠ¨
// !mark
ZegoExpressEngine.getEngine().setCustomVideoRenderHandler(new IZegoCustomVideoRenderHandler() {
    @Override
    public void onRemoteVideoFrameRawData(ByteBuffer[] data, int[] dataLength, ZegoVideoFrameParam param, String streamID) {
        IZegoDigitalMobile.ZegoVideoFrameParam digitalParam = new IZegoDigitalMobile.ZegoVideoFrameParam();
        digitalParam.format = IZegoDigitalMobile.ZegoVideoFrameFormat.getZegoVideoFrameFormat(param.format.value());
        digitalParam.height = param.height;
        digitalParam.width = param.width;
        digitalParam.rotation = param.rotation;
        for (int i = 0; i < 4; i++) {
            digitalParam.strides[i] = param.strides[i];
        }
        // æŠŠ Express è§†é¢‘å¸§æ•°æ®ä¼ ç»™æ•°å­—äºº SDK
        synchronized (IZegoDigitalMobile.class) {
            if (digitalMobileSDK != null) {
                // !mark
                digitalMobileSDK.onRemoteVideoFrameRawData(data, dataLength, digitalParam, streamID);
            }
        }
    }
});
```

```swift title="iOS(Swift)"
//ç™»å½•æˆ¿é—´
let roomConfig = ZegoRoomConfig()
//èƒ½ä½¿å¾—æ•°å­—äººå®æ—¶å¾—åˆ°è¯¥ç”¨æˆ·è¿›æˆ¿é€šçŸ¥.
//AIAgentæœåŠ¡ç«¯ä¼šä¾èµ–ç”¨æˆ·è¿›æˆ¿onUserUpdateå›è°ƒè¿›è¡Œè¶…æ—¶ç®¡ç†ï¼Œ
//å½“æ²¡æœ‰æ”¶åˆ°æŒ‡å®šç”¨æˆ·çš„userUpdateäº‹ä»¶ï¼Œè¶…è¿‡120så°†ä¼šå¼‚å¸¸ç»“æŸé€šè¯ï¼Œåˆ é™¤æ•°å­—äººæ™ºèƒ½ä½“å®ä¾‹.
// !mark
roomConfig.isUserStatusNotify = true
// æ³¨æ„åº”è¯¥åœ¨è¿›æˆ¿å‰å†è°ƒç”¨ä¸€æ¬¡é˜²æ­¢ token è¿‡æœŸå¯¼è‡´ç™»å½•æˆ¿é—´å¤±è´¥ã€‚
// !mark
roomConfig.token = userToken
// !mark
ZegoExpressEngine.shared?.loginRoom(
    roomId,
    user: ZegoUser(userID: userId, userName: userName),
    config: roomConfig
) { errorCode, _ in
    ZegoExpressEngine.shared?.enableCamera(false)
    let zegoCanvas = ZegoCanvas(view: renderView)
    zegoCanvas.viewMode = .aspectFill
    //å¼€å¯é¢„è§ˆ
    ZegoExpressEngine.shared?.startPreview(zegoCanvas)
    // å¼€å¯æ¨æµï¼Œæ™ºèƒ½ä½“å®ä¾‹å°±å¯ä»¥é€šè¿‡æ‹‰å–çœŸå®ç”¨æˆ·çš„éŸ³é¢‘æµå¹¶è¯†åˆ«åè¿›è¡Œå›ç­”ã€‚
    // æ³¨æ„è¿™é‡Œçš„userStreamIdè¦ä¸æœåŠ¡ç«¯åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹æ—¶å¡«å†™çš„ä¸€è‡´
    // !mark
    ZegoExpressEngine.shared?.startPublishingStream(userStreamId)

    //æ‹‰æ•°å­—äººæµã€‚æ˜¾ç¤ºæ•°å­—äººç”»é¢ã€‚
    let zegoCanvas2 = ZegoCanvas(view: renderView)
    zegoCanvas2.viewMode = .aspectFill
    ZegoExpressEngine.shared?.startPlayingStream(agentStreamID, canvas: zegoCanvas2)
}

//å¼€å¯è‡ªå®šä¹‰æ¸²æŸ“ï¼šæ•°å­—äººç”»é¢äº¤ç»™æ•°å­—äººSDKæ¸²æŸ“.
let renderConfig = ZegoCustomVideoRenderConfig()
renderConfig.bufferType = .rawData
renderConfig.frameFormatSeries = .rgb
//è¯¥é…ç½®çš„ä½œç”¨ï¼šé¢„è§ˆç”»é¢è·³è¿‡è‡ªå®šä¹‰æ¸²æŸ“.
renderConfig.enableEngineRender = true
ZegoExpressEngine.shared?.enableCustomVideoRender(true, config: renderConfig)
//è‡ªå®šä¹‰æ¸²æŸ“å¤„ç†ï¼šæ•°å­—äººæœ¬åœ°æ¸²æŸ“é©±åŠ¨
// !mark
ZegoExpressEngine.shared?.setCustomVideoRenderHandler(CustomVideoRenderHandler())

class CustomVideoRenderHandler: IZegoCustomVideoRenderHandler {
    func onRemoteVideoFrameRawData(_ data: [UnsafeMutableRawPointer], dataLength: [Int], param: ZegoVideoFrameParam, streamID: String) {
        let digitalParam = IZegoDigitalMobile.ZegoVideoFrameParam()
        digitalParam.format = IZegoDigitalMobile.ZegoVideoFrameFormat(rawValue: param.format.rawValue)
        digitalParam.height = param.height
        digitalParam.width = param.width
        digitalParam.rotation = param.rotation
        for i in 0..<4 {
            digitalParam.strides[i] = param.strides[i]
        }
        // æŠŠ Express è§†é¢‘å¸§æ•°æ®ä¼ ç»™æ•°å­—äºº SDK
        objc_sync_enter(IZegoDigitalMobile.self)
        defer { objc_sync_exit(IZegoDigitalMobile.self) }
        if digitalMobileSDK != nil {
            // !mark
            digitalMobileSDK?.onRemoteVideoFrameRawData(data, dataLength: dataLength, param: digitalParam, streamID: streamID)
        }
    }
}
```
</CodeGroup>


æ­å–œä½ ğŸ‰ï¼Œåœ¨å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œä½ å·²ç»æˆåŠŸå®ç°äº†å¤§ç­è¯¾ä¸­ AI æ•°å­—äººæ•™å¸ˆå’Œå­¦ç”Ÿä¹‹é—´ 1V1 å¯¹è¯ã€‚

</Step>

</Steps>
</Step>

<Step title="ç»“æŸé€šè¯">

åœ¨å­¦ç”Ÿä¸ AI æ•°å­—äººæ•™å¸ˆå¯¹è¯ç»“æŸåï¼Œéœ€è¦ç»“æŸé€šè¯ã€‚å‘ä¸šåŠ¡åå°è¯·æ±‚åˆ é™¤æ™ºèƒ½ä½“å®ä¾‹ã€é”€æ¯ RTC ï¼ˆZEGO Express SDKï¼‰å¼•æ“ã€é”€æ¯æ•°å­—äººSDKã€‚

<CodeGroup>
```java title="Android(Java)"
private fun stopDiagitalAgentRoom() {
    Log.i(TAG, "stopDigitalHumanChat, agentInstanceId=${agentInstanceId}")
    val jsonContent = try {
        val jsonObject = JSONObject()
        jsonObject.put("agent_instance_id", agentInstanceId) //æ™ºèƒ½ä½“å®ä¾‹
        jsonObject.toString()
    } catch (e: JSONException) {
        Log.e(TAG, "startDigitalHumanChat json error: " + e.message)
        return
    }
    val body: RequestBody = RequestBody.create("application/json; charset=utf-8".toMediaTypeOrNull(), jsonContent)
    // !mark(1:2)
    // è¯¥æ¥å£å®é™…ä¼šè°ƒç”¨ AI Agent çš„ DeleteAgentInstance æ¥å£ï¼ˆhttps://doc-zh.zego.im/aiagent-server/api-reference/agent-instance-management/delete-agent-instanceï¼‰ã€‚
    val request: Request = Request.Builder().url("$BASE_URL/api/stop").post(body).build()
    client.newCall(request)
        .enqueue(object : Callback {
            override fun onFailure(call: Call, e: IOException) {
                Log.e(TAG, "stopDiagitalAgentRoom, e: ${e.printStackTrace()}")
            }

            @Throws(IOException::class)
            override fun onResponse(call: Call, response: Response) {
                Log.i(TAG, "stopDiagitalAgentRoom, onResponse code=${response.code}")
            }
        })

    // !mark
    destroyEngine()
    // !mark
    unInitDigitalMobileSDK()
}

private fun destroyEngine() {
    if (null != ZegoExpressEngine.getEngine()) {
        ZegoExpressEngine.getEngine().stopDumpData()
        ZegoExpressEngine.getEngine().logoutRoom()
        ZegoExpressEngine.destroyEngine(null)
    }
}

private fun unInitDigitalMobileSDK() {
    digitalMobileSDK?.stop()
}
```

```swift title="iOS(Swift)"
private func stopDiagitalAgentRoom() {
    print("TAG: stopDigitalHumanChat, agentInstanceId=\(agentInstanceId)")
    let jsonContent: String
    do {
        let jsonObject: [String: Any] = ["agent_instance_id": agentInstanceId] //æ™ºèƒ½ä½“å®ä¾‹
        let jsonData = try JSONSerialization.data(withJSONObject: jsonObject)
        jsonContent = String(data: jsonData, encoding: .utf8) ?? ""
    } catch {
        print("TAG: startDigitalHumanChat json error: \(error.localizedDescription)")
        return
    }
    let body = jsonContent.data(using: .utf8)
    // !mark(1:2)
    // è¯¥æ¥å£å®é™…ä¼šè°ƒç”¨ AI Agent çš„ DeleteAgentInstance æ¥å£ï¼ˆhttps://doc-zh.zego.im/aiagent-server/api-reference/agent-instance-management/delete-agent-instanceï¼‰ã€‚
    var request = URLRequest(url: URL(string: "\(BASE_URL)/api/stop")!)
    request.httpMethod = "POST"
    request.setValue("application/json; charset=utf-8", forHTTPHeaderField: "Content-Type")
    request.httpBody = body

    URLSession.shared.dataTask(with: request) { data, response, error in
        if let error = error {
            print("TAG: stopDiagitalAgentRoom, e: \(error.localizedDescription)")
            return
        }

        if let httpResponse = response as? HTTPURLResponse {
            print("TAG: stopDiagitalAgentRoom, onResponse code=\(httpResponse.statusCode)")
        }
    }.resume()

    // !mark
    destroyEngine()
    // !mark
    unInitDigitalMobileSDK()
}

private func destroyEngine() {
    if let engine = ZegoExpressEngine.shared {
        engine.stopDumpData()
        engine.logoutRoom()
        ZegoExpressEngine.destroyEngine()
    }
}

private func unInitDigitalMobileSDK() {
    digitalMobileSDK?.stop()
}
```
</CodeGroup>


</Step>


</Steps>

## å¸¸è§é—®é¢˜è§£ç­”

<Accordion title="æ˜¯å¦æ”¯æŒé€šè¿‡æ³¨å†Œæ™ºèƒ½ä½“æºå¸¦è‡ªå®šä¹‰å‚æ•°ï¼Œå¹¶å‘è‡ªå®šä¹‰LLMè¯·æ±‚æ—¶é€ä¼ è¯¥å‚æ•°ï¼Ÿ" defaultOpen="true">

è™½ç„¶ param æ”¯æŒè‡ªå®šä¹‰å‚æ•°ï¼Œå¦‚ param\:\{"max_tokens"\:xx, "trace_id"\:xxx\}ï¼Œå‘ LLM è¯·æ±‚æ—¶å–å‡º param å†…æ‰€æœ‰å­—æ®µå†…å®¹é€ä¼ ç»™ LLMã€‚ä½†éœ€è°¨æ…é€ä¼ ï¼ŒLLM å¦‚æœå¼ºæ ¡éªŒä¼ å…¥å‚æ•°å¤±è´¥ï¼Œå¯èƒ½å¯¼è‡´è¯·æ±‚å¤±è´¥è€Œ LLM æ— æ³•å›å¤ã€‚

**æ¨èæ–¹æ¡ˆï¼šæŠŠè‡ªå®šä¹‰å‚æ•°æ‹¼æ¥åˆ° room_idã€agent_user_idã€agent_streamId ç­‰ï¼Œé€ä¼ åˆ°è‡ªå®šä¹‰LLMã€‚**
</Accordion>

<Accordion title="LLMå›å¤å¸¦ emoji è¡¨æƒ…ï¼Œæ˜¯å¦ä¼šå¯¼è‡´TTSç¿»è¯‘æŠ¥é”™ã€æ–­å¥ç­‰é—®é¢˜ï¼Ÿ" defaultOpen="true">

TTS å¯¹äº emoji è¡¨æƒ…å½“åšæ— æ•ˆå­—ç¬¦ï¼Œä¸ä¼šæ–­å¥ï¼Œä½†ä¼šå¯¼è‡´éŸ³é¢‘åœé¡¿ä¸€ä¼šï¼›å¦‚æœ LLM çš„å›å¤åªæœ‰è¡¨æƒ…ï¼Œé‚£ä¹ˆ TTS ç”Ÿæˆä¼šæŠ¥é”™ï¼Œç”Ÿæˆå¤±è´¥ï¼›TTS å¯èƒ½å¯¹éƒ¨åˆ†è¡¨æƒ…è¯†åˆ«æ–‡å­—ï¼Œæ¯”å¦‚ ğŸ˜Š è½¬æˆè¯­éŸ³â€œå¾®ç¬‘â€ã€‚

**æ¨èæ–¹æ¡ˆï¼šå¯¹äº AI Agent çš„è¯­éŸ³æˆ–è§†é¢‘åœºæ™¯ï¼ŒLLM å›å¤å¸¦è¡¨æƒ…æ— æ„ä¹‰ï¼Œé€šè¿‡æç¤ºè¯æç¤º LLM å›å¤ä¸è¦å¸¦ emoji è¡¨æƒ…ã€‚**
</Accordion>

<Accordion title="LLM å›å¤å†…å®¹æ ¼å¼æ˜¯å¦æœ‰è¦æ±‚ï¼Ÿ" defaultOpen="true">
å¯¹äºä½¿ç”¨è‡ªå®šä¹‰ LLM çš„åœºæ™¯ï¼ŒLLM å›å¤çš„å†…å®¹æ ¼å¼ä¸å¯¹ä¼šé€ æˆè§£æå¤±è´¥å¯¼è‡´æµç¨‹ä¸­æ–­ï¼Œå¿…é¡»æŒ‰ç…§ä¸¥æ ¼çš„è§„èŒƒæ ¼å¼å›å¤ã€‚è¯¦æƒ…è¯·å‚è€ƒ[AI Agent - ä½¿ç”¨è‡ªå®šä¹‰ LLM](/aiagent-server/guides/configuring-llm#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89-llm)ã€‚

</Accordion>

<Accordion title="ä¸»åŠ¨è°ƒç”¨ TTS å¤±è´¥ç‡é«˜" defaultOpen="true">
å¤±è´¥åŸå› ï¼šæ•°å­—äººæ™ºèƒ½ä½“æ¨æµåï¼Œè¯æ²¡è¯´å®Œï¼Œè¢«ç”¨æˆ·è¯´è¯æ‰“æ–­ã€‚

**æ¨èæ–¹æ¡ˆï¼šåœ¨ AI Agent æœåŠ¡ç«¯è®¾ç½®ä¸­æ–­æ¨¡å¼ä¸ºä¸æ‰“æ–­ï¼ˆInterruptMode è®¾ç½®ä¸º 1ï¼‰ï¼Œåœ¨ç”¨æˆ·è¯´è¯æ—¶ï¼ŒAI ä¸ä¼šè¢«å½±å“ç›´åˆ°å†…å®¹è¯´å®Œã€‚è¯¦æƒ…è¯·å‚è€ƒ[AI Agent - ä¸»åŠ¨è°ƒç”¨ TTS](/aiagent-server/api-reference/agent-instance-control/send-agent-instance-tts)ã€‚**

</Accordion>
